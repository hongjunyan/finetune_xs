<Scripts Version="3" AppID="DAQ" UserID="JUSTB-1008" Lang="TW" StatusMask="2">
<Script Type="1" Name="KeltnerUB" ID="ceaed7efd13a4002b6785026fec2c9b9" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:Para(NumericSimple);

//Keltner Channels 的繪製，是以一條指數移動平均線為中間， 然後在上下兩邊依據所謂的"平均真實範圍值"來繪出軌道的範圍來。

KeltnerUB = KeltnerMA(20) + ATR(20) * Para;



]]></Code>
<Arg><![CDATA[<Arg seed="07879454-a7d7-42d6-967c-14ceb1f8e46d" version="1"><Param name="Para" varname="Para" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e162a9f3-e2aa-40a9-b503-ccb0c76e013c" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b;1,09e25135be3f4809a7fa384484b552b3;1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7;1,9e03682196e24611b2fe326b6a56433d;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,e8e5ac3753db447abac5b44618fa7dc8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="f602bd1b3b0a4b8ca7c79f35b83760d0" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LinearRegAngle" ID="7b6d505467f34b67aff3816cf394d90c" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[傳回線性迴歸的角度，用最小平方法計算出來的。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable: _Output(0);

LinearReg(thePrice, Length, 0, value1, _Output, value3, value4);

LinearRegAngle = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="cb39ce84-f319-4742-9701-6bc6eb656b75" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="93673fe2-3466-40fa-88b5-8ef466835edf" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,210d0786cfe340538e34c095bc2ba049</RefFunc>
<Extra><![CDATA[<Extra><VFID val="931a6b877ad9445cae4b92bd64a4b6a3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="FormatMQY" ID="5c82a9a1c49e4bbf8e9488647f48f1ba" ReturnType="3" ExecType="2" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:Date1(numericsimple);

value1 = ceiling(month(Date1)/3);
switch (Barfreq) Begin
	case "M","AM":
		formatMQY = Formatdate("yyyyMM",Date1);
	case "Q" :
		formatMQY = Formatdate("yyyy",Date1) + "Q" + numtostr(value1,0);
	case "Y" :
		formatMQY = Formatdate("yyyy",Date1);
	default:
		formatMQY = Formatdate("yyyyMMdd",Date1);
end;



]]></Code>
<Arg><![CDATA[<Arg seed="3122b4db-9036-42c8-b28d-ecf391897c0b" version="1"><Param name="Date1" varname="Date1" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3f7b5d9c-10bb-491c-8a06-90d392d38c79" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_Stochastic" ID="7bc1bae90d2a40d49fd2ed009329e614" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的KD指標。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率Stochastic函數(for KD/RSV相關指標)
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, SeriesH, SeriesL, SeriesC, Length, rsvt, kt
// 輸出: rsv_value, k_value, d_value
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string), 
	Length(numericsimple), rsvt(numericsimple), kt(numericsimple),
	rsv(numericref), k(numericref), d(numericref);
 
variable:
	maxHigh(0), minLow(0),lastK(50),lastD(50),closePeriod(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");
 
if FreqType="D" or FreqType="AD" or FreqType="W" or FreqType="AW" or FreqType="M" or FreqType="AM" then 
	condition1 = xfMin_getdtvalue(FreqType, Date) <> xfMin_getdtvalue(FreqType, Date[1])
else 
	condition1 = xfMin_getdtvalue(FreqType, datetime) <> xfMin_getdtvalue(FreqType, datetime[1]);	
	
if condition1 then
begin
	lastK = k[1];
	lastD = d[1];
end;

switch (FreqType)
begin
	case  "1":
		maxHigh = simplehighest(GetField("High", "1"),Length);
		minLow = simplelowest(GetField("Low", "1"),Length);
		closePeriod = GetField("Close", "1");
	
	case  "5":
		maxHigh = simplehighest(GetField("High", "5"),Length);
		minLow = simplelowest(GetField("Low", "5"),Length);
		closePeriod = GetField("Close", "5");
	
	case "10":
		maxHigh = simplehighest(GetField("High", "10"),Length);
		minLow = simplelowest(GetField("Low", "10"),Length);
		closePeriod = GetField("Close", "10");
	
	case "15":
		maxHigh = simplehighest(GetField("High", "15"),Length);
		minLow = simplelowest(GetField("Low", "15"),Length);
		closePeriod = GetField("Close", "15");
	
	case "30":
		maxHigh = simplehighest(GetField("High", "30"),Length);
		minLow = simplelowest(GetField("Low", "30"),Length);
		closePeriod = GetField("Close", "30");
	
	case "60":
		maxHigh = simplehighest(GetField("High", "60"),Length);
		minLow = simplelowest(GetField("Low", "60"),Length);
		closePeriod = GetField("Close", "60");

	case "D":
		maxHigh = simplehighest(GetField("High", "D"),Length);
		minLow = simplelowest(GetField("Low", "D"),Length);
		closePeriod = GetField("Close", "D");

	case "W":
		maxHigh = simplehighest(GetField("High", "W"),Length);
		minLow = simplelowest(GetField("Low", "W"),Length);
		closePeriod = GetField("Close", "W");

	case "M":
		maxHigh = simplehighest(GetField("High", "M"),Length);
		minLow = simplelowest(GetField("Low", "M"),Length);
		closePeriod = GetField("Close", "M");

	case "AD":
		maxHigh = simplehighest(GetField("High", "AD"),Length);
		minLow = simplelowest(GetField("Low", "AD"),Length);
		closePeriod = GetField("Close", "AD");

	case "AW":
		maxHigh = simplehighest(GetField("High", "AW"),Length);
		minLow = simplelowest(GetField("Low", "AW"),Length);
		closePeriod = GetField("Close", "AW");

	case "AM":
		maxHigh = simplehighest(GetField("High", "AM"),Length);
		minLow = simplelowest(GetField("Low", "AM"),Length);
		closePeriod = GetField("Close", "AM");

	default:
		maxHigh = simplehighest(High,Length);
		minLow = simplelowest(Low,Length);
		closePeriod = Close;
end;

if maxHigh <> minLow then
	rsv = 100 * (closePeriod - minLow) / (maxHigh - minLow)
else
	rsv = 50;
 
if currentbar = 1 then
begin
	k = 50;
	d = 50;
end
else
begin
	k = (lastK * (rsvt - 1) + rsv) / rsvt;
	d = (lastD * (kt - 1) + k) / kt;
end; 
 
xfMin_Stochastic = 1;]]></Code>
<Arg><![CDATA[<Arg seed="d25217ca-babc-4b06-8d6e-fb5cb9984b11" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="rsvt" varname="rsvt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="kt" varname="kt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="rsv" varname="rsv" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="k" varname="k" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="d" varname="d" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="ecc641c6-5af5-4a7b-92b0-656c4580ff78" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,356e05c9c03640b798c80a02e175aed1;1,35ecad2f46b642b58d4f6babdfd8e5a7</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c5ec9bb04ed242b6809e72dd89a959b2" /><script><freq support="2;8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TrueHigh" ID="36d1fc033c6f48f8a136f9e1fdec110f" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得價格真實區間(TrueRange)的高點。]]></Desc>
<Code><![CDATA[SetBarMode(1);

if Close[1] > High then TrueHigh = Close[1]
else TrueHigh = High;
        ]]></Code>
<Arg><![CDATA[<Arg seed="94dc4033-4ade-4ef9-9e02-f92084b63b08" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="fa3f8dd6-ae79-4b79-8bd0-9ff0e665d586" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="8b5b7d232cd14553a11da75b34910fd4" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthDayOfMonth" ID="2661174c578842599ba79c24c1c33cd6" ReturnType="1" ExecType="2" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[使用這個函數計算自某一天起算的第N個星期序數發生的日期
星期序數：
星期一：0
星期二：1
星期三：2
星期四：3
星期五：4
星期六：5
星期天：6
注意：這個函數可能會回傳無效的日期]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 計算自某一天起算的第N個星期序數的日期
//
input: StartDate(numericsimple), Nth(numericsimple), TargetDay(numericsimple);

variable: OddDaysOfWeek(0);

OddDaysOfWeek = TargetDay - DayOfWeek(StartDate);

If OddDaysOfWeek > 0 Then
	NthDayofMonth = dateadd(startdate,"D", iff(Nth >= 0,(Nth - 1 ),Nth) * 7 + OddDaysOfWeek)
Else if OddDaysOfWeek < 0 Then
	NthDayofMonth = dateadd(startdate,"D", iff(Nth >= 0,Nth,(Nth + 1)) * 7 + OddDaysOfWeek)
Else
	NthDayofMonth = dateadd(startdate,"D", iff(Nth >= 0,Nth - 1, Nth + 1) * 7);
]]></Code>
<Arg><![CDATA[<Arg seed="a94946f6-4f10-4ec0-bfc4-f47d4c5e9cf7" version="1"><Param name="StartDate" varname="StartDate" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Nth" varname="Nth" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="TargetDay" varname="TargetDay" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="727822f5-80cd-408e-8625-a4fca1a2d2d4" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="9c2e978e3d9448f0950a58e0bb441d44" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighD" ID="61b7479e4304402c83419e5e14e287ba" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得日線的最高價。
僅限使用於日線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

HighD = GetField("High","D")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="9310e471-5f23-4421-894e-f994b4087197" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b33fc0a6-2db7-45ca-bcb4-99177c1d7e1d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="9263d4b43d3c4aa793aa8b4955664bd2" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LastDayOfMonth" ID="ef0119ecb49d4b7e9ce30027b8a3dfee" ReturnType="1" ExecType="2" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[傳回指定月份的最後一日曆天，例如二月只有28天，一月有31天，四月有30天]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: SelectedMonth(numericsimple);

value1 = dateadd(EncodeDate(year(date),month(date),1),"M",1);
value2 = dateadd(value1,"D",-DayOfMonth(value1));
lastdayofmonth = DayOfMonth(value2);
]]></Code>
<Arg><![CDATA[<Arg seed="50d5af15-70a5-4faf-937a-a147c683888c" version="1"><Param name="SelectedMonth" varname="SelectedMonth" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="28e90e47-a7bb-42cf-896b-ae489b17f693" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="e4ad626eb44b4b53935e1e5feb475392" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_GetDTValue" ID="de5550c0989b434681e18c65fcc79915" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的序列值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 回傳某個日期的'normalized' value
// 用這個value來比對是否已經跨期
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// dtValue 是目前資料序列上面的Date
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string), 
	dtValue(numeric);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

switch (FreqType)
begin
	case "1","5","10","15","30","60":
		// 回傳分鐘線的日期時間YYYYMMDDhhmmss。例如：2018/9/10 12:03:59的五分線會回傳20180910120000
		//
		if dtValue < 19870106000000 then begin
			xfMin_GetDTValue = dtValue;
			return;
		end;
		value1 = strtonum(FreqType);
		value2 = strtonum(rightstr(numtostr(dtValue,0),6));
		value3 = IntPortion(minute(value2) / value1) * value1;
		xfMin_GetDTValue = dtValue - value2 + EncodeTime(hour(value2), value3, 0);	
	  
	case "D" , "AD":
		// 回傳YYYYMMDD
		// 
		xfMin_GetDTValue = dtValue;
	  
	case "W" , "AW":
		// 年度 * 100 + 周別, e.g. 201001, 表示是2010年的第一週
		// 
		xfMin_GetDTValue = Year(dtValue) * 100 + WeekofYear(dtValue);
		
		// 每年的第一週需要判斷是否和去年的最後一週重疊
		// 
		if WeekofYear(DateAdd(dtValue,"D", 1-DayofWeek(dtValue))) = 53 then 
			xfMin_GetDTValue = Year(DateAdd(dtValue,"D", 1-DayofWeek(dtValue))) * 100 + WeekofYear(DateAdd(dtValue,"D", 1-DayofWeek(dtValue)));
	 
	case "M" , "AM":
		// 年度 * 100 + 月別, e.g. 201001, 表示是2010年的第一個月
		//
		xfMin_GetDTValue = Year(dtValue) * 100 + Month(dtValue);
	 
	default:
		xfMin_GetDTValue = dtValue;
end;]]></Code>
<Arg><![CDATA[<Arg seed="e3b5ee09-6885-40b5-afba-dd7545003d73" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="dtValue" varname="dtValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6affa9fa-1ae0-409c-9ebc-7ed9e8226022" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="6422f90f38004311803dee7f820e7788" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="RateOfChange" ID="c9f2641e5de0497cb352ace96f64236e" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[計算自前N根K棒起算到當根K棒時，某個數列的數值變化率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"


if thePrice[Length] <> 0 then RateOfChange = (thePrice / absvalue(thePrice[Length]) - sign(thePrice[Length])) * 100
else RateOfChange = 0;
        ]]></Code>
<Arg><![CDATA[<Arg seed="cd116f6f-f5ad-4b09-a2aa-de66f27259af" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e68f28ca-b92e-4efb-83b0-04cef1a51faf" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="685e96af85774b53850c147a2e9cbc2e" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthHighestBar" ID="de75aec76c414cb0b78812a623b506e8" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[回傳第N個極大值在資料數列中對起始位置(0)的偏移列]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: N (numericsimple), thePrice(numericseries), Length(numericsimple);
variable: _Output(0);

NthExtremes(thePrice, Length, N, 1, value1, _Output);

NthHighestBar = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="7862711c-b439-4ee7-8952-f7881d9a20fb" version="1"><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="bbf65718-672e-42ac-b082-d4cbd5cd307d" version="1" />]]></Plots>
<RefFunc>1,f2404d9ffb2f49b3a38c431fcfc254b5</RefFunc>
<Extra><![CDATA[<Extra><VFID val="ba2967eba37e4dd09303d223e90a7427" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthHighestArray" ID="0e068023f7ec4fefb4d58c2da29c3f8f" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[找出陣列資料中的第N個極大值]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  thePriceArray[MaxSize](NumericArray), Size(numericsimple), N (numericsimple);
variable: _Output(0);

NthExtremesArray(thePriceArray, Size, N, 1, _Output, value2);

NthHighestArray = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="7e228dd8-e961-4376-a73f-59a4506fe751" version="1"><Param name="thePriceArray" varname="thePriceArray" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="Size" varname="Size" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6af01a10-0df1-4899-9d7c-99aedc1e14f9" version="1" />]]></Plots>
<RefFunc>1,078a531623ab4210b45048370757e8fa</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="EMP" ID="b7c53cefcc6649858be95d0146cf480c" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[Empty Line指標]]></Desc>
<Code><![CDATA[SetBarMode(1);

EMP= (AVERAGE(C,3)+AVERAGE(C,6)+AVERAGE(C,12)+AVERAGE(C,24))/4;
]]></Code>
<Arg><![CDATA[<Arg seed="f23dda10-e599-4bcb-a30d-00c9835c2688" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="b591590f-be87-4e65-905c-d78bdecf5ce7" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c3ea166b54874fc4953da885f2d93d89" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VR" ID="7864103bc6ef4eb0a316272e2ed9c77e" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:Length(numericsimple);
setinputname(1,"天數");
variable:UPV(0),DNV(0),NCV(0);
{
VR容量比率	
	UPV=N日內上漲天數的成交量總合
	DNV=N日內下跌天數的成交量總合
	NCV=N日內持平天數的成交量總合
}

UPV = SummationIf((C > C[1]), volume, Length);  
DNV = SummationIf((C < C[1]), volume, Length);  
NCV = SummationIf((C = C[1]), volume, Length);  

VR = iff(DNV + NCV/2=0,VR[1],100 * (UPV + NCV/2)/(DNV + NCV/2));
]]></Code>
<Arg><![CDATA[<Arg seed="f8f2d750-f45c-44bb-88c3-cce00fa19100" version="1"><Param name="天數" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6140d7d1-9279-4aae-958e-1c4ef6579115" version="1" />]]></Plots>
<RefFunc>1,95a5e49d2f6f4d369865c6de85a56469;1,8c2d025a23c548d3a76fba10c22527b4</RefFunc>
<Extra><![CDATA[<Extra><VFID val="87cca91d693e45969791959f75981aa1" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OpenH" ID="38061e022c014bb2b2ba9588411554a7" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得半年線的開盤價。
僅限使用於半年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

OpenH = GetField("Open","H")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="c5c1ff74-0e8e-4bf6-8aca-98f49514772a" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="d110b5b5-d663-4efd-9162-451462713f63" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="9d96c3dfe01d45e78f8a74df656bc478" /><script><freq support="15;8;9;10;11;12;13;14;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CloseM" ID="98b4853f376f423c9bdae8f6091ab3f6" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得月線的收盤價。
僅限使用於月線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

CloseM = GetField("Close","M")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="626c4740-4cd1-4b17-a789-7109fca69410" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b57586bf-32a4-4f5f-bc84-a33531d547b5" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="5fd0988f0f5a4a71b77a92102d1681f5" /><script><freq support="10;8;9;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CalcVWAPDistribution" ID="073494d68d8541248dad2cde0e958e62" ReturnType="1" ExecType="1" Folder="/交易相關/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[{
	計算過去N日的VWAP分佈
	
	請傳入
	
	- 計算天數
	- 開始時間, 例如091000
	- 結束時間, 例如095900 (請注意請以1分K的Time為基準)
	- 一個array, 用來儲存上述指定區間內每分鐘的累積成交量分佈%, 
	  - CalcVWAPDistribution會自動設定array的大小,
	  - array[1]是從開始時間後第1分鐘的累計成交量%, array[2]是從開始時間到後第2分鐘的累計成交量%, etc.
	  - 請注意這是一個累積的數值, 例如array[1] = 2.5, array[2] = 5.4, array[3] = 7.0, ... array[最後一個]=100.0,	  
}

input: totaldays(numericsimple, "計算天數");
input: start_hhmmss(numericsimple, "開始時間, 例如091000");
input: end_hhmmss(numericsimple, "結束時間, 例如095900");
input: dist_array[X](numericarrayref, "回傳成交量分佈%");

var: total_minutes(0);
array: day_dist[](0);		{ 儲存每一日的成交量分佈% }

{ 請注意: 不支援跨日的計算 }

if start_hhmmss >= end_hhmmss then raiseruntimeerror("開始時間必須小於結束時間");

total_minutes = TimeDiff(end_hhmmss, start_hhmmss, "M") + 1;	{ 頭尾都算 }

Array_SetMaxIndex(day_dist, total_minutes);
Array_SetMaxIndex(dist_array, total_minutes);

var: lastdate(0);
lastdate = GetFieldDate("Date", "1");	// 目前1分鐘K棒的TDate

var: idx(0), days(0);
var: idx_daystart(0), idx_dayend(0);

Array_SetValRange(dist_array, 0, total_minutes, 0);

{ 先找到昨日的最後一筆, 從這裡開始統計N日的資料 }
idx = 1;
while GetFieldDate("Date", "1")[idx] = lastdate begin
	idx = idx + 1;
end;

days = 0;
while days < totaldays begin
	lastdate = GetFieldDate("Date", "1")[idx];	
	idx_daystart = -1; 
	idx_dayend = -1;
	while GetFieldDate("Date", "1")[idx] = lastdate begin
		if GetField("Time", "1")[idx] = end_hhmmss then idx_dayend = idx;
		if GetField("Time", "1")[idx] = start_hhmmss then idx_daystart = idx;	
		idx = idx + 1;
	end;
	if idx_daystart = -1 or idx_dayend = -1 then raiseruntimeerror("Internal error");

	{print(
		"days=", numtostr(days, 0), 
		"date=", formatdate("yyyy/MM/dd", lastdate), 
		"idx_daystart=", numtostr(idx_daystart, 0), 
		"idx_dayend=", numtostr(idx_dayend, 0),
		""
	);}

	{ 收集從idx_start到idx_end之間的成交量分佈 }
	
	var: totalvolume(0), jdx(0);
	
	totalvolume = 0;
	day_dist[0] = 0;
	for jdx = idx_daystart downto idx_dayend begin
		{ 每一筆 = 前一筆的累積 + 這一分K的成交量 }
		day_dist[idx_daystart - jdx + 1] = GetField("Volume", "1")[jdx] + day_dist[idx_daystart - jdx];

		{print(
			"Index=", numtostr(idx_daystart - jdx + 1, 0),
			"day_dist[]=", numtostr(day_dist[idx_daystart - jdx + 1], 0),
			"Date=", FormatDate("yyyy/MM/dd", GetField("Date", "1")[jdx]),
			"Time=", FormatTime("HH:mm", GetField("Time", "1")[jdx]),
			"Vol=", numtostr(GetField("Volume", "1")[jdx], 0),
			""
		);}
		
	end;	
		
	for jdx = idx_daystart downto idx_dayend begin
		{ 換算成累積到目前為止的成交量% }
		day_dist[idx_daystart - jdx + 1] = day_dist[idx_daystart - jdx + 1] * 100 / day_dist[idx_daystart - idx_dayend + 1];
		
		{ 累積到 dist_array }
		dist_array[idx_daystart - jdx + 1] = dist_array[idx_daystart - jdx + 1] + day_dist[idx_daystart - jdx + 1];
		
		{print(
			"Index=", numtostr(idx_daystart - jdx + 1, 0),
			"day_dist[]=", numtostr(day_dist[idx_daystart - jdx + 1], 2),
			"dist_array[]=", numtostr(dist_array[idx_daystart - jdx + 1], 2),
			""
		);}
	end;
	
	days = days + 1;
end;	

{ 回傳dist_array = 近N日的平均值 }
for jdx = 1 to total_minutes begin
	dist_array[jdx] = dist_array[jdx] / totaldays;
end;
	
]]></Code>
<Arg><![CDATA[<Arg seed="90a8c05f-2104-4bf1-ac93-520102329b10" version="1"><Param name="計算天數" varname="totaldays" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="開始時間, 例如091000" varname="start_hhmmss" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="結束時間, 例如095900" varname="end_hhmmss" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="回傳成交量分佈%" varname="dist_array" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="10a57a3a-7e6f-4031-a2b0-9f3c32acd0c0" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><ScriptComplexity val="16" /><script><freq support="2;8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CrossUnder" ID="9dc3f19597ba44fa91524e91ca67aebd" ReturnType="2" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[放入兩個序列，可以判斷是否前面的序列是否跌破後面的序列
是的話傳回True，否則傳回False]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	SeriesA(numericseries),
	SeriesB(numericseries);
 
variable:
	valA(0), valB(0), posA(0), posB(0), idx(0);

CrossUnder  = false;
posA = 0;
posB = 0;
valA = SeriesA[posA];
valB = SeriesB[posB];

if valA >= valB then 
	CrossUnder = false
else begin
	for idx = 1 to minlist(6, currentbar)
	begin
		posA = posA + 1;
		posB = posB + 1;
		valA = SeriesA[posA];
		valB = SeriesB[posB];
		if valA > valB then
		begin
			CrossUnder = true;
			break;
		end
		else
		begin
			if valA < valB then
			begin
				CrossUnder = false;
				break;
			end;
		end; 
	end;
end;
]]></Code>
<Arg><![CDATA[<Arg seed="5ed17a9a-7351-4935-b57c-43b2d8085285" version="1"><Param name="SeriesA" varname="SeriesA" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesB" varname="SeriesB" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="069133cf-dfde-40a7-a879-77586d52fa6b" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CloseH" ID="93dadf093e044579b295f9d2b7b6dd1d" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得半年線的收盤價。
僅限使用於半年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

CloseH = GetField("Close","H")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="e66c83a3-8188-4633-9db7-c97b496ebafb" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="11a3e15f-03b2-42c6-89ad-bd7883846d2d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="87f50040ed4b4c02bbdd8d54e2acce97" /><script><freq support="15;8;9;10;11;12;13;14;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Lowest" ID="f1b429ac13b2447c909302198c18ca56" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[計算序列資料的最小值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries), Length(numericsimple);

variable: _Output(0);

Extremes(thePrice, Length, -1, _Output, value2);

Lowest = _Output;        ]]></Code>
<Arg><![CDATA[<Arg seed="4898c447-1ae9-4816-aadc-bd5b7d10b4b7" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="abb9dabf-442f-41c4-9aa0-8176ff95f94e" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="00eda8a468954df69b99c059ce72b6d0" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="KeltnerLB" ID="4097cb8d23eb48209b74e7573255ef5c" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:Para(NumericSimple);

//Keltner Channels 的繪製，是以一條指數移動平均線為中間， 然後在上下兩邊依據所謂的"平均真實範圍值"來繪出軌道的範圍來。

KeltnerLB = KeltnerMA(20) - ATR(20) * Para;



]]></Code>
<Arg><![CDATA[<Arg seed="a0aeeb5e-3fde-4330-839e-140ea5eadc8b" version="1"><Param name="Para" varname="Para" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="2c0feef5-f0dd-402e-a0ec-20d30236ab20" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b;1,09e25135be3f4809a7fa384484b552b3;1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7;1,9e03682196e24611b2fe326b6a56433d;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,e8e5ac3753db447abac5b44618fa7dc8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="e4486b00ea0b4ec8b3813f198f980d08" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ADI" ID="4acad56bd6ef4ecfa1071fe0efaba94d" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
輸出ADI指標值:
當日價格是漲時，表示上升力道戰勝，將此力道累積起來。
若當日是下跌，便從上升累積力道中減去下降的力道。
}
variable: ADIt(0);

if Close > Close[1] then
	ADIt = ADIt[1] + (Close - minlist(low, close[1]))
else
  begin
	if Close < Close[1] then
		ADIt = ADIt[1] - (maxlist(high, close[1]) - close)
	else
		ADIt = ADIt[1];
  end;

ADI =ADIt;

		]]></Code>
<Arg><![CDATA[<Arg seed="90f03d90-1b94-4ef0-ac82-86a06922d44d" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="fe48e270-8236-438c-8c7f-6f230bbfd1b9" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="f9ef5b2f19db45e7b6addff771b5ba1a" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="D_Value" ID="bd7a0b57d6404f7bbf48472833389d04" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
XQ: KD指標中的D值
Length:計算期數
Kt:Kt權數
}
input: Length(numeric), Kt(numeric);
variable:_rsv(0), _k(0), _d(0);

Stochastic(Length, Kt, Kt, _rsv, _k, _d);

D_value = _d;


		]]></Code>
<Arg><![CDATA[<Arg seed="99dc3047-5e12-4731-8f6c-b7ac022117fe" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Kt" varname="Kt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="c9390a0b-31b5-4bd7-8e00-f3608bb9bd39" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56;1,847bcd706dda4a9caf2b783e181a8e42</RefFunc>
<Extra><![CDATA[<Extra><VFID val="09c008ace7ef4be4a328a51da974aba1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_XAverage" ID="d5dc0dcf2b6a43ea9145511423952db3" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的指數移動平均。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率XAverage
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, Series, Length
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string),		//引用頻率
	Series(numericseries),	//價格序列
	Length(numericsimple);	//計算期間
 
variable:
	Factor(0), lastXAverage(0);

if getinfo("Instance")=3 and getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

if FreqType="D" or FreqType="AD" or FreqType="W" or FreqType="AW" or FreqType="M" or FreqType="AM" then 
	condition1 = xfMin_getdtvalue(FreqType, Date) <> xfMin_getdtvalue(FreqType, Date[1])
else 
	condition1 = xfMin_getdtvalue(FreqType, datetime) <> xfMin_getdtvalue(FreqType, datetime[1]);

if condition1 then
	lastXAverage = xfMin_XAverage[1];

value1 = xfMin_GetCurrentBar(FreqType);

if Length + 1 = 0 then Factor = 1 else Factor = 2 / (Length + 1);

if value1 = 1 then
	xfMin_XAverage = Series
else
	xfMin_XAverage = lastXAverage + Factor * (Series - lastXAverage);
]]></Code>
<Arg><![CDATA[<Arg seed="521cb811-3a9e-4f89-afbf-7542d34552c5" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Series" varname="Series" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="7cbade90-4cd0-47df-acef-69ea0ac993a6" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,aced678c83804b088f72d66788ddde3c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="6cfcf9c2b2f540f0ad1949ddaf39183f" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SwingHighBar" ID="35d7b36805ff4c449e3fc8c6976f40c7" ReturnType="1" ExecType="3" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[找出最近轉折高點的K棒位置。
判斷是否為轉折高點時，會比對該根K棒的左右兩邊各N根K棒，若左右兩邊的K棒數值皆較該根K棒數值低者，
則該點為一個轉折高點。
若無法找到時，會回傳-1
]]></Desc>
<Code><![CDATA[SetBarMode(2);

input: 
Price(numericseries), 
Length(numericsimple), 
LeftStrength(numericsimple), 
RightStrength(numericsimple), 
occur(numericsimple);
//價格序列、時間長度、左區間、右區間、第幾個峰值

variable: now(0), tmpnow(0), cnt(0), success(false);

now = Rightstrength;
cnt = 0;

while cnt < occur and now < Length
begin
	success = true;
	tmpnow = now+1;
	while success = true and tmpnow-now <= LeftStrength
	begin
		if Price[now] < Price[tmpnow] then
			success = false
		else tmpnow = tmpnow+1;
	end;
	
	tmpnow = now-1;
	while success = true and now-tmpnow <= RightStrength
	begin
		if Price[now] <= Price[tmpnow] then
			success = false
		else tmpnow = tmpnow-1;
	end;
	
	if success = true then
		cnt = cnt+1;
		
	now = now+1;
end;

if cnt < occur then
	swingHighBar  = -1
else
	swingHighBar  = now-1;]]></Code>
<Arg><![CDATA[<Arg seed="d745356a-4637-4a1d-8394-af914610e307" version="1"><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="LeftStrength" varname="LeftStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="RightStrength" varname="RightStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="occur" varname="occur" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="c245ba36-0120-4d2e-9c01-52dce12bc9ee" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="4d678f39022744bfa092e9df73c300db" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowestArray" ID="d2d538b9b20a4dae9f84299151855149" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[傳回陣列中的最小值]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  thePriceArray[MaxSize](NumericArray),ArraySize(numericsimple);
variable: _Output(0);

ExtremesArray(thePriceArray, ArraySize, -1, _Output, value2);
LowestArray = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="026ab8c6-d439-4e62-860c-79c72398e47e" version="1"><Param name="thePriceArray" varname="thePriceArray" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="ArraySize" varname="ArraySize" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="c3a855fe-1944-4422-9bfa-c920caac931b" version="1" />]]></Plots>
<RefFunc>1,47c51598c10a47f9a0327d62189828eb</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="PSY" ID="a89a3477e51f4eb0a459ae26748ccaab" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
XQ心理線:人氣指標心理線，計算特定期間內，行情上漲期數的比例
Length: 計算期數
}
input: Length(numeric);

PSY = 100 * CountIf(Close > Close[1], Length) / Length;


]]></Code>
<Arg><![CDATA[<Arg seed="1fb20e33-c64e-44cd-b360-9495fdcd94dd" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="d390c239-33e6-4c74-8700-062f3e981758" version="1" />]]></Plots>
<RefFunc>1,d80cf92ddfcc42e0a6c53ec47edebd49</RefFunc>
<Extra><![CDATA[<Extra><VFID val="de84f1d8f3ff4c4a9afcd43762afbf61" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_CrossUnder" ID="f67db2e284244ccbaaf4486e458ffe2d" ReturnType="2" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[判斷指定頻率的數列一是否由上往下穿越數列二，又稱死亡交叉。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入兩個序列(跟目前的頻率不同), 判斷是否crossunder
//
// FreqType是傳入序列的資料期別, 支援"D", "W", "M"
// SeriesA, SeriesB是傳入的序列
//
input:
	FreqType(string), 
	SeriesA(numericseries),
	SeriesB(numericseries);
 
variable:
	valA(0), valB(0), posA(0), posB(0);
 
posA = 0;
posB = 0;
valA = xf_getvalue(FreqType, SeriesA, posA);
valB = xf_getvalue(FreqType, SeriesB, posB);

if valA >= valB then
begin
	xf_CrossUnder = false;
	return;
end; 

variable: idx(0);
for idx = 1 to 6
begin
	posA = posA + 1;
	posB = posB + 1;
	valA = xf_getvalue(FreqType, SeriesA, posA);
	valB = xf_getvalue(FreqType, SeriesB, posB);
	if valA > valB then
	begin
		xf_CrossUnder = true;
		return;
	end
	else
	begin
		if valA < valB then
		begin
			xf_CrossUnder = false;
			return;
		end;
	end; 
end;
xf_CrossUnder = false;]]></Code>
<Arg><![CDATA[<Arg seed="7afc0d9b-8845-4a8a-b9f8-8a6069a1db10" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesA" varname="SeriesA" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesB" varname="SeriesB" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b04c192b-89e3-405e-bb54-da156e88084f" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,ae592f43d76b43c589aaa0eb0e6ecb27</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DaysToExpiration" ID="7adc0732a0b144149d70fb38c0965960" ReturnType="1" ExecType="2" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[離到期日天數，目前計算基準是台股指數類期貨商品的到期日]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入到期月份/年份, 回傳資料日期與到期日之間還差幾日
// 範例: Value1 = DaysToExpiration(4, 2013)
//
input:  
	_ExpiredM(numericsimple),
    _ExpiredY(numericsimple);

variable:
	lastTradeDate(0);
	
lastTradeDate = GetLastTradeDate(_ExpiredM, _ExpiredY);
DaysToExpiration = DateDiff(lastTradeDate, Date) + 1;
	]]></Code>
<Arg><![CDATA[<Arg seed="5f251ec5-b42d-4382-af75-95a87115715b" version="1"><Param name="_ExpiredM" varname="_ExpiredM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="_ExpiredY" varname="_ExpiredY" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="54ddb72e-ceb5-4f83-8fa1-e356ed9390e1" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,2661174c578842599ba79c24c1c33cd6;1,4ccd60568ab94d4085a852218b37ba80</RefFunc>
<Extra><![CDATA[<Extra><VFID val="2b45b6e504f548f9bc4ddc8921c771c9" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="EMA" ID="acd8e9a292d64600bec9591361584e6f" ReturnType="1" ExecType="3" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[計算XQ的EMA移動平均線]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:thePrice(numericseries); //"價格序列"
input:Length(Numeric);   //"計算期間"

variable:  Factor(0);

if length + 1 = 0 then Factor = 1 else Factor = 2 / (Length + 1);

if CurrentBar = 1 then
	EMA = thePrice
else if CurrentBar <= Length then
    EMA = (thePrice + (EMA[1]*(CurrentBar-1)))/CurrentBar	
else
	EMA = EMA[1] + Factor * (thePrice - EMA[1]);
 ]]></Code>
<Arg><![CDATA[<Arg seed="6b095608-a1ac-4863-bd12-f1263bde6b1d" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="5a6a1827-49f3-472d-a35d-91fedfa10177" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="8f7fb392f0c944539074ab79bfd0f561" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VPT" ID="2cad92a675a447f985348d3d927977dc" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

// XQ: PVT指標
//

If CurrentBar = 1 then
	VPT = 0
else	
	VPT = VPT[1] + (close - close[1])/close[1] * Volume;

		]]></Code>
<Arg><![CDATA[<Arg seed="c258ec64-d8e6-440f-8e2c-b25193208723" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="3b6f28c5-f45c-42e5-bbb4-fe8c65c5ab0d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="70ba4fb815ef4627aafe3822e2645079" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowD" ID="7513ef4c00b84668bb971542273f8683" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得日線的最低價。
僅限使用於日線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

LowD = GetField("Low","D")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="c750b5fb-bed0-4b1f-85e6-f182720b3ea5" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3241fd5f-f17f-4970-aff0-ee20256db5b8" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="862f0fda058e4891b1b9581198f5a170" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_CrossOver" ID="8926fa8082284a32b3b4687554ac376d" ReturnType="2" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[判斷指定頻率的數列一是否由下往上穿越數列二，又稱黃金交叉。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入兩個序列(跟目前的頻率不同), 判斷是否crossover
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// SeriesA, SeriesB是傳入的序列
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string), 
	SeriesA(numericseries),
	SeriesB(numericseries);
 
variable:
	valA(0), valB(0), posA(0), posB(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

posA = 0;
posB = 0;
valA = xfMin_getvalue(FreqType, SeriesA, posA);
valB = xfMin_getvalue(FreqType, SeriesB, posB);
if valA <= valB then
begin
	xfMin_CrossOver = false;
	return;
end; 

variable: idx(0);
for idx = 1 to 6
begin
	posA = posA + 1;
	posB = posB + 1;
	valA = xfMin_getvalue(FreqType, SeriesA, posA);
	valB = xfMin_getvalue(FreqType, SeriesB, posB);
	if valA < valB then
	begin
		xfMin_CrossOver = true;
		return;
	end
	else
	begin
		if valA > valB then
		begin
			xfMin_CrossOver = false;
			return;
		end;
	end; 
end;
xfMin_CrossOver = false;]]></Code>
<Arg><![CDATA[<Arg seed="7dcb4f1c-67e9-461e-8950-07f4f7301347" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesA" varname="SeriesA" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesB" varname="SeriesB" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="39cf34ee-2b1d-4739-a793-2b12c715b061" version="1" />]]></Plots>
<RefFunc>1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,de5550c0989b434681e18c65fcc79915;1,babf0756aef94393a6a0322ef06096e1</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DMO" ID="9e137cb40fac4dcdaade2efd4d26ba0c" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
DMO指標(Directional Movement Oscillator)以
DMI趨向指標指標中正負DI值，將此二條線合併而成的一條指標線。
Length: 計算期數
}

input: Length(numeric);
variable: pdi_value(0), ndi_value(0), adx_value(0);

DirectionMovement(Length, pdi_value, ndi_value, adx_value);

DMO =(pdi_value - ndi_value);

		]]></Code>
<Arg><![CDATA[<Arg seed="3a073688-1bf7-4cab-9315-13af41504c64" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="c8540484-0ad5-446a-a320-af2b0d669b23" version="1" />]]></Plots>
<RefFunc>1,7721dca8cc7242c09d21b782bbb59bd9</RefFunc>
<Extra><![CDATA[<Extra><VFID val="90f257a48eff40ea940564288df44a04" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DPO" ID="f3afaf702e184617835de9bd8b9af3b3" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
XQ: DPO指標
Detrended Price Oscillator，「非趨勢價格擺盪」指標
Length: 計算期數
}

input: Length(numeric);

DPO = Close - Average(Close, Length)[(Length /2) + 1];

		]]></Code>
<Arg><![CDATA[<Arg seed="bf41d39f-7c2b-418b-923a-f93302056c6e" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3301cad0-3049-461d-9c9c-dd574ffcf458" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="52b1d7a7b9cf49308ddf364d78231d14" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowM" ID="ac756bc9485545aea9974dcf2c061df4" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得月線的最低價。
僅限使用於月線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

LowM = GetField("Low","M")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="d3c71f54-9cf2-4560-9574-f88d7f3b26ca" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e2ac3b0c-1de4-493b-8f61-0f885836675b" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="86b3806106144ff19eaa96abfe788347" /><script><freq support="10;8;9;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TrueCount" ID="2cc2f4fe655a406aa5e49bfac4a3228e" ReturnType="1" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:TrueAndFalse(truefalseseries), Length(numericsimple);

value2 = 0;

for Value1 = 0 to Length - 1
begin
    if TrueAndFalse[Value1] = true then
        value2 = value2 +1
    else
     begin
        break;
     end;
end;
TrueCount = value2;
       ]]></Code>
<Arg><![CDATA[<Arg seed="3a0637d6-dcbf-4c9c-83eb-42d9a86f03e0" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0bd4ae96-e311-4f7d-b983-4d5b1a37e43b" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="89016950380b409d8e6eef793ded1037" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SummationIF" ID="95a5e49d2f6f4d369865c6de85a56469" ReturnType="1" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[當某期資料符合某項判斷準則時，才加該期資料加總]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: TrueAndFalse(truefalseseries), thePrice(numericseries), Length(numericsimple);
variable: _Output(0);

_Output = 0;

for Value1 = 0 to Length - 1
begin
    if TrueAndFalse[Value1] then _Output = _Output + thePrice[Value1];
end;

SummationIf = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="7c571333-81d3-4a52-a8ac-c9a944ca7bad" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0bbe83ad-2338-493c-94da-968fa6b1ac78" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="bd2b55f00756431399bb324957767fc3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CloseQ" ID="55b090afcf794843ae857472b94feb59" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得季線的收盤價。
僅限使用於季線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

CloseQ = GetField("Close","Q")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="916dfdfb-5120-45f0-8e00-578763640cd2" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="9e81b22b-d82e-4e1c-a487-c849e1bf2bbb" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="591764b981e54491a2a07150b2ec78f8" /><script><freq support="14;8;9;10;11;12;13;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_WeightedClose" ID="2f8ed4e98bf740a88ac2c3dee2afec24" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的加權平均收盤價。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率WeightedClose函數
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

switch (UpperStr(FreqType))
begin
	case  "1":
		xfMin_WeightedClose = (2 * GetField("Close", "1") + GetField("High", "1") + GetField("Low", "1")) / 4;
		
	case  "5":
		xfMin_WeightedClose = (2 * GetField("Close", "5") + GetField("High", "5") + GetField("Low", "5")) / 4;	
	
	case "10":
		xfMin_WeightedClose = (2 * GetField("Close", "10") + GetField("High", "10") + GetField("Low", "10")) / 4;	
	
	case "15":
		xfMin_WeightedClose = (2 * GetField("Close", "15") + GetField("High", "15") + GetField("Low", "15")) / 4;	
	
	case "30":
		xfMin_WeightedClose = (2 * GetField("Close", "30") + GetField("High", "30") + GetField("Low", "30")) / 4;	
	
	case "60":
		xfMin_WeightedClose = (2 * GetField("Close", "60") + GetField("High", "60") + GetField("Low", "60")) / 4;

	case "D":
		xfMin_WeightedClose = (2 * GetField("Close", "D") + GetField("High", "D") + GetField("Low", "D")) / 4;

	case "W":
		xfMin_WeightedClose = (2 * GetField("Close", "W") + GetField("High", "W") + GetField("Low", "W")) / 4;

	case "M":
		xfMin_WeightedClose = (2 * GetField("Close", "M") + GetField("High", "M") + GetField("Low", "M")) / 4;

	case "AD":
		xfMin_WeightedClose = (2 * GetField("Close", "AD") + GetField("High", "AD") + GetField("Low", "AD")) / 4;

	case "AW":
		xfMin_WeightedClose = (2 * GetField("Close", "AW") + GetField("High", "AW") + GetField("Low", "AW")) / 4;

	case "AM":
		xfMin_WeightedClose = (2 * GetField("Close", "AM") + GetField("High", "AM") + GetField("Low", "AM")) / 4;

	default:
		xfMin_WeightedClose = (2 * Close + High + Low) / 4;
end;
]]></Code>
<Arg><![CDATA[<Arg seed="49069950-1164-43c7-8036-e257b8a1acdd" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="7980ecf2-bd2c-41ea-a1cf-43a6d8c15a08" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="eaf7b63e41ce4e8388e6381cd6459229" /><script><freq support="2;8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TSELSindex" ID="b1f1a25bdc014e109dc92d7f9b6ef207" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[{
函數說明
https://xstrader.net/打造自己的大盤多空函數/
}

SetBarMode(1);

input:Length(numeric);
input:LowLimit(numeric);
 
if countif(GetSymbolField("tse.tw","外資買賣超金額","D") > 0,Length) >= LowLimit
and GetSymbolField("tse.tw","外資買賣超金額","D") > 0 then
	value1 = 1
else
	value1 = 0;

tselsindex = value1;





]]></Code>
<Arg><![CDATA[<Arg seed="4983136d-1055-428c-ab77-09370dc9a6ac" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="LowLimit" varname="LowLimit" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="886f7a44-e636-40e4-988f-35cf34b8e027" version="1" />]]></Plots>
<RefFunc>1,d80cf92ddfcc42e0a6c53ec47edebd49</RefFunc>
<Extra><![CDATA[<Extra><VFID val="0698ef3154e94d02be261f0d446c3542" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="KST確認指標" ID="a23c81648d064f80855a462cfd76366e" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

value1=average(rateofchange(close,12),10);
value2=average(rateofchange(close,20),10);
value3=average(rateofchange(close,30),8);
value4=average(rateofchange(close,40),15);

ret = value1+value2*2+value3*3+value4*4;
]]></Code>
<Arg><![CDATA[<Arg seed="a908b6fb-3544-4059-9819-e6ac60f9bc5e" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="6d11603b-af1e-4e92-8ec1-f92ded12335b" version="1" />]]></Plots>
<RefFunc>1,c9f2641e5de0497cb352ace96f64236e;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="8106fc6ba19e4c9c8a42e8f5ca1ca2ae" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_EMA" ID="8f6d04f6de7d45e4bb061907b95215e7" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的XQ指數移動平均。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率EMA
//
// FreqType是預期要比對的期別, 支援"D", "W", "M"
// 輸入: FreqType, Series, Length
//
input:
	FreqType(string),		//引用頻率
	Series(numericseries),	//價格序列
	Length(numericsimple);	//計算期間
 
variable:
	Factor(0), lastEMA(0);

 
condition1 = xf_getdtvalue(FreqType, Date) <> xf_getdtvalue(FreqType, Date[1]);
if condition1 then
	lastEMA = xf_EMA[1];

value1 = xf_GetCurrentBar(FreqType);

if Length + 1 = 0 then Factor = 1 else Factor = 2 / (Length + 1);

if value1 = 1 then
	xf_EMA = Series
else if value1 <= Length then
    xf_EMA = (Series + (lastEMA * (value1 - 1)))/value1	
else
	xf_EMA = lastEMA + Factor * (Series - lastEMA);
	
	

 ]]></Code>
<Arg><![CDATA[<Arg seed="99f84b2a-bb37-496c-bdc2-cdd4cd84b2bb" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Series" varname="Series" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="00e56d5a-75c1-4e6f-b1f3-90ad679c0417" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,d6c8ec6b762c4f47b2ad9bfd806fea5f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="e7f68374a86e48a9bcd33ad6296d877c" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SwingHigh" ID="338bcd4030a24d11b2a3420e0281fe44" ReturnType="1" ExecType="3" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[找出最近轉折高點的數值
判斷是否為轉折高點時，會比對該根K棒的左右兩邊各N根K棒，若左右兩邊的K棒數值皆較該根K棒數值低者，
則該點為一個轉折高點。
若無法找到時，會回傳-1
]]></Desc>
<Code><![CDATA[SetBarMode(2);

input: Price(numericseries), Length(numericsimple), LeftStrength(numericsimple), RightStrength(numericsimple), occur(numericsimple);
//價格序列、時間長度、左區間、右區間、第幾個峰值

variable: now(0), tmpnow(0), cnt(0), success(0);

now = Rightstrength;
cnt = 0;

while cnt < occur and now < Length
begin
	success = 1;
	tmpnow = now+1;
	while success = 1 and tmpnow-now <= LeftStrength
	begin
		if Price[now] < Price[tmpnow] then
			success = 0
		else tmpnow = tmpnow+1;
	end;
	
	tmpnow = now-1;
	while success = 1 and now-tmpnow <= RightStrength
	begin
		if Price[now] <= Price[tmpnow] then
			success = 0
		else tmpnow = tmpnow-1;
	end;
	
	if success = 1 then
		cnt = cnt+1;
	now = now+1;
end;

if cnt < occur then
	SwingHigh = -1
else
	swingHigh = Price[now-1];]]></Code>
<Arg><![CDATA[<Arg seed="a81e1a7b-28f7-478a-872b-e40e12b2b804" version="1"><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="LeftStrength" varname="LeftStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="RightStrength" varname="RightStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="occur" varname="occur" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0bcea2d2-bcf0-4e9d-a8a4-9a064872591f" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="38b15c9b96ee45d493dea7244056df5a" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LinearRegSlope" ID="626e6e5c42304bbea9809d1a07ae4e01" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[傳回線性迴歸的斜率，用最小平方法計算出來的。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable: _Output(0);

LinearReg(thePrice, Length, 0, _Output, value2, value3, value4);

LinearRegSlope = _Output;

]]></Code>
<Arg><![CDATA[<Arg seed="75ddb1e1-9534-46e1-97ce-0f73855a2451" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="fad46550-5c3a-4db5-a2ff-751b94b3b932" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,210d0786cfe340538e34c095bc2ba049</RefFunc>
<Extra><![CDATA[<Extra><VFID val="f303e5e8b51447afb5bec47631090a11" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MTM_MA" ID="cfdf38af68374230b140676e36c50bfd" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
對收盤價的運動量指標取再次平均價
Length: 計算期數
}
input: Length(numeric);

value1 = Momentum(Close, Length);
if CurrentBar >= Length then
	Value2 = Average(Value1, Length)
else
	Value2 = Value1;

mtm_ma = value2;

		]]></Code>
<Arg><![CDATA[<Arg seed="e8028c53-170e-4561-954d-3dcb72692f76" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="2501faee-cea0-47c2-8341-f44788fe4b25" version="1" />]]></Plots>
<RefFunc>1,239cb1c1f329431ea731982d8f5d94f2;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="8a10b22fb97b4ae0884a53debbb78a36" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="IVolatility" ID="09c46fdb219b4b7a8bdaf1279d80071b" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[計算隱含波動率]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: 
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iPrice(numericsimple);			//選擇權現價

variable: 
	var1( 0 ), 
	var2( 0 ), 
	var3( 0 ), 
	var4( 0 ) ;

condition1 = iDtoM > 0 and iStrikePrice > 0 and iSpotPrice > 0 ;
if condition1 then
	begin
	var1 = 100 ;
	var2 = bsprice(iCallPutFlag, iSpotPrice, iStrikePrice, iDtoM, iRate100, iB100, var1);
	while var2 < iPrice and var1 <= 900
		begin
		var1 = var1 + 100 ;
		var2 = bsprice(iCallPutFlag, iSpotPrice, iStrikePrice, iDtoM, iRate100, iB100, var1);
		end ;
	if var2 < iPrice then
		ivolatility= 999
	else
		begin
		var3 = 1 ;
		var4 = 100 ;
		while AbsValue( var2 - iPrice ) >= .005 and var3 < 11
			                                                                     
			                             
			begin
			var4 = var4 * .5 ;
			if var2 > iPrice then
				var1 = var1 - var4
			else if var2 < iPrice then
				var1 = var1 + var4 ;
			var2 = bsprice(iCallPutFlag, iSpotPrice, iStrikePrice, iDtoM, iRate100, iB100, var1);
			var3 = var3 + 1 ;
			end ;
		ivolatility= var1 ;
		end ;
	end
else
	ivolatility= 0 ;
]]></Code>
<Arg><![CDATA[<Arg seed="e72be002-6873-4d37-ac14-fba31c130a24" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iPrice" varname="iPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3d8d2d9e-0b46-4bf5-9dcc-64dd59e16674" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92;1,8462f7081ead4113ba3aef780bc1040f;1,6f695b87f1f047f5b162d222df2e7edf</RefFunc>
<Extra><![CDATA[<Extra><VFID val="5a0ee63b6a8845de86eb186bf99bf7c5" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BarsLast" ID="80fa4d5b31cc46ff93f8c9a1551b0529" ReturnType="1" ExecType="3" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[取得上一次條件成立到當前的K棒數]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:  pX(TrueFalseSeries);

if pX then value1 = currentbar;

BarsLast = currentbar - value1;
]]></Code>
<Arg><![CDATA[<Arg seed="3e34aaa1-4cc9-4097-8c8d-fbbb1c115326" version="1"><Param name="pX" varname="pX" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="f76b1ae7-4522-4022-954b-74c50f5036c7" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="f2690d4e90e0452d9730016e501dc2ea" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OpenM" ID="425c070d041643dcbb267162e768ae6f" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得月線的開盤價。
僅限使用於月線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

OpenM = GetField("Open","M")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="d476d7f9-9461-405e-9066-f9e59169b47e" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="7a481884-bb86-4495-bf5e-a6f8ace5b05c" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="329cbef997a443b39df1d77a213fa9ed" /><script><freq support="10;8;9;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="FastLowestBar" ID="9e8b8557026141d697518ba0ba67dcc6" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable: _Output(0);

Extremes(ThePrice, Length, -1, value1, _Output);

FastLowestbar = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="f73e3f5a-7048-44db-9e86-63166952dcc3" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="22e6ba71-14f5-4c6a-ab7f-8d0dbf0c3f04" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="3ceaf9fcc8874b9db21c1f0b2d495cb9" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MAM" ID="cfe08ebf5f0b4dce844d7fda7dfe2bd9" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
 XQ: MAM指標 :當日所計算出移動平均值減去n日前的移動平均值
 Length:計算平均期數
 Distance:相隔期間
}
Input: Length(numeric), Distance(numeric);

Value1 = Average(Close, Length);
Value2 = Average(Close, Length)[Distance];

MAM = Value1 - Value2;

		]]></Code>
<Arg><![CDATA[<Arg seed="5f1ad9dc-9533-4a33-8948-2e8102eea561" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Distance" varname="Distance" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="cef9a62d-796f-4959-9e38-24b3c3fcda81" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="bf10c4c48c8d4285a28b9d15b00f7129" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TechScore" ID="ddfa7b29d6b7403597861b78e9f6aad7" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 利用多種指標, 計算多空分數
//
variable: count(0);

// 每次計算都要reset
count = 0;

//------------------ Arron指標 -------------------//
variable: arron_up(0),arron_down(0),arron_oscillator(0);//arron oscillator
arron_up=(25-nthhighestbar(1,high,25))/25*100;
arron_down=(25-nthlowestbar(1,low,25))/25*100;
arron_oscillator=arron_up-arron_down;
if arron_up > arron_down and arron_up > 70 and arron_oscillator > 50
then count=count+1;

//------------------ 隨機漫步指標 ---------------//
variable: RWIH(0),RWIL(0);
value1 = standarddev(close,10,1);
value2 = average(truerange,10);
if value1 <> 0 and value2 <> 0 then
begin
  RWIH=(high-low[9])/value2*value1;
  RWIL=(high[9]-low)/value2*value1;
end;
  
if RWIH > RWIL
then count=count+1;

//------------------ 順勢指標 -------------------//
variable:bp1(0),abp1(0);
if truerange <> 0 then  
	bp1=(close-close[1])/truerange*100;//順勢指標

abp1=average(bp1,10);
if abp1 > 0
then count=count+1;

//---------- CMO錢德動量擺動指標 ----------------//
variable:SU(0),SD(0),CMO1(0), SUSUM(0), SDSUM(0);

if close >= close[1] then 
	SU=CLOSE-CLOSE[1]+SU[1]
else
	SU=SU[1];

if close < close[1] then 
	SD=CLOSE[1]-CLOSE+SD[1]
else
	SD=SD[1];

SUSUM = summation(SU,9);
SDSUM = summation(sd,9);
if (SUSUM+SDSUM) <> 0 then 
	cmo1=(SUSUM-SDSUM)/(SUSUM+SDSUM)*100;

if linearregslope(cmo1,5) > 0
then count=count+1;

//------------------ RSI指標 -------------------//
variable: rsiShort(0), rsiLong(0);
rsiShort=rsi(close,5);
rsiLong=rsi(close,10);
if rsiShort > rsiLong and rsiShort < 90
then count=count+1;

//----------------- MACD指標 -------------------//
variable: Dif_val(0), MACD_val(0), Osc_val(0);  
MACD(Close, 12, 26, 9, Dif_val, MACD_val, Osc_val); 
if osc_val > 0
then count=count+1;

//----------------- MTM指標 -------------------//
if mtm(10) > 0
then count=count+1;

//----------------- KD指標 --------------------//
variable:rsv1(0),k1(0),d1(0);
stochastic(9,3,3,rsv1,k1,d1);
if k1 > d1 and k1 < 80
then count=count+1;

//----------------- DMI指標 -------------------//
variable:pdi_value(0),ndi_value(0),adx_value(0);
DirectionMovement(14,pdi_value,ndi_value,adx_value);
if pdi_value > ndi_value 
then count=count+1; 

//----------------- AR指標 -------------------//
variable: arValue(0);
arValue = ar(26);
if linearregslope(arValue,5) > 0
then count=count+1;

//----------------- ACC指標 -----------------//
if acc(10) > 0
then count=count+1;

//----------------- TRIX指標 ----------------//
if trix(close,9) > trix(close,15)
then count=count+1;

//----------------- SAR指標 ----------------//
if close > SAR(0.02, 0.02, 0.2)
then count=count+1;

//----------------- 均線指標 ----------------//
if average(close,5) > average(close,12)
then count=count+1;

// Return value
//
TechScore = count;
]]></Code>
<Arg><![CDATA[<Arg seed="f29b4d44-c22a-47b5-8327-bf06e0f6ce16" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="3c7ff1c8-50c9-4585-9e55-9f1046bd5acb" version="1" />]]></Plots>
<RefFunc>1,f2404d9ffb2f49b3a38c431fcfc254b5;1,de75aec76c414cb0b78812a623b506e8;1,6bbc72256c3d4dbd9c7b3abd21a0be15;1,8c2d025a23c548d3a76fba10c22527b4;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,9c4f476d319b4f109a8dc8557099ded4;1,c1cda70a714d44999e5171fc53c95b0a;1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7;1,9e03682196e24611b2fe326b6a56433d;1,210d0786cfe340538e34c095bc2ba049;1,626e6e5c42304bbea9809d1a07ae4e01;1,d64c2a71d3ea43d985ca22ef62a5a8de;1,d02c45cba76f4163a048685f7bc4002b;1,8216021f4b11489b8faca5f2af7d0750;1,239cb1c1f329431ea731982d8f5d94f2;1,607a9823aec54a91ab43847239ccd4dd;1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56;1,847bcd706dda4a9caf2b783e181a8e42;1,7721dca8cc7242c09d21b782bbb59bd9;1,d21d5975992d4975839416bad676689d;1,162ffb45c75346a596029f2fea1df8c2;1,31df812470ed4d30af3a7592649c9054;1,1ac64461c4f341bc8e1d3ac1998fd29e</RefFunc>
<Extra><![CDATA[<Extra><VFID val="39f76aef59024aa7adae9b0ebd1954ae" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BSVega" ID="fc3be5d07b1f4cb98ce8ac7e032167bc" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[以BlackScholes模型計算選擇權Vega]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iVolity100(numericsimple);		//波動率
	
variable: _Output(0);

blackscholesmodel(iCallPutFlag,iSpotPrice,iStrikePrice,iDtoM,iRate100,iB100,iVolity100,
value1,value2,value3,_Output,value5,value6);

BSVega = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="224aa3c3-2601-441b-801c-6556ee9a79c3" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iVolity100" varname="iVolity100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b546d42b-08b2-4659-9c91-de9f41b16d60" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92;1,8462f7081ead4113ba3aef780bc1040f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="fa891810f838461da5d60f80dfc4d992" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_GetBoolean" ID="d4d89f432fb54bfe819710793eb5d003" ReturnType="2" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入一個序列(跟目前的頻率不同), 取得這個序列以此頻率的第幾筆
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// TFSeries是傳入的布林序列
// poi是要取得的位置
// 不支援XS選股、XS選股自訂排行與XS選股回測。
// 
input:
	FreqType(string), 
	TFSeries(truefalseseries),
	poi(numeric);
 
variable: _pos(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

_pos = poi; 
if _pos <= 0 then
	xfMin_GetBoolean = TFSeries[0]
else
begin
	variable: idx(0), dt(0), dt2(0);
	idx = 0;
	while _pos > 0 and idx < currentbar-1
	begin
		switch (FreqType)
		begin
			case "1","5","10","15","30","60":
				dt = xfMin_getdtvalue(FreqType, datetime[idx]);
				dt2 = xfMin_getdtvalue(FreqType, datetime[idx+1]);
				if dt <> dt2 then _pos = _pos - 1; 
				idx = idx + 1;			  		 
			default:
				dt = xfMin_getdtvalue(FreqType, Date[idx]);
				dt2 = xfMin_getdtvalue(FreqType, Date[idx+1]);
				if dt <> dt2 then _pos = _pos - 1; 
				idx = idx + 1;
		end;
	end;
	xfMin_GetBoolean = TFSeries[idx];
end;]]></Code>
<Arg><![CDATA[<Arg seed="633fe08e-e358-4f03-8e1b-133b1b69b50b" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="TFSeries" varname="TFSeries" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="poi" varname="poi" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="fe5eb7a2-0975-4259-a8d6-e975b26c383e" version="1" />]]></Plots>
<RefFunc>1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,de5550c0989b434681e18c65fcc79915</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SwingLow" ID="75b83f4dc6e246339f29560623df2624" ReturnType="1" ExecType="3" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[找出最近轉折低點的數值
判斷是否為轉折低點時，會比對該根K棒的左右兩邊各N根K棒，若左右兩邊的K棒數值皆較該根K棒數值高者，
則該點為一個轉折低點。
若無法找到時，會回傳-1
]]></Desc>
<Code><![CDATA[SetBarMode(2);

input: Price(numericseries), Length(numericsimple), LeftStrength(numericsimple), RightStrength(numericsimple), occur(numericsimple);
//價格序列、時間長度、左區間、右區間、第幾個峰值

variable: now(0), tmpnow(0), cnt(0), success(0);

now = Rightstrength;
cnt = 0;

while cnt < occur and now < Length
begin
	success = 1;
	tmpnow = now+1;
	while success = 1 and tmpnow-now <= LeftStrength
	begin
		if Price[now] > Price[tmpnow] then
			success = 0
		else tmpnow = tmpnow+1;
	end;
	
	tmpnow = now-1;
	while success = 1 and now-tmpnow <= RightStrength
	begin
		if Price[now] >= Price[tmpnow] then
			success = 0
		else tmpnow = tmpnow-1;
	end;
	
	if success = 1 then
		cnt = cnt+1;
	now = now+1;
end;

if cnt < occur then
	SwingLow = -1
else
	swingLow = Price[now-1];]]></Code>
<Arg><![CDATA[<Arg seed="1e5db7fc-34fa-4195-8026-d363ad5245ea" version="1"><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="LeftStrength" varname="LeftStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="RightStrength" varname="RightStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="occur" varname="occur" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="1a0fa83d-7c6a-432e-91db-0a10da43c4a2" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="3c0c00fd9aae44b7bb24bf51cb7349c8" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BSPrice" ID="6f695b87f1f047f5b162d222df2e7edf" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[以BlackScholes模型計算選擇權理論價]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iVolity100(numericsimple);		//波動率
	
variable: _Output(0);

blackscholesmodel(iCallPutFlag,iSpotPrice,iStrikePrice,iDtoM,iRate100,iB100,iVolity100,
_Output,value2,value3,value4,value5,value6);

BSPrice = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="7d1a050f-ecb6-4e03-a717-ec7ea787a143" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iVolity100" varname="iVolity100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="a5d1f864-0ce0-4127-9421-0013af3426d1" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92;1,8462f7081ead4113ba3aef780bc1040f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="f584b8cf81334b048a302900dc1f2c26" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthLowest" ID="f44858c38f4249558a8b2ac032207f15" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[找出數列資料中的第N個極小值]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: N (numericsimple), thePrice(numericseries), Length(numericsimple);
variable: _Output(0);

NthExtremes(thePrice, Length, N, -1, _Output, value2);

NthLowest = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="371a7ffd-e452-4736-9e5d-a5a569dc025e" version="1"><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="c74c8d4e-9127-450b-808a-ff0fe189175a" version="1" />]]></Plots>
<RefFunc>1,f2404d9ffb2f49b3a38c431fcfc254b5</RefFunc>
<Extra><![CDATA[<Extra><VFID val="90326a5bd67049fead120924e609613c" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="KeltnerMA" ID="09e25135be3f4809a7fa384484b552b3" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:n(NumericSimple);

//Keltner Channels 的繪製，是以一條指數移動平均線為中間， 然後在上下兩邊依據所謂的"平均真實範圍值"來繪出軌道的範圍來。

KeltnerMA = XAverage(close, n);



]]></Code>
<Arg><![CDATA[<Arg seed="9de89876-8c92-4ef2-849a-3df9462891dd" version="1"><Param name="n" varname="n" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="54428ff1-b928-44f3-aa03-afb1ab2000da" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b</RefFunc>
<Extra><![CDATA[<Extra><VFID val="106236b9503d440a90fd380258a70328" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OpenQ" ID="f23675d8fad74871bd7274807fb654a6" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得季線的開盤價。
僅限使用於季線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

OpenQ = GetField("Open","Q")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="1603831b-5f61-4c0f-aae3-3b25b8baf21f" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e7f8e947-611c-40c4-93b2-9fa242223270" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="da97cc542b42428d8e4a62eb87478de2" /><script><freq support="14;8;9;10;11;12;13;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TSEMFI" ID="af635b0bb6c542cba712fa703b529cdf" ReturnType="1" ExecType="3" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

variable: tp(0), tv(0), utv(0), dtv(0), pmf(0), nmf(0), mfivalue(0);

tp = (getsymbolfield("TSE.TW","最高價")+getsymbolfield("TSE.TW","最低價")+getsymbolfield("TSE.TW","收盤價")) /3;
tv = tp * getsymbolfield("TSE.TW","成交量");

if tp > tp[1] then begin
	utv = tv;
	dtv = 0;
end else begin
	utv = 0;
	dtv = tv;
end;

pmf = Average(utv, MinList(CurrentBar, 6));
nmf = Average(dtv, MinList(CurrentBar, 6));

if CurrentBar < 6 or (pmf + nmf) = 0 then
	mfivalue = 50
else 
	mfivalue = 100 * pmf /(pmf + nmf);

if mfivalue > 50 then
	tsemfi = 1
else
	tsemfi = 0;

		]]></Code>
<Arg><![CDATA[<Arg seed="0291da2e-3536-4420-9522-ea4a9a403cb8" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="e97296c0-3e7e-4469-ba32-4caf66e6dc2f" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="db4e4c2778e74d7f8c2e13abb00ed241" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DwLimit" ID="54d963a3ecba4fe9a429d1e50fca9dd7" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:refPrice(numericsimple);
variable:obup1(0),obdw1(0),STOCKUP(0),STOCKDW(0);

if date < 20150601 then begin
	obup1= refPrice*1.07;
	obdw1= refPrice*0.93;
end else begin
	obup1= refPrice*1.1;
	obdw1= refPrice*0.9;
end;

if (obup1<10 and obdw1<10) then begin
	STOCKUP = ((floor((floor(obup1*100)*100)))/100)/100;
	STOCKDW = ((floor((ceiling(obdw1*100)*100)))/100)/100;
end else if (obup1>=10 and obdw1<10) then begin
	STOCKUP = ((floor(((floor(obup1/0.05)*0.05)*100)*100))/100)/100;
	STOCKDW = ((floor((ceiling(obdw1*100)*100)))/100)/100;
end else if (obup1>=10 and obdw1>=10 and obup1<50 and obdw1<50) then begin
	STOCKUP = ((floor(((floor(obup1/0.05)*0.05)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.05)*0.05)*100)*100))/100)/100;
end else if (obup1>=50 and obdw1<50 ) then begin
	STOCKUP = ((floor(((floor(obup1/0.1)*0.1)*100)*100))/100)/100;
	STOCKDW = (ceiling(obdw1/0.05)*0.05);
end else if (obup1>=50 and obdw1>=50 and obup1<100 and obdw1<100) then begin
	STOCKUP = ((floor(((floor(obup1/0.1)*0.1)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.1)*0.1)*100)*100))/100)/100;
end else if (obup1>=100 and obdw1<100 ) then begin
	STOCKUP = ((floor(((floor(obup1/0.5)*0.5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.1)*0.1)*100)*100))/100)/100;
end else if (obup1>=100 and obdw1>=100 and obup1<500 and obdw1<500) then begin
	STOCKUP = ((floor(((floor(obup1/0.5)*0.5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.5)*0.5)*100)*100))/100)/100;
end else if (obup1>=500 and obdw1<500) then begin
	STOCKUP = ((floor(((floor(obup1/0.5)*0.5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.1)*0.1)*100)*100))/100)/100;
end else if (obup1>=500 and obdw1>=500 and obup1<1000 and obdw1<1000) then begin
	STOCKUP = ((floor(((floor(obup1/ 1)* 1)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/ 1)* 1)*100)*100))/100)/100;
end else if (obup1>=1000 and obdw1<1000) then begin
	STOCKUP = ((floor(((floor(obup1/5)*5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/ 1)* 1)*100)*100))/100)/100;
end else if (obup1>=1000 and obdw1>=1000) then begin
	STOCKUP = ((floor(((floor(obup1/5)*5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/5)*5)*100)*100))/100)/100;
end;

DwLimit = STOCKDW;]]></Code>
<Arg><![CDATA[<Arg seed="19eddb30-679b-47fb-8236-156f6b3651f4" version="1"><Param name="refPrice" varname="refPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="7388cca4-1ecc-43d6-86c2-be2a6d90422d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="af857fa30ce2491fa769914dcb12d173" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MoM" ID="5a24b5f217904930a81a074055f08762" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:MomVal(numericseries);

if barfreq <> "M" and barfreq <> "AM" then
	raiseruntimeerror("僅支援月頻率")
else
	MOM = (MomVal/MomVal[1]-1)*100;

]]></Code>
<Arg><![CDATA[<Arg seed="51077c70-8cfc-4ea8-8ee8-4a42eee8c98d" version="1"><Param name="MomVal" varname="MomVal" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="68fa3b30-28c2-489c-babb-5e7f986f13b2" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="77545ab524fc49c3aca70113456efe43" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Correlation" ID="b5033ad30f6c4b839cc3cda4dd3b6db1" ReturnType="1" ExecType="2" Folder="/統計分析/" StatusMask="2">
<Desc><![CDATA[計算變數與應變數資料序列之間的相關係數，傳回值介於-1到1之間。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:Indep(numericseries);{說明:獨立的K棒值}
input:Dep(numericseries);{說明:不獨立的K棒值}
input:Length(numericsimple);{說明:過去N期}

Correlation = -2;
if Length <= 0 then return;

Value1 = CountIf((Indep >= Indep[1] and Dep >= Dep[1]) or (Indep < Indep[1] and Dep < Dep[1]), Length); 
	
Correlation = 2 * Value1 / Length - 1;

]]></Code>
<Arg><![CDATA[<Arg seed="2e4e433d-c1fd-4aba-bb8d-afaddac89c06" version="1"><Param name="Indep" varname="Indep" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Dep" varname="Dep" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="c37b524e-9f98-4391-af1f-7fc9794eaad4" version="1" />]]></Plots>
<RefFunc>1,d80cf92ddfcc42e0a6c53ec47edebd49</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="d461a9f3dd244d8d8807e49f4c3b6682" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TrueAny" ID="1a0d56744f5a449ba941cf1b0ca7545f" ReturnType="2" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[判斷一個真偽值資料序列在某個區間長度內的值是否有任一筆為真]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:TrueAndFalse(truefalseseries), Length(numericsimple);

TrueAny = False;

for Value1 = 0 to Length - 1
begin
    if TrueAndFalse[Value1] then
    begin
        TrueAny = True;
        break;
    end;
end;
        ]]></Code>
<Arg><![CDATA[<Arg seed="17597e0d-2e39-47b9-a314-4a6c24ead042" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3b848c27-1dac-431e-9563-fa213d17b58f" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Q指標" ID="514d2535a36b415cbb0980b17fd6bc15" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:t1(numericsimple,"天期");
input:t2(numericsimple,"平均天期");
input:t3(numericsimple,"雜訊平滑天期");
variable:Qindicator(0);

value1=close-close[1];			//價格變化
value2=summation(value1,t1);	//累積價格變化
value3=average(value2,t2);
value4=absvalue(value2-value3);	//雜訊
value5=average(value4,t3);		//把雜訊移動平均


if value5 = 0 then 
	Qindicator = 0
else
	Qindicator = value3 / value5*5;

ret = Qindicator;


]]></Code>
<Arg><![CDATA[<Arg seed="e39aec8b-eebf-4e9f-9a13-7d1bc80a2777" version="1"><Param name="天期" varname="t1" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="平均天期" varname="t2" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="雜訊平滑天期" varname="t3" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0e484e82-cab3-43fe-a2a8-6ad20f4c5882" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="534ba065370646d5ba1f00ac3f4cd496" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HVolatility" ID="52ede3e3fd6241998947a34920400c95" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[計算數列的歷史波動率]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: 
	thePrice(numericseries),
	Length(numericsimple);

variable: 
	vTradingDays(SquareRoot(260));                                                  

vTradingDays = SquareRoot(260);
                                                                                
if thePrice[1] = 0 then 
	value1 = 0
else 
	value1 = Log(thePrice / thePrice[1]);

HVolatility = 100 * vTradingDays * StandardDev(value1, Length, 0) ;
]]></Code>
<Arg><![CDATA[<Arg seed="70cb91b2-5ae8-459a-a56a-70b49f41c67e" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="57738c18-9033-4062-a55c-f4433139cd49" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,9c4f476d319b4f109a8dc8557099ded4;1,c1cda70a714d44999e5171fc53c95b0a</RefFunc>
<Extra><![CDATA[<Extra><VFID val="3095afc2e9b64df193f3da30e541d3d8" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CrossOver" ID="6850ead727a842bf883a1501d030ba98" ReturnType="2" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[放入兩個序列，可以判斷是否前面的序列是否穿越後面的序列
是的話傳回True，否則傳回False]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	SeriesA(numericseries),
	SeriesB(numericseries);
 
variable:
	valA(0), valB(0), posA(0), posB(0), idx(0);

CrossOver  = false;
posA = 0;
posB = 0;
valA = SeriesA[posA];
valB = SeriesB[posB];

if valA <= valB then 
	CrossOver = false
else begin
	for idx = 1 to minlist(6, currentbar)
	begin
		posA = posA + 1;
		posB = posB + 1;
		valA = SeriesA[posA];
		valB = SeriesB[posB];
		if valA < valB then
		begin
			CrossOver = true;
			break;
		end
		else
		begin
			if valA > valB then
			begin
				CrossOver = false;
				break;
			end;
		end; 
	end;
end;
]]></Code>
<Arg><![CDATA[<Arg seed="638885bf-220d-4afe-9e48-786c182e353a" version="1"><Param name="SeriesA" varname="SeriesA" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesB" varname="SeriesB" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="cefe445c-fd38-4a0a-adad-a0aeb22d6e3a" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighY" ID="4cae5e8e25a84fea9396d567f7459b8d" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得年線的最高價。
僅限使用於年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

HighY = GetField("High","Y")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="d6043ee0-75aa-4c6f-ae35-37cae647b354" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="de683022-3b45-43ef-95f3-06c2cfb0bfe8" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="96a09a2ecb32404490b0d11e2b0f99d0" /><script><freq support="16;8;9;10;11;12;13;14;15" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CountIfARow" ID="afeb8314c6e04e23a59c10b1c152bb0d" ReturnType="1" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:TrueAndFalse(truefalseseries),Length(numericsimple);

CountIfARow = truecount(TrueAndFalse,Length);
]]></Code>
<Arg><![CDATA[<Arg seed="ff4e84a6-8a98-415a-a2da-aad3120703ec" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e3fcb93a-9279-4c5e-89d0-2d609e900eed" version="1" />]]></Plots>
<RefFunc>1,2cc2f4fe655a406aa5e49bfac4a3228e</RefFunc>
<Extra><![CDATA[<Extra><VFID val="bd0811ac2188443eaf56aaff13998ac8" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_GetBoolean" ID="066d74f514e44dc2b33d2d137adf4b34" ReturnType="2" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入一個序列(跟目前的頻率不同), 取得這個序列以此頻率的第幾筆
//
// FreqType是傳入序列的資料期別, 支援"D", "W", "M"
// TFSeries是傳入的布林序列
// poi是要取得的位置
// 
input:
	FreqType(string), 
	TFSeries(truefalseseries),
	poi(numeric);
 
variable: _pos(0);
  
_pos = poi; 
if _pos <= 0 then
	xf_GetBoolean = TFSeries[0]
else
begin
	variable: idx(0), dt(0), dt2(0);
	idx = 0;
	while _pos > 0 and idx < currentbar-1
	begin
		dt = xf_getdtvalue(FreqType, Date[idx]);
		dt2 = xf_getdtvalue(FreqType, Date[idx+1]);
		if dt <> dt2 then _pos = _pos - 1; 
		idx = idx + 1;
	end;
	xf_GetBoolean = TFSeries[idx];
end;]]></Code>
<Arg><![CDATA[<Arg seed="a41acb1c-167b-4e80-a237-106b392d0fc8" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="TFSeries" varname="TFSeries" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="poi" varname="poi" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b62a6f04-7219-45e0-9176-6b14d2a5b503" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SimpleLowest" ID="35ecad2f46b642b58d4f6babdfd8e5a7" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries),Length(numericsimple);

variable: lowValue(0);
variable: i(0);

lowValue = thePrice[0];
for i = 1 to Length-1
begin
  if thePrice[i] < lowValue then
    lowValue = thePrice[i];
end;

SimpleLowest = lowValue; 	
]]></Code>
<Arg><![CDATA[<Arg seed="ac6979f8-64b5-4498-91dc-63c0efb4d103" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="423fd6b6-5e61-4e6f-950a-d1d4c70888e4" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="ef23df06e5ef40959eff579753a95eb6" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SAR" ID="1ac64461c4f341bc8e1d3ac1998fd29e" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[SAR停損點轉向指標，或稱為拋物線型指標，為一種設定停損點相當有效力的指標。

SAR(Stop And Reverse)停損點轉向操作系統，或者被稱之為拋物線型指標(Parabolic Time/Price)，是一種隨著時間的延續，用類似於拋物曲線的追趕方式，來追趕價位行情，以便設定出買賣操作時的停損點反轉值，使得一旦行情觸及停損反轉時，可以依照訊號進行買賣的動作。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// SAR function (for SAR指標)
//
Input: AFInitial(numericsimple);
Input: AFIncrement(numericsimple);
Input: AFMax(numericsimple);

variable:
	presar(0), ep(0), upTrend(false), af(0);
	
if CurrentBar = 1 then
  begin
	if Close > Close[1] then	// 上漲
	  begin
		upTrend = true;
		sar = Low[1];
		ep = High[1];
	  end	
	else						// 下跌
	  begin
		upTrend = false;
		sar = High[1];
		ep = Low[1];
	  end;	

	af = AFInitial;
	presar = sar;
  end
else
  begin  
	sar = presar + af * (ep - presar);
	presar = sar;
	if upTrend = true then
	  begin
		if High > ep then		// 繼續破high
		  begin
			ep = High;
			af = minlist(af + AFIncrement, AFMax);
		  end;
		
		if sar >= Low then		// 反轉
		  begin
			presar = ep;
			ep = Low;
			af = AFInitial;
			upTrend = false;
		  end;	
	  end
	else
	  begin
		if Low < ep then		// 繼續破low
		  begin
			ep = Low;
			af = minlist(af + AFIncrement, AFMax);
		  end;

		if sar <= High then		// 反轉
		  begin
			presar = ep;
			ep = High;
			af = AFInitial;
			upTrend = true;
		  end;	
	  end;
  end;

]]></Code>
<Arg><![CDATA[<Arg seed="f7e3113f-a8c6-4a7d-aeea-85bb54f263d0" version="1"><Param name="AFInitial" varname="AFInitial" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="AFIncrement" varname="AFIncrement" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="AFMax" varname="AFMax" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6feea955-440d-4eb1-b8ff-f6b8f6ea79a2" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="a407c4839620402d8117a5c5b485d982" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighDays" ID="c38c8206771f4673af8fc2af928dc680" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 計算過去幾筆資料內創新高的次數
//
input: length(numeric);		// 計算天期(含當根bar)

variable: tt(0);　　
variable: ix(0); 
variable: currentHigh(0);

tt=0;
currentHigh = high[length-1];

for ix = length-2 downto 0 
begin 
	if ( high[ix] > currentHigh ) then
	begin
		tt+=1;　　
		currentHigh = high[ix];
	end; 
end;

HighDays=tt;]]></Code>
<Arg><![CDATA[<Arg seed="83a022f3-a136-42d8-9e2e-87d0de724abe" version="1"><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b44afa9c-2f27-4390-8da8-e2d1411ccb65" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="8a7ce8ecae834dbfbe3cfb1ca3b8306e" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Covariance" ID="9f01ee25cc1f435599ca8aee4c4d66d8" ReturnType="1" ExecType="2" Folder="/統計分析/" StatusMask="2">
<Desc><![CDATA[計算兩組資料序列的共變異數。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: DepValue(numericseries),
       IndepVal(numericseries),
       Length(numericsimple);

variable:
		Xb(0), Yb(0), idx(0), sum(0);

{
	Covar(x,y) = Sum((Xi-Xb)*(Yi-Yb)) / N
}

If Length <> 0 Then
Begin
    Xb = Average(IndepVal, Length);
    Yb = Average(DepValue, Length);

	sum = 0;
    For idx = 0 To Length - 1
      Begin
      	 sum = sum + (IndepVal[idx] - Xb) * (DepValue[idx] - Yb);
      End;

    Covariance = sum / Length;
End;
        ]]></Code>
<Arg><![CDATA[<Arg seed="86b9192d-3514-4cd0-bd37-adb1461ac9bd" version="1"><Param name="DepValue" varname="DepValue" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="IndepVal" varname="IndepVal" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="88782888-87e4-41fd-8ee7-10380171e672" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="50a354bb657a46eb986f0d8e6500356e" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Highest" ID="2bca774c6b7549c1b0b008d2a54b288e" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[計算序列資料的最大值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries),Length(numericsimple);

variable: _Output(0);

Extremes(thePrice, Length, 1, _Output, value2);

Highest = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="dcf29c29-c837-474e-a226-ca47ecce26e1" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8476ff66-f1ae-49ee-bc22-fbe1ee9cdc46" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="5bc4aabc78414680b595b598ddf45482" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TimeSeriesForecast" ID="911d793dc7c142c4a0c3eb4f8d22bad2" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[傳回以線性迴歸估算出在某個時點的價格預測值
]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries), Length(numericsimple), TgtBar(numericsimple);
variable: _Output(0);

LinearReg(thePrice, Length, TgtBar, value1, value2, value3, _Output);

TimeSeriesForecast = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="c64dc4c7-8894-442e-93f6-c69108fe5f4f" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="TgtBar" varname="TgtBar" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="5595e1f6-ff4e-4de0-b5ca-e293fe49631d" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,210d0786cfe340538e34c095bc2ba049</RefFunc>
<Extra><![CDATA[<Extra><VFID val="761abd7d36b8404abd3ed881be8cb264" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="WMA" ID="966999ee1cff467f9ff0315ccb773eff" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(Numeric);   //"計算期間"

variable:  Factor(0);

if Factor = 0 then Factor = 0.5 * Length * (Length+1);

if CurrentBar < Length then
	WMA = thePrice
else begin
	WMA = Length * thePrice;
	for value1 = 1 to Length - 1
		WMA += thePrice[value1] * (Length - value1);	
    WMA = WMA/Factor;
end;
]]></Code>
<Arg><![CDATA[<Arg seed="8e4f21dd-5e8c-4ce0-82c2-ec77471ad62b" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="44fecac3-ad90-4438-b5a3-e6bb9efdbeaf" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="f0238b29dd04446290dc406dbae78e7d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowQ" ID="670ecff83b7e4c19a75c4a0bcd0db093" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得季線的最低價。
僅限使用於季線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

LowQ = GetField("Low","Q")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="b93ad131-cfef-4cc7-8819-5f1f8e061cca" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3431d55f-aeeb-4f11-9bfb-ffb54e5d0d7d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="316d6736d9664be98da1d571cd020f7a" /><script><freq support="14;8;9;10;11;12;13;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_Stochastic" ID="bdf6d4140e2c4954b316120de89f2d59" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的KD指標。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率Stochastic函數(for KD/RSV相關指標)
//
// FreqType是預期要引用的頻率, 支援"D", "W", "M"
// 輸入: FreqType, SeriesH, SeriesL, SeriesC, Length, rsvt, kt
// 輸出: rsv_value, k_value, d_value
//
input:
	FreqType(string), 
	Length(numericsimple), rsvt(numericsimple), kt(numericsimple),
	rsv(numericref), k(numericref), d(numericref);
 
variable:
	maxHigh(0), minLow(0),lastK(50),lastD(50),closePeriod(0);
 
condition1 = xf_getdtvalue(FreqType, Date) <> xf_getdtvalue(FreqType, Date[1]);
if condition1 then
begin
	lastK = k[1];
	lastD = d[1];
end;

switch (FreqType)
begin
	case "D":
		maxHigh = highest(GetField("High", "D"),Length);
		minLow = lowest(GetField("Low", "D"),Length);
		closePeriod = GetField("Close", "D");

	case "W":
		maxHigh = highest(GetField("High", "W"),Length);
		minLow = lowest(GetField("Low", "W"),Length);
		closePeriod = GetField("Close", "W");

	case "M":
		maxHigh = highest(GetField("High", "M"),Length);
		minLow = lowest(GetField("Low", "M"),Length);
		closePeriod = GetField("Close", "M");

	case "AD":
		maxHigh = highest(GetField("High", "AD"),Length);
		minLow = lowest(GetField("Low", "AD"),Length);
		closePeriod = GetField("Close", "AD");

	case "AW":
		maxHigh = highest(GetField("High", "AW"),Length);
		minLow = lowest(GetField("Low", "AW"),Length);
		closePeriod = GetField("Close", "AW");

	case "AM":
		maxHigh = highest(GetField("High", "AM"),Length);
		minLow = lowest(GetField("Low", "AM"),Length);
		closePeriod = GetField("Close", "AM");

	default:
		maxHigh = highest(High,Length);
		minLow = lowest(Low,Length);
		closePeriod = Close;
end;

if maxHigh <> minLow then
	rsv = 100 * (closePeriod - minLow) / (maxHigh - minLow)
else
	rsv = 50;
 
if currentbar = 1 then
begin
	k = 50;
	d = 50;
end
else
begin
	k = (lastK * (rsvt - 1) + rsv) / rsvt;
	d = (lastD * (kt - 1) + k) / kt;
end; 
 
xf_Stochastic = 1;]]></Code>
<Arg><![CDATA[<Arg seed="f707976d-b9ea-492a-8c1f-ac890ba3643b" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="rsvt" varname="rsvt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="kt" varname="kt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="rsv" varname="rsv" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="k" varname="k" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="d" varname="d" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="208015c5-57fe-4ac2-bfcf-0fbf8593f721" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56</RefFunc>
<Extra><![CDATA[<Extra><VFID val="6fa15950f0c44d53b504a79b2531ac11" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfmin_MTM" ID="7b21286afe7843b3bf877236636f2821" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率MTM函數(for MTM指標)
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, Series, Length
//
input:
	FreqType(string),		//引用頻率
	Length(numericsimple);	//計算期間
	
if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");
 
switch (FreqType)
begin
	case  "1":
		xfMin_MTM = GetField("收盤價", "1") - GetField("收盤價", "1")[length];
	
	case  "5":
		xfMin_MTM = GetField("收盤價", "5") - GetField("收盤價", "5")[length];
	
	case "10":
		xfMin_MTM = GetField("收盤價", "10") - GetField("收盤價", "10")[length];
	
	case "15":
		xfMin_MTM = GetField("收盤價", "15") - GetField("收盤價", "15")[length];
	
	case "30":
		xfMin_MTM = GetField("收盤價", "30") - GetField("收盤價", "30")[length];
	
	case "60":
		xfMin_MTM = GetField("收盤價", "60") - GetField("收盤價", "60")[length];

	case "D":
		xfMin_MTM = GetField("收盤價", "D") - GetField("收盤價", "D")[length];

	case "W":
		xfMin_MTM = GetField("收盤價", "W") - GetField("收盤價", "W")[length];

	case "M":
		xfMin_MTM = GetField("收盤價", "M") - GetField("收盤價", "M")[length];

	case "AD":
		xfMin_MTM = GetField("收盤價", "AD") - GetField("收盤價", "AD")[length];

	case "AW":
		xfMin_MTM = GetField("收盤價", "AW") - GetField("收盤價", "AW")[length];

	case "AM":
		xfMin_MTM = GetField("收盤價", "AM") - GetField("收盤價", "AM")[length];

	default:
		xfMin_MTM = close - close[length];
end;]]></Code>
<Arg><![CDATA[<Arg seed="cdbe41be-89ae-41b4-8610-43bdf9698afc" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="4cfc7c23-48fa-4fc1-ad63-ac0c4010bd0d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="27014f02f55d476a9454b8c75e1e2d1d" /><script><freq support="2;8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TypicalPrice" ID="949e616a0b17470eb3397b099c2dec83" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[傳回技術分析的典型價。]]></Desc>
<Code><![CDATA[SetBarMode(1);

TypicalPrice = (High + Low + Close) /3;
        ]]></Code>
<Arg><![CDATA[<Arg seed="d8664289-40bd-41fe-8d1e-264e8fdfdde3" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="89e479a7-2226-48da-a32b-69fe0cd06cdb" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="00b20d52cf5d4fe6bdd523a42b6a9162" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="K_Value" ID="5f85c227b1ee430981b24d82b50fcec8" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
XQ: KD指標中的K值
Length:計算期數
RSVt:RSVt權數
}
input: Length(numeric), RSVt(numeric);
variable: _rsv(0), _k(0),_d(0);

Stochastic(Length, RSVt, RSVt, _rsv, _k, _d);

k_value = _k;


		]]></Code>
<Arg><![CDATA[<Arg seed="1ad8ef66-1c94-4ede-b1ea-887fa8796db6" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="RSVt" varname="RSVt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="f0afef59-4c50-41c9-a987-c722b03d7b91" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56;1,847bcd706dda4a9caf2b783e181a8e42</RefFunc>
<Extra><![CDATA[<Extra><VFID val="694b3e503d5745c98c267ed156d1d505" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowH" ID="cce2b31acb5e4376bf56c9cf7f3b084f" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得半年線的最低價。
僅限使用於半年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

LowH = GetField("Low","H")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="f5403d28-aa06-4681-a0aa-fc7bd17a1e44" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="48edbf81-31ac-4960-8299-3134f352862d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="c907f56a8e0b44689aa4467a1a4b189e" /><script><freq support="15;8;9;10;11;12;13;14;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VVA" ID="de20fa236d0842ed9f1e69d8cdcf0cde" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

// XQ: VVA指標
//

if High <> Low then
	Value1 = (Close - Open)/(High - Low) * Volume
else
	Value1 = 0;

If CurrentBar = 1 then
	VVA = Value1
else	
	VVA = Value1 + VVA[1];
		]]></Code>
<Arg><![CDATA[<Arg seed="1d4c48e8-9e74-41ce-85f4-e4dc8f015221" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="5ec5d55c-e025-45e5-85a8-96c0d457527e" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="194ff5ed3cc745db90da6ad85566d475" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="跌幅排行榜" ID="72af3195150d41ae9a7c2d266f51a469" ReturnType="1" ExecType="2" Folder="/排行/" StatusMask="2">
<Desc><![CDATA[自訂排行範例 - N期跌幅]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 這是一個自訂排行條件的範例
// 示範如何針對特定欄位的N期減幅進行排序
// 使用者可以自行替換成需要使用的欄位
//
// Length是期數

input:
	Length(20, numericsimple, "計算期間");
 
retval = -rateofchange(GetField("收盤價"),Length);]]></Code>
<Arg><![CDATA[<Arg seed="ea7e6bc5-20b5-49f6-a312-e70c7c4b249f" version="1"><Param name="計算期間" varname="Length" type="1" subtype="0" value="20" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="15e858fc-412f-47db-93e3-462da28decc8" version="1" />]]></Plots>
<RefFunc>1,c9f2641e5de0497cb352ace96f64236e</RefFunc>
<Extra><![CDATA[<Extra><VFID val="89c6146042eb45f380a2a798dfff7a39" /><TotalBar val="3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BSGamma" ID="36d5e40983a94cb098d9326fd69cddce" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[以BlackScholes模型計算選擇權Gamma]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iVolity100(numericsimple);		//波動率
	
variable: _Output(0);

blackscholesmodel(iCallPutFlag,iSpotPrice,iStrikePrice,iDtoM,iRate100,iB100,iVolity100,
value1,value2,_Output,value4,value5,value6);

BSGamma = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="0047faf3-c765-4248-9eae-6893d99797d7" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iVolity100" varname="iVolity100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="99cb590f-74f0-459a-850e-fe67138e70e5" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92;1,8462f7081ead4113ba3aef780bc1040f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="6578986dd2bb46489d5f1994c02884bc" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighQ" ID="b77392250361472c8c4b7fc3f5fddeeb" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得季線的最高價。
僅限使用於季線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

HighQ = GetField("High","Q")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="e11589ec-c4b2-4eca-9b8d-09cc5d8332e1" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b824cbcb-a41c-4955-8c79-ad82a9e4f733" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="72bbee8d21c84667be9a93d821eda003" /><script><freq support="14;8;9;10;11;12;13;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighestArray" ID="c361287a10cf477d9932c8a6742330cf" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[傳回陣列中的最大值]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  thePriceArray[MaxSize](NumericArray),ArraySize(numericsimple);
variable: _Output(0);

ExtremesArray(thePriceArray, ArraySize, 1, _Output, value2);

HighestArray = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="fb377232-80cc-45be-8c32-131255d1dd69" version="1"><Param name="thePriceArray" varname="thePriceArray" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="ArraySize" varname="ArraySize" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="42458f0a-fbad-4664-8da0-a6f59832938d" version="1" />]]></Plots>
<RefFunc>1,47c51598c10a47f9a0327d62189828eb</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CloseW" ID="edd5eaeb76034fd388aea89f0d1acdf4" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得週線的收盤價。
僅限使用於週線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

CloseW = GetField("Close","W")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="b8e99bbc-3057-4a36-b4fe-b5563b7d73a9" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="51c3af33-1304-4f0d-ae62-2de6d9564219" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="3c666d270bee49328270b7572948b181" /><script><freq support="9;8;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ATR" ID="e8e5ac3753db447abac5b44618fa7dc8" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
傳回平均真實區間
Length: 計算期數
}
input: Length(numeric);
ATR = Average(TrueRange, Length);


		]]></Code>
<Arg><![CDATA[<Arg seed="f46f2cac-3324-4124-a4a0-ba985d174352" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="1893c813-887c-4d32-8d55-4c537d33dc47" version="1" />]]></Plots>
<RefFunc>1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7;1,9e03682196e24611b2fe326b6a56433d;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="9c149ae5d1cd4725be92d8ce60a13ebf" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BiasDiff" ID="614da5d22ab340178b7f0d6bab7d3f6b" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
Bias function (計算乖離率差值)
輸入兩個期間數值,計算並輸出此兩期間的乖離率差
Length1: 短期期數
Length2: 長期期數
}
input: length1(numericsimple),length2(numericsimple);

BiasDiff  = Bias(Length1) - Bias(Length2);
		]]></Code>
<Arg><![CDATA[<Arg seed="929b06fe-b531-460d-9d15-5f56290d370b" version="1"><Param name="length1" varname="length1" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length2" varname="length2" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8e197537-36bb-491d-8f5f-2f867dfa18c9" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,aa300d6ee3de439ea5eeb2f9ff3a7ed2</RefFunc>
<Extra><![CDATA[<Extra><VFID val="963b2fe2834e438f91ac2423caa8da1b" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="AverageIF" ID="89f2091af8c84f7bbe02544e9b39138d" ReturnType="1" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[當某期資料符合某項判斷準則時，才將該期資料納入平均]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: TrueAndFalse(truefalseseries),
       thePrice(numericseries),
	   Length(numericsimple);

variable: variableA(0);
variable:Sum(0);
variableA = 0;
Sum = 0;
for Value1 = 0 to Length - 1
begin
    if TrueAndFalse[Value1] then 
	begin 
		variableA = variableA + 1;
		Sum = Sum + thePrice[Value1];		
	end;	
end;

if variableA > 0 then
  AverageIf = Sum/variableA
else 
  AverageIf = 0;
        ]]></Code>
<Arg><![CDATA[<Arg seed="b00ae2ee-f8a0-4be9-9a1e-930e8405e12f" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="d97d917f-4f73-485c-b665-538684b84857" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="f1701d66ace34c399cf1e5c1d627ddb6" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="FastHighest" ID="68d1f6cac97441e8aae708fb49ab31a0" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries),Length(numericsimple);

variable: _Output(0);

Extremes(thePrice, Length, 1, _Output, value2);

FastHighest = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="3cf9c273-28b8-40de-aec2-9f4c4a6135bb" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="72573347-e359-4eac-a1fc-731e5905f730" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="06e9c075b55d45699efba43f8b78e62a" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BSTheta" ID="4c73dd55900a485d969fbc8b1b5dd53c" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[以BlackScholes模型計算選擇權Theta]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iVolity100(numericsimple);		//波動率
	
variable: _Output(0);

blackscholesmodel(iCallPutFlag,iSpotPrice,iStrikePrice,iDtoM,iRate100,iB100,iVolity100,
value1,value2,value3,value4,_Output,value6);

BSTheta = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="cd91e27e-b945-4df5-ab3d-e6381ce0e5ba" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iVolity100" varname="iVolity100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="f5bc67bf-d2bd-4a20-b156-c0cc1b36d8dc" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92;1,8462f7081ead4113ba3aef780bc1040f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="44d8d0e564eb48c183e262ffcbc3d0fe" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="FastHighestBar" ID="c25914dff81b464bb32ed807dd1d4dc5" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable: _Output(0);

Extremes(ThePrice, Length, 1, value1, _Output);

FastHighestBar = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="45b02913-8c2d-4792-9fb6-fea220d330a7" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="2ecba87e-bde9-4532-a926-8cbd53faf05e" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="b9f3df902d884145994981a9fa4cf013" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="PercentB" ID="3e627a6d22e74d239ac64246bf3787a0" ReturnType="1" ExecType="1" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[// %b from BollingerBand function
//

input: 
	Price(numericseries, "數列"),
	Length(numericsimple, "天數"), 
	UpperBand(numericsimple, "上"), 
	LowerBand(numericsimple, "下");

variable: up(0), down(0), mid(0);

up = bollingerband(Price, Length, UpperBand);
down = bollingerband(Price, Length, -1 * LowerBand);

if up - down <> 0 then 
	percentb = 100 * (Price - down) / (up - down) 
else 
	percentb = 0;
]]></Code>
<Arg><![CDATA[<Arg seed="0fcb9db8-5b15-4bdc-9022-6780f4883d3b" version="1"><Param name="數列" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="天數" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="上" varname="UpperBand" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="下" varname="LowerBand" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0cbe95f2-ec72-41a9-85cd-48871dd931c6" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,8c2d025a23c548d3a76fba10c22527b4;1,9c4f476d319b4f109a8dc8557099ded4;1,c1cda70a714d44999e5171fc53c95b0a;1,5f76de57dba441808c8c784d8fa54994</RefFunc>
<Extra><![CDATA[<Extra><VFID val="5c9207c6318e49acb2e008db7e043c96" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="AvgDeviation" ID="c4e294ed436c4851ac42eb9fb79305f6" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[計算各個數值到平均值的絕對值差，將這些加起來再平均]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable:	truesum(0),
			averageprice(0),
			counter(0);
truesum = 0;
averageprice = Average(thePrice,Length);

for counter = 0 to Length - 1  begin
	truesum = truesum + AbsValue(thePrice[counter] - averageprice);
end;

AvgDeviation = truesum / Length;
        ]]></Code>
<Arg><![CDATA[<Arg seed="e5c09841-6538-4750-afeb-ac8953e55855" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="1e51f6f9-724e-4666-9188-8a53a2b23cbf" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="8cf486f741d44c8c861007d4a54ab7d6" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="YoY" ID="9ec26f1716414e6aad6802834a288bbe" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:YoYVal(numericseries);

switch(barfreq)
begin
	Case "M","AM":
		YoY = RateOfChange(YoYVal,12);
	Case "Q":
		YoY = RateOfChange(YoYVal,4);
	Case "Y":
		YoY = RateOfChange(YoYVal,1);
	default:
		raiseruntimeerror("僅支援月、季、年頻率");
end;




]]></Code>
<Arg><![CDATA[<Arg seed="39d89322-d9ad-4fb0-8cef-01e4503a2340" version="1"><Param name="YoYVal" varname="YoYVal" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="a034cc18-152b-471b-b842-9af29070ce15" version="1" />]]></Plots>
<RefFunc>1,c9f2641e5de0497cb352ace96f64236e</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="41182341d4704413aedbe2384e56cc27" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ExtremesArray" ID="47c51598c10a47f9a0327d62189828eb" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[使用這個函數來找出某個陣列的第N個極大值(極小值)]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	SourceArray[MaxSize](numericarray), 	//來源陣列
	Size(numericsimple), 					//來源陣列大小
    DscAsc(numericsimple), 					//極大值(1)或極小值(-1)
	refExtremeValue(numericref), 			//輸出極值
	refExtremeIndex(numericref);			//輸出極值陣列索引值

variable:  	price(0),
			_bar(0),
			counter(0);

if  Size < 1 or Size > MaxSize then
begin
  refExtremeValue = 0 ;
  refExtremeIndex = -1 ;
  ExtremesArray = -1 ;
  return;
end;


price = SourceArray[1];
_bar = 1;

for counter = 2 to Size 
  begin
	if (DscAsc=1 and SourceArray[counter]>price) then
	  begin
		price = SourceArray[counter];
		_bar = counter;
	  end
	else if (DscAsc=-1 and SourceArray[counter]<price) then
	  begin	
		price = SourceArray[counter];
		_bar = counter;
	  end;
  end;

refExtremeValue = price;
refExtremeIndex = _bar;

ExtremesArray = 1;
        ]]></Code>
<Arg><![CDATA[<Arg seed="44be7af4-3f8a-448b-982b-fe537b1b89b2" version="1"><Param name="SourceArray" varname="SourceArray" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="Size" varname="Size" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DscAsc" varname="DscAsc" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeValue" varname="refExtremeValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeIndex" varname="refExtremeIndex" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8c5cb6d9-a92b-48c2-af31-f0da8099262f" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BollingerBandWidth" ID="1993dfb6119f4830adab63f5ce6ee2b6" ReturnType="1" ExecType="1" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[// BollingerBand Width function
//

input: 
	Price(numericseries, "數列"),
	Length(numericsimple, "天數"), 
	UpperBand(numericsimple, "上"), 
	LowerBand(numericsimple, "下");
	
variable: 
	up(0), down(0), mid(0), bbandwidth(0);

up = bollingerband(Price, Length, UpperBand);
down = bollingerband(Price, Length, -1 * LowerBand);
mid = (up + down) / 2;

if mid <> 0 then 
	bollingerbandwidth = 100 * (up - down) / mid
else
	bollingerbandwidth = 0;
]]></Code>
<Arg><![CDATA[<Arg seed="6c73b67a-3a91-443b-b0ff-d8a4d4b71d88" version="1"><Param name="數列" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="天數" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="上" varname="UpperBand" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="下" varname="LowerBand" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8d4522ee-bea9-4c80-96cb-d772b023c3de" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,8c2d025a23c548d3a76fba10c22527b4;1,9c4f476d319b4f109a8dc8557099ded4;1,c1cda70a714d44999e5171fc53c95b0a;1,5f76de57dba441808c8c784d8fa54994</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c0349996fb56477c88ce4361e8d3db97" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Filter" ID="0dfacc591cf44cc7ae661bd5e7040957" ReturnType="2" ExecType="3" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[過濾連續出現的警示]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:  pX(TrueFalseSimple), pLength(NumericSimple);
variable: vCounter(0);

If pX Then begin
	If vCounter < pLength Then begin
			vCounter = vCounter + 1;
			Filter = False;
	end Else begin
			vCounter = 0;
			Filter = True;
	End;
end Else begin
	vCounter = vCounter + 1;
	Filter = False;
End;]]></Code>
<Arg><![CDATA[<Arg seed="39b6960a-a7c3-4221-9e4e-0e29a53da735" version="1"><Param name="pX" varname="pX" type="2" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="pLength" varname="pLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e07fd982-64d1-4b4a-95c2-a1ed259bf0c0" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NormSDist" ID="9726eaec317b4b98a68524683ea2ae92" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[傳回標準常態累加分配函數。]]></Desc>
<Code><![CDATA[SetBarMode(1);

//利用多項式計算近似值，精確度到小數點以下六位。

input: 
	zvalue(numericsimple);

variable: 
	a1(0.31938153),
    a2(-0.356563782),
    a3(1.781477937),
    a4(-1.821255978),
    a5(1.330274429),
	sqrtof2pi(2.506628275),
    gamma(0.2316419);
	
	
value1 = 1 / ( 1 + gamma * AbsValue( zvalue ) ) ;
value2 = ExpValue( -Square( zvalue ) * .5 ) / sqrtof2pi ;
value3 = 1 - value2 * ( ( ( ( ( a5 * value1 + a4 ) * value1 + a3 ) * value1 + a2 ) * value1 + a1 ) 
 * value1 ) ;

if zvalue < 0 then 
	NormSDist = 1 - value3
else
	NormSDist = value3;
]]></Code>
<Arg><![CDATA[<Arg seed="226d45fd-98b7-41a7-b234-a127bdcf60a8" version="1"><Param name="zvalue" varname="zvalue" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="5087c7d6-4335-4851-9607-87d75844d6c3" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="4b2c7ea2f4a24a40b3bfa6a580bb509a" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ERC" ID="a7ae69ad0e2c4621aa19f0292d82f23f" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
RC指標變動率的移動平均值(ERC)
Length: 計算期數
EMALength: 平滑期數
}
input: Length(numeric), EMALength(numeric);

if Close[Length] > 0 then
  value1 = (Close - Close[Length]) / Close[Length];

ERC = XAverage(value1, EMALength);

		]]></Code>
<Arg><![CDATA[<Arg seed="d845354f-f128-4831-a7c0-4025ba590ba0" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="EMALength" varname="EMALength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="734a384d-eb49-4ad2-ba0d-eee09c3055c3" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b</RefFunc>
<Extra><![CDATA[<Extra><VFID val="960d8c198eae436483527486d3ea2372" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="收盤價排行榜" ID="d605f69234764acf8713c2137ba09729" ReturnType="1" ExecType="2" Folder="/排行/" StatusMask="2">
<Desc><![CDATA[自訂排行範例 - 收盤價]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 這是一個自訂排行條件的範例
// 示範如何針對特定欄位的數值進行排序
// 使用者可以自行替換成需要使用的欄位
//
//

retval = GetField("收盤價");

{
//同理，當日漲跌幅的排行榜就會是：
retval = GetField("漲跌幅");
}]]></Code>
<Arg><![CDATA[<Arg seed="07b4621b-0f03-45e3-bfbe-aa1ae1a36104" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="aeaa633a-fc21-4547-8eda-46376b8c3475" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="34b13285dd604a9db1b48b2730a27ca4" /><TotalBar val="3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighH" ID="f46c2e624f7747469552f7f3f8e52d44" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得半年線的最高價。
僅限使用於半年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

HighH = GetField("High","H")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="e8081b8f-a9d9-4287-9c59-cc5f8dbfc0af" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="aff5b4b8-a120-4832-8da4-ad74c7fc0944" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="0ebac9fb59594396a47d92d90d89bff4" /><script><freq support="15;8;9;10;11;12;13;14;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="IsXOrder" ID="c26bc7c307a1418388ad052c3ad78636" ReturnType="2" ExecType="1" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[{
	判斷成交金額是否是大單(大單+特大單)
	
	級距表請參考:
	
	https://www.xq.com.tw/%e5%8f%b0%e8%82%a1%e9%80%90%e7%ad%86%e5%8a%9f%e8%83%bd%e8%a1%8c%e6%83%85%e7%ab%af%e7%9b%b8%e9%97%9c%e7%95%b0%e5%8b%95/	
}


input: pv(numericsimple, "成交金額");

var: intraBarPersist _open_price(0);
var: intraBarPersist _threshold(0);
var: intraBarPersist _last_date(0);

if _last_date <> Date then begin
	_last_date = Date;
	_open_price = GetField("Open", "D");
	if _open_price < 30 then 
		_threshold = 400000
	else if _open_price < 50 then 
		_threshold = 500000
	else if _open_price < 100 then 
		_threshold = 700000
	else if _open_price < 200 then 
		_threshold = 1200000
	else if _open_price < 500 then 
		_threshold = 2000000
	else
		_threshold = 2500000;
end;

if pv > _threshold then retval = true else retval = false;


]]></Code>
<Arg><![CDATA[<Arg seed="dd1ba406-0d70-49b8-b349-8f7751196bb5" version="1"><Param name="成交金額" varname="pv" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="460cead9-6f4d-4ac8-82f7-f34b909d89d7" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><ScriptComplexity val="6" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="收盤均價排行榜" ID="f3f4a8b6adc7404fa1b5b478ddc82626" ReturnType="1" ExecType="2" Folder="/排行/" StatusMask="2">
<Desc><![CDATA[自訂排行範例 - N期收盤均價]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 這是一個自訂排行條件的範例
// 示範如何針對特定欄位的N期平均進行排序
// 使用者可以自行替換成需要使用的欄位
//
// Length是期數

input:
	Length(3, numericsimple, "計算期間");

retval = Average(GetField("收盤價"),Length);

{
//如果想做均量的排行榜，只需要更換欄位為成交量：
retval = Average(GetField("成交量"),Length);
}]]></Code>
<Arg><![CDATA[<Arg seed="5365e1c9-1540-4f09-9c9e-bda8d49420b3" version="1"><Param name="計算期間" varname="Length" type="1" subtype="0" value="3" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="eb6dcdbc-2993-45ae-9645-bdbf27e6f2f7" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="b2fa3aca93d742ebb2c5e2f028270474" /><TotalBar val="3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="EnterMarketCloseTime" ID="5e70b6e85e7e4a5991406ce6fae3e042" ReturnType="2" ExecType="1" Folder="/交易相關/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[{
	判斷是否已經進入收盤階段: 用來判斷不再進場 or 平倉當日部位
	
	使用時須傳入N, 代表在最後可以送單前N分鐘就認定進入收盤階段, 
	例如如果傳1, 而且是台股的話, 那在13:24:00就會回傳True, 代表已經進入收盤階段


	請注意: 這個函數只支援台股, 以及台灣期貨市場內的常用商品, 也不考慮部分外匯期貨 or 其他市場期貨, 例如東証指
}

input: exit_period(numericsimple, "收盤前N分鐘");

var: market_close_time(0);		{ 市場收盤時間 }
var: market_lasttrade_time(0);	{ 最後可交易時間 }

if symbolexchange = "TW" then begin
	market_close_time = 134000;		{ 往後延長一點, 處理Tick可能延後收到的情形 }
	market_lasttrade_time = 132500;
end else if symbolexchange = "TF" then begin
	if daystoexpirationtf = 0 then begin
		market_lasttrade_time = 133000;
		market_close_time = 134000;	{ 往後延長一點, 處理Tick可能延後收到的情形 }
	end else begin	
		market_lasttrade_time = 134500;
		market_close_time = 135000; { 往後延長一點, 處理Tick可能延後收到的情形 }
	end;	
end else
	raiseruntimeerror("不支援此商品");

{ 往前推算N分鐘 }
market_lasttrade_time = TimeAdd(market_lasttrade_time, "M", -1 * exit_period);

if CurrentTime >= market_lasttrade_time and CurrentTime <= market_close_time then retval = true else retval = false;

]]></Code>
<Arg><![CDATA[<Arg seed="a780e97f-32e8-4abf-80a1-f3ff741c1629" version="1"><Param name="收盤前N分鐘" varname="exit_period" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="624e84a0-9791-491b-bee9-9a06b1507552" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,2661174c578842599ba79c24c1c33cd6;1,4ccd60568ab94d4085a852218b37ba80;1,7adc0732a0b144149d70fb38c0965960;1,0999f843523c4d6eb18ccc461892eaa2</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthLowestArray" ID="c7355de052fe4bd998b4a6d5ea213d7b" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[找出陣列資料中的第N個極小值]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  thePriceArray[MaxSize](NumericArrayRef), Size(numericsimple), N (numericsimple);                
variable: _Output(0);

NthExtremesArray( thePriceArray, Size, N, -1, _Output, value2) ;

NthLowestArray = _Output ;
        
        ]]></Code>
<Arg><![CDATA[<Arg seed="d2d65c8e-2a64-44d3-838c-34bfc1603f85" version="1"><Param name="thePriceArray" varname="thePriceArray" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="Size" varname="Size" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6a85033a-353c-4c10-8a31-fdbf604bbd05" version="1" />]]></Plots>
<RefFunc>1,078a531623ab4210b45048370757e8fa</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DirectionMovement" ID="7721dca8cc7242c09d21b782bbb59bd9" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[DirectionMovement計算DMI值，實際上傳回的值是Length,pdi_value,ndi_value,adx_value這些指標，DirectionMovement本身傳回1。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// DirectionMovement function (for DMI相關指標)
//	Input: length
//	Return: pdi_value(+di), ndi_value(-di), adx_value(adx)
//
input: 
	length(numericsimple),
	pdi_value(numericref),
	ndi_value(numericref),
	adx_value(numericref);
	
variable:
	padm(0), nadm(0), radx(0),
	atr(0), pdm(0), ndm(0), tr(0),
	dValue0(0), dValue1(0), dx(0),
	idx(0);

if currentbar = 1 then
 begin
	padm = close / 10000;
	nadm = padm;
	atr = padm * 5;
	radx = 20;
 end
else
 begin
	pdm = maxlist(High - High[1], 0);
	ndm = maxlist(Low[1] - Low, 0);

	if pdm < ndm then
		pdm = 0
	else 
	  begin
		if pdm > ndm then
			ndm = 0
		else
		  begin
			pdm = 0;
			ndm = 0;
		  end;		
	  end;

	if Close[1] > High then
		tr = Close[1] - Low
	else	
	  begin
		if Close[1] < Low then
			tr = High - Close[1]
		else	
			tr = High - Low;
	  end;

	padm = padm[1] + (pdm - padm[1]) / length;
	nadm = nadm[1] + (ndm - nadm[1]) / length;
	atr = atr[1] + (tr - atr[1]) / length;
	
	if atr <> 0 then begin
		dValue0 = 100 * padm / atr;
		dValue1 = 100 * nadm / atr;
	end;
	
	if dValue0 + dValue1 <> 0 then
		dx = AbsValue(100 * (dValue0 - dValue1) / (dValue0 + dValue1));

	radx = radx[1] + (dx - radx[1]) / length;
 end;

pdi_value = dValue0;
ndi_value = dValue1;
adx_value = radx;

]]></Code>
<Arg><![CDATA[<Arg seed="4b5188f3-5e80-4761-940e-a00b87942f92" version="1"><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="pdi_value" varname="pdi_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="ndi_value" varname="ndi_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="adx_value" varname="adx_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="ac7ee215-e791-491b-a97d-c531af084596" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="6c8d7734dcbd4e789ddf58934bb535dd" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="GetLastTradeDate" ID="4ccd60568ab94d4085a852218b37ba80" ReturnType="1" ExecType="2" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[傳入到期月份/年份, 回傳台灣期交所指數期貨的到期日
(不考慮國定假日等特殊事件)]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入到期月份/年份, 回傳台灣期交所指數期貨的到期日
// (不考慮國定假日等特殊事件)
//
input:  
	_ExpiredM(numericsimple),
    _ExpiredY(numericsimple);

GetLastTradeDate = NthDayofMonth(EncodeDate(_ExpiredY,_ExpiredM,1),3,3);]]></Code>
<Arg><![CDATA[<Arg seed="9d6d0fd6-f4e5-4c64-bb67-91132446ce4b" version="1"><Param name="_ExpiredM" varname="_ExpiredM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="_ExpiredY" varname="_ExpiredY" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="4e1d0c09-2061-463c-8c0e-1c83b664b09f" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,2661174c578842599ba79c24c1c33cd6</RefFunc>
<Extra><![CDATA[<Extra><VFID val="cbc9e9b602594dffa24daf8462137cbd" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_DirectionMovement" ID="a46fc11bfc3a4c45abfb6011b2be5b5a" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的DMI指標。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率DirectionMovement function (for DMI相關指標)
//
// FreqType是預期要比對的期別, 支援"D", "W", "M"
// 輸入: FreqType, Length
// Return: pdi_value(+di), ndi_value(-di), adx_value(adx)
//
input: 
	FreqType(string),		//引用頻率
	length(numericsimple),	//計算期間
	pdi_value(numericref),	//回傳+DI
	ndi_value(numericref),	//回傳-DI
	adx_value(numericref);	//回傳ADX
	
variable:
	padm(0), nadm(0), radx(0),
	LastPAdm(0), LastNAdm(0), LastRAdx(0), LastATR(0),
	atr(0), pdm(0), ndm(0), tr(0),
	dValue0(0), dValue1(0), dx(0),
	changeHigh(0),changeLow(0),closePeriod(0),
	idx(0);

//跨頻率會用到的前期值需要手動記錄
condition1 = xf_getdtvalue(FreqType, Date) <> xf_getdtvalue(FreqType, Date[1]);
if condition1 then
begin
	LastPAdm = padm[1];
	LastNAdm = nadm[1];
	LastRAdx = radx[1];
	LastATR = atr[1];
end;

//取得跨頻率會用到的變數值
switch (FreqType)
begin
	case "D":
		if GetField("Close", "D")[1] > GetField("High", "D") then
			tr = GetField("Close", "D")[1] - GetField("Low", "D")
		else if GetField("Close", "D")[1] < GetField("Low", "D") then
			tr = GetField("High", "D") - GetField("Close", "D")[1]
		else
			tr = GetField("High", "D") - GetField("Low", "D");
		changeHigh = GetField("High", "D") - GetField("High", "D")[1];
		changeLow = GetField("Low", "D")[1] - GetField("Low", "D");
		closePeriod = GetField("Close", "D");

	case "W":
		if GetField("Close", "W")[1] > GetField("High", "W") then
			tr = GetField("Close", "W")[1] - GetField("Low", "W")
		else if GetField("Close", "W")[1] < GetField("Low", "W") then
			tr = GetField("High", "W") - GetField("Close", "W")[1]
		else
			tr = GetField("High", "W") - GetField("Low", "W");
		changeHigh = GetField("High", "W") - GetField("High", "W")[1];
		changeLow = GetField("Low", "W")[1] - GetField("Low", "W");
		closePeriod = GetField("Close", "W");

	case "M":
		if GetField("Close", "M")[1] > GetField("High", "M") then
			tr = GetField("Close", "M")[1] - GetField("Low", "M")
		else if GetField("Close", "M")[1] < GetField("Low", "M") then
			tr = GetField("High", "M") - GetField("Close", "M")[1]
		else
			tr = GetField("High", "M") - GetField("Low", "M");
		changeHigh = GetField("High", "M") - GetField("High", "M")[1];
		changeLow = GetField("Low", "M")[1] - GetField("Low", "M");
		closePeriod = GetField("Close", "M");

	case "AD":
		if GetField("Close", "AD")[1] > GetField("High", "AD") then
			tr = GetField("Close", "AD")[1] - GetField("Low", "AD")
		else if GetField("Close", "AD")[1] < GetField("Low", "AD") then
			tr = GetField("High", "AD") - GetField("Close", "AD")[1]
		else
			tr = GetField("High", "AD") - GetField("Low", "AD");
		changeHigh = GetField("High", "AD") - GetField("High", "AD")[1];
		changeLow = GetField("Low", "AD")[1] - GetField("Low", "AD");
		closePeriod = GetField("Close", "AD");

	case "AW":
		if GetField("Close", "AW")[1] > GetField("High", "AW") then
			tr = GetField("Close", "AW")[1] - GetField("Low", "AW")
		else if GetField("Close", "AW")[1] < GetField("Low", "AW") then
			tr = GetField("High", "AW") - GetField("Close", "AW")[1]
		else
			tr = GetField("High", "AW") - GetField("Low", "AW");
		changeHigh = GetField("High", "AW") - GetField("High", "AW")[1];
		changeLow = GetField("Low", "AW")[1] - GetField("Low", "AW");
		closePeriod = GetField("Close", "AW");

	case "AM":
		if GetField("Close", "AM")[1] > GetField("High", "AM") then
			tr = GetField("Close", "AM")[1] - GetField("Low", "AM")
		else if GetField("Close", "AM")[1] < GetField("Low", "AM") then
			tr = GetField("High", "AM") - GetField("Close", "AM")[1]
		else
			tr = GetField("High", "AM") - GetField("Low", "AM");
		changeHigh = GetField("High", "AM") - GetField("High", "AM")[1];
		changeLow = GetField("Low", "AM")[1] - GetField("Low", "AM");
		closePeriod = GetField("Close", "AM");

	default:
		if Close[1] > High then
			tr = Close[1] - Low
		else if Close[1] < Low then
			tr = High - Close[1]
		else
			tr = High - Low;
		changeHigh = High - High[1];
		changeLow = Low[1] - Low;
		closePeriod = Close;
end;

//原始的技術指標計算
value1 = xf_GetCurrentBar(FreqType);

if value1 = 1 then
 begin
	padm = closePeriod / 10000;
	nadm = padm;
	atr = padm * 5;
	radx = 20;
 end
else
 begin
	pdm = maxlist(changeHigh, 0);
	ndm = maxlist(changeLow, 0);

	if pdm < ndm then
		pdm = 0
	else 
	  begin
		if pdm > ndm then
			ndm = 0
		else
		  begin
			pdm = 0;
			ndm = 0;
		  end;		
	  end;
	
	padm = LastPAdm + (pdm - LastPAdm) / length;
	nadm = LastNAdm + (ndm - LastNAdm) / length;
	atr = LastATR + (tr - LastATR) / length;
	
	if atr <> 0 then begin
		dValue0 = 100 * padm / atr;
		dValue1 = 100 * nadm / atr;
	end;
	
	if dValue0 + dValue1 <> 0 then
		dx = AbsValue(100 * (dValue0 - dValue1) / (dValue0 + dValue1));

	radx = LastRAdx + (dx - LastRAdx) / length;
 end;

pdi_value = dValue0;
ndi_value = dValue1;
adx_value = radx;
xf_directionmovement = 1;

]]></Code>
<Arg><![CDATA[<Arg seed="205188aa-ce16-4d5d-a8fc-b52f7c4c3dc9" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="pdi_value" varname="pdi_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="ndi_value" varname="ndi_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="adx_value" varname="adx_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0571ce24-3991-4b02-a4ee-06fca3b3627e" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,d6c8ec6b762c4f47b2ad9bfd806fea5f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="f8bd9c84e67d4a46a6253ecc15b7e92b" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowY" ID="04e30169732b43cc929ab8e68f259be2" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得年線的最低價。
僅限使用於年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

LowY = GetField("Low","Y")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="94282a5b-1827-477b-b56f-31e29b767f12" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="cd286765-f302-4db0-a1e7-2358d364b09b" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="face3113350c432eb2019c8e71b85c74" /><script><freq support="16;8;9;10;11;12;13;14;15" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_MACD" ID="233ddb3b239c47afbc4bb39cadc78be6" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的MACD指標值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率MACD函數
//
// FreqType是預期要引用的頻率, 支援"D", "W", "M"
// 輸入: FreqType, FastLength, SlowLength, MACDLength;
// 輸出: DifValue, MACDValue, OscValue;

input:
	FreqType(string),		//引用頻率
	Price(numericseries), 	
	FastLength(numericsimple), SlowLength(numericsimple), MACDLength(numericsimple),
	DifValue(numericref), MACDValue(numericref), OscValue(numericref);

DifValue = xf_XAverage(FreqType, Price, FastLength) - xf_XAverage(FreqType, Price, SlowLength);
MACDValue = xf_XAverage(FreqType, DifValue, MACDLength);
OscValue = DifValue - MACDValue;

xf_MACD = 1;]]></Code>
<Arg><![CDATA[<Arg seed="4ecebd20-d6a5-42c4-bd6f-fafeeb5ee199" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="FastLength" varname="FastLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SlowLength" varname="SlowLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="MACDLength" varname="MACDLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DifValue" varname="DifValue" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="MACDValue" varname="MACDValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="OscValue" varname="OscValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="fc7d01b4-991f-434d-9fb8-0ab0f02d6b57" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,d6c8ec6b762c4f47b2ad9bfd806fea5f;1,a631841c1a7244f9aa969b2cca247c07</RefFunc>
<Extra><![CDATA[<Extra><VFID val="793779f805cc44058c1e30c16b3c6741" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="外資連續買超排行榜" ID="24cfc3267d7e4a4484c1de9a82b9a67c" ReturnType="1" ExecType="2" Folder="/排行/" StatusMask="2">
<Desc><![CDATA[自訂排行範例 - 外資連續N期買超]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 這是一個自訂排行條件的範例
// 示範如何依外資連續N期買超的張數進行排序
// 使用者可以自行替換成需要使用的欄位
//
// Length是期數
//

input:
	Length(10, numericsimple, "計算期間");

if TrueAll(GetField("外資買賣超") > 0, Length) Then
   retval = Summation(GetField("外資買賣超"), Length)
Else
   return;

{ 
//如果要排序投信連續買超，可以改用"投信買賣超"的欄位:
if TrueAll(GetField("投信買賣超") > 0, Length) Then
   retval = Summation(GetField("投信買賣超"), Length)
Else
   return;

//如果要排序自營商連續買超，可以改用"自營商買賣超"的欄位:
if TrueAll(GetField("自營商買賣超") > 0, Length) Then
   retval = Summation(GetField("自營商買賣超"), Length)
Else
   return;
   
//可以依需要自行更換欄位
}]]></Code>
<Arg><![CDATA[<Arg seed="fb0f0f93-c815-4c8f-bd75-a087a0b4fbe2" version="1"><Param name="計算期間" varname="Length" type="1" subtype="0" value="10" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6af096d5-3ccc-45e0-b2cb-df9f478b7584" version="1" />]]></Plots>
<RefFunc>1,93ec7a47222349e7ba8a2257d29196e4;1,c122bd6485c544f2bce8f374b5c7440d</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c90c9290a6464e309401b165eb8dd850" /><TotalBar val="3" /><script><freq support="8;11;9;12;10;13" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_DirectionMovement" ID="dc58546bafca4f169bf376e4ff00dbd4" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的DMI指標。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率DirectionMovement function (for DMI相關指標)
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, Length
// Return: pdi_value(+di), ndi_value(-di), adx_value(adx)
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input: 
	FreqType(string),		//引用頻率
	length(numericsimple),	//計算期間
	pdi_value(numericref),	//回傳+DI
	ndi_value(numericref),	//回傳-DI
	adx_value(numericref);	//回傳ADX
	
variable:
	padm(0), nadm(0), radx(0),
	LastPAdm(0), LastNAdm(0), LastRAdx(0), LastATR(0),
	atr(0), pdm(0), ndm(0), tr(0),
	dValue0(0), dValue1(0), dx(0),
	changeHigh(0),changeLow(0),closePeriod(0),
	idx(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

//跨頻率會用到的前期值需要手動記錄
if FreqType="D" or FreqType="AD" or FreqType="W" or FreqType="AW" or FreqType="M" or FreqType="AM" then 
	condition1 = xfMin_getdtvalue(FreqType, Date) <> xfMin_getdtvalue(FreqType, Date[1])
else 
	condition1 = xfMin_getdtvalue(FreqType, datetime) <> xfMin_getdtvalue(FreqType, datetime[1]);
if condition1 then
begin
	LastPAdm = padm[1];
	LastNAdm = nadm[1];
	LastRAdx = radx[1];
	LastATR = atr[1];
end;

//取得跨頻率會用到的變數值
switch (FreqType)
begin
	case  "1":
		if GetField("Close", "1")[1] > GetField("High", "1") then
			tr = GetField("Close", "1")[1] - GetField("Low", "1")
		else if GetField("Close", "1")[1] < GetField("Low", "1") then
			tr = GetField("High", "1") - GetField("Close", "1")[1]
		else
			tr = GetField("High", "1") - GetField("Low", "1");
		changeHigh = GetField("High", "1") - GetField("High", "1")[1];
		changeLow = GetField("Low", "1")[1] - GetField("Low", "1");
		closePeriod = GetField("Close", "1");

	case  "5":
		if GetField("Close", "5")[1] > GetField("High", "5") then
			tr = GetField("Close", "5")[1] - GetField("Low", "5")
		else if GetField("Close", "5")[1] < GetField("Low", "5") then
			tr = GetField("High", "5") - GetField("Close", "5")[1]
		else
			tr = GetField("High", "5") - GetField("Low", "5");
		changeHigh = GetField("High", "5") - GetField("High", "5")[1];
		changeLow = GetField("Low", "5")[1] - GetField("Low", "5");
		closePeriod = GetField("Close", "5");

	case "10":
		if GetField("Close", "10")[1] > GetField("High", "10") then
			tr = GetField("Close", "10")[1] - GetField("Low", "10")
		else if GetField("Close", "10")[1] < GetField("Low", "10") then
			tr = GetField("High", "10") - GetField("Close", "10")[1]
		else
			tr = GetField("High", "10") - GetField("Low", "10");
		changeHigh = GetField("High", "10") - GetField("High", "10")[1];
		changeLow = GetField("Low", "10")[1] - GetField("Low", "10");
		closePeriod = GetField("Close", "10");

	case "15":
		if GetField("Close", "15")[1] > GetField("High", "15") then
			tr = GetField("Close", "15")[1] - GetField("Low", "15")
		else if GetField("Close", "15")[1] < GetField("Low", "15") then
			tr = GetField("High", "15") - GetField("Close", "15")[1]
		else
			tr = GetField("High", "15") - GetField("Low", "15");
		changeHigh = GetField("High", "15") - GetField("High", "15")[1];
		changeLow = GetField("Low", "15")[1] - GetField("Low", "15");
		closePeriod = GetField("Close", "15");
		
	case "30":
		if GetField("Close", "30")[1] > GetField("High", "30") then
			tr = GetField("Close", "30")[1] - GetField("Low", "30")
		else if GetField("Close", "30")[1] < GetField("Low", "30") then
			tr = GetField("High", "30") - GetField("Close", "30")[1]
		else
			tr = GetField("High", "30") - GetField("Low", "30");
		changeHigh = GetField("High", "30") - GetField("High", "30")[1];
		changeLow = GetField("Low", "30")[1] - GetField("Low", "30");
		closePeriod = GetField("Close", "30");

	case "60":
		if GetField("Close", "60")[1] > GetField("High", "60") then
			tr = GetField("Close", "60")[1] - GetField("Low", "60")
		else if GetField("Close", "60")[1] < GetField("Low", "60") then
			tr = GetField("High", "60") - GetField("Close", "60")[1]
		else
			tr = GetField("High", "60") - GetField("Low", "60");
		changeHigh = GetField("High", "60") - GetField("High", "60")[1];
		changeLow = GetField("Low", "60")[1] - GetField("Low", "60");
		closePeriod = GetField("Close", "60");

	case "D":
		if GetField("Close", "D")[1] > GetField("High", "D") then
			tr = GetField("Close", "D")[1] - GetField("Low", "D")
		else if GetField("Close", "D")[1] < GetField("Low", "D") then
			tr = GetField("High", "D") - GetField("Close", "D")[1]
		else
			tr = GetField("High", "D") - GetField("Low", "D");
		changeHigh = GetField("High", "D") - GetField("High", "D")[1];
		changeLow = GetField("Low", "D")[1] - GetField("Low", "D");
		closePeriod = GetField("Close", "D");

	case "W":
		if GetField("Close", "W")[1] > GetField("High", "W") then
			tr = GetField("Close", "W")[1] - GetField("Low", "W")
		else if GetField("Close", "W")[1] < GetField("Low", "W") then
			tr = GetField("High", "W") - GetField("Close", "W")[1]
		else
			tr = GetField("High", "W") - GetField("Low", "W");
		changeHigh = GetField("High", "W") - GetField("High", "W")[1];
		changeLow = GetField("Low", "W")[1] - GetField("Low", "W");
		closePeriod = GetField("Close", "W");

	case "M":
		if GetField("Close", "M")[1] > GetField("High", "M") then
			tr = GetField("Close", "M")[1] - GetField("Low", "M")
		else if GetField("Close", "M")[1] < GetField("Low", "M") then
			tr = GetField("High", "M") - GetField("Close", "M")[1]
		else
			tr = GetField("High", "M") - GetField("Low", "M");
		changeHigh = GetField("High", "M") - GetField("High", "M")[1];
		changeLow = GetField("Low", "M")[1] - GetField("Low", "M");
		closePeriod = GetField("Close", "M");

	case "AD":
		if GetField("Close", "AD")[1] > GetField("High", "AD") then
			tr = GetField("Close", "AD")[1] - GetField("Low", "AD")
		else if GetField("Close", "AD")[1] < GetField("Low", "AD") then
			tr = GetField("High", "AD") - GetField("Close", "AD")[1]
		else
			tr = GetField("High", "AD") - GetField("Low", "AD");
		changeHigh = GetField("High", "AD") - GetField("High", "AD")[1];
		changeLow = GetField("Low", "AD")[1] - GetField("Low", "AD");
		closePeriod = GetField("Close", "AD");

	case "AW":
		if GetField("Close", "AW")[1] > GetField("High", "AW") then
			tr = GetField("Close", "AW")[1] - GetField("Low", "AW")
		else if GetField("Close", "AW")[1] < GetField("Low", "AW") then
			tr = GetField("High", "AW") - GetField("Close", "AW")[1]
		else
			tr = GetField("High", "AW") - GetField("Low", "AW");
		changeHigh = GetField("High", "AW") - GetField("High", "AW")[1];
		changeLow = GetField("Low", "AW")[1] - GetField("Low", "AW");
		closePeriod = GetField("Close", "AW");

	case "AM":
		if GetField("Close", "AM")[1] > GetField("High", "AM") then
			tr = GetField("Close", "AM")[1] - GetField("Low", "AM")
		else if GetField("Close", "AM")[1] < GetField("Low", "AM") then
			tr = GetField("High", "AM") - GetField("Close", "AM")[1]
		else
			tr = GetField("High", "AM") - GetField("Low", "AM");
		changeHigh = GetField("High", "AM") - GetField("High", "AM")[1];
		changeLow = GetField("Low", "AM")[1] - GetField("Low", "AM");
		closePeriod = GetField("Close", "AM");

	default:
		if Close[1] > High then
			tr = Close[1] - Low
		else if Close[1] < Low then
			tr = High - Close[1]
		else
			tr = High - Low;
		changeHigh = High - High[1];
		changeLow = Low[1] - Low;
		closePeriod = Close;
end;

//原始的技術指標計算
value1 = xfMin_GetCurrentBar(FreqType);

if value1 = 1 then
 begin
	padm = closePeriod / 10000;
	nadm = padm;
	atr = padm * 5;
	radx = 20;
 end
else
 begin
	pdm = maxlist(changeHigh, 0);
	ndm = maxlist(changeLow, 0);

	if pdm < ndm then
		pdm = 0
	else 
	  begin
		if pdm > ndm then
			ndm = 0
		else
		  begin
			pdm = 0;
			ndm = 0;
		  end;		
	  end;
	
	padm = LastPAdm + (pdm - LastPAdm) / length;
	nadm = LastNAdm + (ndm - LastNAdm) / length;
	atr = LastATR + (tr - LastATR) / length;
	
	if atr <> 0 then begin
		dValue0 = 100 * padm / atr;
		dValue1 = 100 * nadm / atr;
	end;
	
	if dValue0 + dValue1 <> 0 then
		dx = AbsValue(100 * (dValue0 - dValue1) / (dValue0 + dValue1));

	radx = LastRAdx + (dx - LastRAdx) / length;
 end;

pdi_value = dValue0;
ndi_value = dValue1;
adx_value = radx;
xfMin_directionmovement = 1;

]]></Code>
<Arg><![CDATA[<Arg seed="1a7bc717-bc80-4537-bf71-d91dffebae10" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="pdi_value" varname="pdi_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="ndi_value" varname="ndi_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="adx_value" varname="adx_value" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="29d3de58-862e-4109-827e-1a846218e29c" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,aced678c83804b088f72d66788ddde3c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="035117df3a8b4bf7a33df22f9ed54f77" /><script><freq support="2;8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthHighest" ID="50196492a31d4f42821e72bbd09444ca" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[找出數列資料中的第N個極大值]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: N (numericsimple), thePrice(numericseries), Length(numericsimple);
variable: _Output(0);

NthExtremes(thePrice, Length, N, 1, _Output, value2);

NthHighest = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="d40c4c75-9acf-47df-b3c3-c0601aa8e164" version="1"><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="fa6cb71a-23e4-4418-9f7a-56966473aa46" version="1" />]]></Plots>
<RefFunc>1,f2404d9ffb2f49b3a38c431fcfc254b5</RefFunc>
<Extra><![CDATA[<Extra><VFID val="d1b86ffb1f6c465e86417f5d8f8a89f0" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="IsXLOrder" ID="e83503578ef449c6a92df72d23546943" ReturnType="2" ExecType="1" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[{
	判斷成交金額是否是特大單
	
	級距表請參考:
	
	https://www.xq.com.tw/%e5%8f%b0%e8%82%a1%e9%80%90%e7%ad%86%e5%8a%9f%e8%83%bd%e8%a1%8c%e6%83%85%e7%ab%af%e7%9b%b8%e9%97%9c%e7%95%b0%e5%8b%95/	
}


input: pv(numericsimple, "成交金額");

var: intraBarPersist _open_price(0);
var: intraBarPersist _threshold(0);
var: intraBarPersist _last_date(0);

if _last_date <> Date then begin
	_last_date = Date;
	_open_price = GetField("Open", "D");
	if _open_price < 30 then 
		_threshold = 800000
	else if _open_price < 50 then 
		_threshold = 1000000
	else if _open_price < 100 then 
		_threshold = 1200000
	else if _open_price < 200 then 
		_threshold = 2000000
	else if _open_price < 500 then 
		_threshold = 4000000
	else
		_threshold = 4000000;
end;

if pv > _threshold then retval = true else retval = false;


]]></Code>
<Arg><![CDATA[<Arg seed="bed16305-58ec-4363-8662-7eb8c5cfb310" version="1"><Param name="成交金額" varname="pv" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0d423af6-3f8e-46ef-9200-ebd70c45c8d1" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><ScriptComplexity val="6" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TRIX" ID="31df812470ed4d30af3a7592649c9054" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[TRIX指的是對股價X取TRIPLE (三次) 平滑的意思。它是對股價取三次指數移動平均( EMA，也就是MACD式平滑法 )之後的數列，再計算其變動率而得。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// TRIX function (for TRIX指標)
//
Input: price(numericseries), length(numericsimple);

value1 = XAverage(price, length);
value2 = XAverage(value1, length);
value3 = XAverage(value2, length);
	
if CurrentBar = 1 then
	TRIX = 0
else
begin
    if value3[1] <> 0 then
        TRIX = (value3 - value3[1]) / value3[1]
    else
        TRIX = 0;
end;
]]></Code>
<Arg><![CDATA[<Arg seed="4e5b92b1-93ef-4744-8860-53b10753c52f" version="1"><Param name="price" varname="price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="99cdbd54-02c5-455f-b937-64bbb3e90c64" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="193a90c84e9a4d78bb9c8a5abebf3561" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Angle" ID="9b53abb05bd943c58357ecbe2cc3f51f" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[二點間的角度]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:Date1(numeric),Date2(numeric);

variable:Date1Bar(0),Date2Bar(0),Date1Price(0),Date2Price(0),_Slope(0);

Date1Bar = getbaroffset(date1); Date1Price =Open[Date1Bar];
Date2Bar = getbaroffset(date2); Date2Price =Close[Date2Bar];


if Date1Bar > Date2Bar then 
   _Slope = (Date2Price/Date1Price-1)*100 / (Date1Bar-Date2Bar);


Angle = arcTangent(_Slope);]]></Code>
<Arg><![CDATA[<Arg seed="79f20de4-de80-4852-9b57-40352fb4ec70" version="1"><Param name="Date1" varname="Date1" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Date2" varname="Date2" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="37ae0969-4185-4447-9b0c-f1f8e088c6be" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="624d6924229a461689249bfd2110ad7e" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CountIF" ID="d80cf92ddfcc42e0a6c53ec47edebd49" ReturnType="1" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[CountIF傳回特定數目的K棒內符合某些條件的次數，傳回0以上的整數]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:TrueAndFalse(truefalseseries),Length(numericsimple);

variable: variableA(0);

variableA = 0;

for Value1 = 0 to Length - 1
begin
	if TrueAndFalse[Value1] then 	
		variableA = variableA + 1;
end;

CountIf = variableA;
         ]]></Code>
<Arg><![CDATA[<Arg seed="62133639-0cee-41c9-8744-1c8141cb7c1f" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e719d8d3-51e6-42c7-b5d4-f3b2b4e6f168" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="c7f1801add054521bf52d4a8eeab4640" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CCI" ID="75ca08eed8e641809cfba6d6c7b6a01b" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
Length : CCI指標計算期間
}
input: Length(numeric);
cci = CommodityChannel(Length);

		]]></Code>
<Arg><![CDATA[<Arg seed="0d98fde5-4193-4323-9a21-9945557888fb" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="f01048c3-cca6-49ec-a5f6-e5576f96b867" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,6673d58f85784adc88e05084868c3d49</RefFunc>
<Extra><![CDATA[<Extra><VFID val="dee3bdf5845c48a68dc880aa4182e590" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowW" ID="8fd84bf20efa49ce9c588c3bec5c8d42" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得週線的最低價。
僅限使用於週線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

LowW = GetField("Low","W")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="76413f70-c6a6-432e-afd6-0fb8d103ac90" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="02a6be8e-b286-4b2f-98b1-bbc95d4cfec4" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="093e0c6f29514806b4ddc155d6951548" /><script><freq support="9;8;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_CrossOver" ID="e670c01522de45efa7f74c7f3c15a061" ReturnType="2" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[判斷指定頻率的數列一是否由下往上穿越數列二，又稱黃金交叉。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入兩個序列(跟目前的頻率不同), 判斷是否crossover
//
// FreqType是傳入序列的資料期別, 支援"D", "W", "M"
// SeriesA, SeriesB是傳入的序列
//
input:
	FreqType(string), 
	SeriesA(numericseries),
	SeriesB(numericseries);
 
variable:
	valA(0), valB(0), posA(0), posB(0);
 
posA = 0;
posB = 0;
valA = xf_getvalue(FreqType, SeriesA, posA);
valB = xf_getvalue(FreqType, SeriesB, posB);
if valA <= valB then
begin
	xf_CrossOver = false;
	return;
end; 

variable: idx(0);
for idx = 1 to 6
begin
	posA = posA + 1;
	posB = posB + 1;
	valA = xf_getvalue(FreqType, SeriesA, posA);
	valB = xf_getvalue(FreqType, SeriesB, posB);
	if valA < valB then
	begin
		xf_CrossOver = true;
		return;
	end
	else
	begin
		if valA > valB then
		begin
			xf_CrossOver = false;
			return;
		end;
	end; 
end;
xf_CrossOver = false;]]></Code>
<Arg><![CDATA[<Arg seed="a6bbd707-d43b-4aac-8d21-a5a47354edea" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesA" varname="SeriesA" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesB" varname="SeriesB" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="ef12896c-900a-4434-91df-83ebdbacbcaa" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,ae592f43d76b43c589aaa0eb0e6ecb27</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthExtremes" ID="f2404d9ffb2f49b3a38c431fcfc254b5" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[使用這個函數來找出某個數列的第N個極大值(極小值)]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  
	SourceSeries(numericseries), 	//來源數列
	Length(numericsimple), 			//計算期間
    N(numericsimple),               //極值順序
    DscAsc(numericsimple), 			//極大值(1)或極小值(-1)
	refExtremeValue(numericref), 	//輸出極值
	refExtremeBar(numericref);		//輸出極值K棒相對位置
	

array: nthA[500](0),nthB[500](0);
variable:x(0),y(0),temp(0);


if N>Length or Length>500 then
begin
    refExtremeValue = 0;
    refExtremeBar = -1;
    NthExtremes = -1;
end
else
begin
    for x = 0 to Length -1
    begin
        nthA[x] = SourceSeries[x];
        nthB[x] = x ;
    end;
	
    for x = 0 to Length -2
	begin
		for y = x + 1 to Length -1
		begin
			if ((DscAsc=1 and nthA[x] < nthA[y])or
				(DscAsc=-1 and nthA[x] > nthA[y])) then
			begin	
				temp = nthA[ y ];
                nthA[ y ] = nthA[ x ];
                nthA[ x ] = temp;
				temp = nthB[ y ];
                nthB[ y ] = nthB[ x ];
                nthB[ x ] = temp;
			end;
		end;
	end;
    refExtremeValue = 	nthA[ N-1 ];
    refExtremeBar	= 	nthB[ N-1 ] + ExecOffset;
    NthExtremes = 1;

end;
]]></Code>
<Arg><![CDATA[<Arg seed="2a19db7f-b877-42e8-9030-fb1c9141b9ee" version="1"><Param name="SourceSeries" varname="SourceSeries" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DscAsc" varname="DscAsc" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeValue" varname="refExtremeValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeBar" varname="refExtremeBar" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="2578879f-3eb3-4539-a8c5-9bef63976c02" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="aaee0221316d4228a17608d6380b1e1d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Range" ID="b7522a72975a4d4bbc36f4fb684d6f77" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[回傳當根K棒的高低價差]]></Desc>
<Code><![CDATA[SetBarMode(1);

Range = High - Low;
        ]]></Code>
<Arg><![CDATA[<Arg seed="3c0498eb-7752-4ae2-8341-70616124168d" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="8887fa25-49e1-4997-b74b-a05568429441" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="6dfbf54b3f6c43eabe4b232b20a0d54b" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_PercentR" ID="b2a836d953c74cf586cf3ae81cdaff5a" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的PercentR]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率PercentR函數(for 威廉指標)
//
// FreqType是預期要引用的頻率, 支援"D", "W", "M"
// 輸入: FreqType, SeriesH, SeriesL, SeriesC, Length, rsvt, kt
// 輸出: rsv_value, k_value, d_value
//
input:
	FreqType(string), 
	Length(numericsimple);
 
variable:
	maxHigh(0), minLow(0),variableA(0),variableB(0),closePeriod(0);

switch (upperstr(FreqType))
begin
	case "D":
		maxHigh = highest(GetField("High", "D"),Length);
		minLow = lowest(GetField("Low", "D"),Length);
		closePeriod = GetField("Close", "D");

	case "W":
		maxHigh = highest(GetField("High", "W"),Length);
		minLow = lowest(GetField("Low", "W"),Length);
		closePeriod = GetField("Close", "W");

	case "M":
		maxHigh = highest(GetField("High", "M"),Length);
		minLow = lowest(GetField("Low", "M"),Length);
		closePeriod = GetField("Close", "M");

	case "AD":
		maxHigh = highest(GetField("High", "AD"),Length);
		minLow = lowest(GetField("Low", "AD"),Length);
		closePeriod = GetField("Close", "AD");

	case "AW":
		maxHigh = highest(GetField("High", "AW"),Length);
		minLow = lowest(GetField("Low", "AW"),Length);
		closePeriod = GetField("Close", "AW");

	case "AM":
		maxHigh = highest(GetField("High", "AM"),Length);
		minLow = lowest(GetField("Low", "AM"),Length);
		closePeriod = GetField("Close", "AM");

	default:
		maxHigh = highest(High,Length);
		minLow = lowest(Low,Length);
		closePeriod = Close;
end;

variableB = maxHigh - minLow;

if variableB <> 0 then  
	xf_PercentR = 100 - ((maxHigh - closePeriod) / variableB) * 100
else 
	xf_PercentR = 0;
]]></Code>
<Arg><![CDATA[<Arg seed="e5f8d2fa-da9a-493e-a406-e0f89ec6f223" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="990c7e04-5f4e-4631-adfa-552234042f87" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56</RefFunc>
<Extra><![CDATA[<Extra><VFID val="2c68fd94eafe447cb1ec078a6235a88e" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TrueLow" ID="81394f9cf0c8469ea5f8832700aec8b7" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得價格真實區間(TrueRange)的低點。]]></Desc>
<Code><![CDATA[SetBarMode(1);

if Close[1] < Low then TrueLow = Close[1]
else TrueLow = Low;
        ]]></Code>
<Arg><![CDATA[<Arg seed="dcb76bbf-7d0f-45fc-a757-cdd8e28142c7" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="d4865c55-5af7-4b0b-8c78-37f00f312fb8" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="b65a2e670fd74f0f9db9cb029cce3851" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_MACD" ID="3ad4a7800de14e669b2e727f7309514f" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的MACD指標值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率MACD函數
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, FastLength, SlowLength, MACDLength;
// 輸出: DifValue, MACDValue, OscValue;
// 不支援XS選股、XS選股自訂排行與XS選股回測。

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

input:
	FreqType(string),		//引用頻率
	Price(numericseries), 	
	FastLength(numericsimple), SlowLength(numericsimple), MACDLength(numericsimple),
	DifValue(numericref), MACDValue(numericref), OscValue(numericref);

DifValue = xfMin_XAverage(FreqType, Price, FastLength) - xfMin_XAverage(FreqType, Price, SlowLength);
MACDValue = xfMin_XAverage(FreqType, DifValue, MACDLength);
OscValue = DifValue - MACDValue;

xfMin_macd = 1;]]></Code>
<Arg><![CDATA[<Arg seed="85bb5805-0469-4055-964c-07bfd7be8959" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="FastLength" varname="FastLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SlowLength" varname="SlowLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="MACDLength" varname="MACDLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DifValue" varname="DifValue" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="MACDValue" varname="MACDValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="OscValue" varname="OscValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="256f69cc-0a0c-4509-834a-0ecd687352db" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,aced678c83804b088f72d66788ddde3c;1,d5dc0dcf2b6a43ea9145511423952db3</RefFunc>
<Extra><![CDATA[<Extra><VFID val="31dc67e1579f47c5a25cacf2ab6ef9b5" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BlackScholesModel" ID="8462f7081ead4113ba3aef780bc1040f" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[BlackScholes選擇權評價模型]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iVolity100(numericsimple),		//波動率
	oOptPriceValue(numericref), 	//選擇權理論價
	oDelta(numericref), 			//Delta
	oGamma(numericref), 			//Gamma
	oVega(numericref), 				//Vega
	oTheta(numericref), 			//Theta
	oRho(numericref);				//Rho

variable:
	optiontype(iff(upperstr(iCallPutFlag)="P",-1,1)),
	d1(0),d2(0),nd1(0),nd2(0),nd1_prob(0),iRate(0),iB(0),iVolity(0),
	ty(0.002739726027),
	t(iDtoM*ty);

	optiontype = iff(upperstr(iCallPutFlag)="P",-1,1);
	t = iDtoM*ty;
	
	iRate = iRate100*0.01;
	iB = iB100*0.01;
	iVolity = iff(iVolity100=0,0.00000001,iVolity100*0.01);
	t = iDtoM*ty;

    If t > 0 Then
	begin
	
        d1 = (Log(iSpotPrice / iStrikePrice) + (iB + square(iVolity) * 0.5) * t) / (iVolity * SquareRoot(t));
		d2 = d1 - iVolity * SquareRoot(t);
        Nd1 = NormSDist(d1 * optiontype);
        Nd2 = NormSDist(d2 * optiontype);
        Nd1_Prob = ExpValue( -Square(d1) * 0.5 ) * 0.398942280407;

		oOptPriceValue = (iSpotPrice * ExpValue((iB - iRate) * t) * Nd1 - iStrikePrice * ExpValue(-iRate * t) * Nd2) * optiontype;
		oDelta = ExpValue((iB - iRate) * t) * Nd1 * optiontype;
		oGamma = ExpValue((iB - iRate) * t) * Nd1_Prob / (iSpotPrice * iVolity * SquareRoot(t));
		oVega = iSpotPrice * ExpValue((iB - iRate) * t) * SquareRoot(t) * Nd1_Prob * 0.01;		
		oTheta = (-iSpotPrice * ExpValue((iB - iRate) * t) * Nd1_Prob * iVolity / (2 * SquareRoot(t)) - optiontype * ((iB - iRate) * iSpotPrice * ExpValue((iB - iRate) * t) * Nd1 + iRate * iStrikePrice * ExpValue(-iRate * t) * Nd2)) * ty;
		oRho = iff(iB <> 0, (t * iStrikePrice * ExpValue(-iRate * t) * Nd2) * optiontype * 0.0001, -t * oOptPriceValue * 0.0001);
		
	end else begin
		oOptPriceValue=maxlist((iSpotPrice - iStrikePrice) * optiontype, 0);
		oDelta=iff(iSpotPrice > iStrikePrice,0.5 * (1 + optiontype),
				iff(iSpotPrice < iStrikePrice,0.5 * (1 + optiontype),
				0.5 * optiontype));
		oGamma=iff(iSpotPrice <> iStrikePrice,0,1);
		oVega=0;
		oTheta=0;
		oRho=0;
    end;


blackscholesmodel = 1;]]></Code>
<Arg><![CDATA[<Arg seed="d691bd34-41d2-4c8e-98e6-b89904a3a8b4" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iVolity100" varname="iVolity100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="oOptPriceValue" varname="oOptPriceValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="oDelta" varname="oDelta" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="oGamma" varname="oGamma" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="oVega" varname="oVega" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="oTheta" varname="oTheta" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="oRho" varname="oRho" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="adf95769-4be6-482c-b612-dcf52ad32f96" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92</RefFunc>
<Extra><![CDATA[<Extra><VFID val="7183d77e736f4ac69d3dffac5ea8f7bd" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TrueAll" ID="93ec7a47222349e7ba8a2257d29196e4" ReturnType="2" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[判斷一個真偽值資料序列在某個區間長度內的值是否全部為真]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:TrueAndFalse(truefalseseries), Length(numericsimple);

TrueAll = True;

for Value1 = 0 to Length - 1
begin
    if TrueAndFalse[Value1] = False then
    begin
        TrueAll = False;
        break;
    end;
end;
        ]]></Code>
<Arg><![CDATA[<Arg seed="6e96574a-44ab-4c1e-8586-d99e3c5b0d2c" version="1"><Param name="TrueAndFalse" varname="TrueAndFalse" type="2" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="42da92b4-ee61-4a64-9d93-2db74c0e9b5b" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="RSquare" ID="63d7a17cf80a49098dfc97fc4b986abc" ReturnType="1" ExecType="2" Folder="/統計分析/" StatusMask="2">
<Desc><![CDATA[計算兩資料序列的R-Square]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: Indep(numericseries), Dep(numericseries), Length(numericsimple);

RSquare = Square(CoefficientR(Indep, Dep, Length));
        ]]></Code>
<Arg><![CDATA[<Arg seed="6f3ca1ec-6816-46ce-b47f-4905854d7969" version="1"><Param name="Indep" varname="Indep" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Dep" varname="Dep" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3744f1cd-6dc7-4642-993e-60ff4c4f289c" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,92fc51a453da4cd1b4448cc9a7677e84</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="1f45ba2b2d404fe7b9815115e9caed85" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MO" ID="05be2ad7fb5b4c6f95a60d09ec2f0acf" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
MO運動量震盪指標(Momentum Oscillator)可以說是
MOM運動量指標的另一種的表現方式，
它把原先以絕對數值展現的MOM指標，改成以相對的數值來展現
Length: 計算期數
}

input: Length(numeric);

 if  Close[Length] > 0  then
        mo = 100 * Close / Close[Length]
	else
	    mo=0;



		]]></Code>
<Arg><![CDATA[<Arg seed="0932c2bf-64e8-48a4-9ab7-087db295c5bf" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0f3024e6-a75b-44a1-9491-9c5dd2c82fe7" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="9acce4019d0a4cdca6558d9c3a615e81" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CommodityChannel" ID="6673d58f85784adc88e05084868c3d49" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[CCI指標(Commodity Channel Index)主要的功能在於針對商品本身所具有的週期循環特性，來尋找出行情的高低價位區來。
]]></Desc>
<Code><![CDATA[SetBarMode(2);

// CommodityChannel function (for CCI指標)
//
input: length(numericsimple);                                                 
variable: avgtp(0);
variable: idx(0);
variable: sumDist(0);

avgtp = average(High + Low + Close, length);

sumDist = 0;
for idx = 0 to length - 1 
begin
	sumDist = sumDist + AbsValue(avgtp[idx] - (High + Low + Close)[idx]); 
end ;
sumDist = sumDist / length;

if sumDist <> 0 then
  CommodityChannel = (High + Low + Close - avgtp) / (0.015 * sumDist)
else
  CommodityChannel = 0;




]]></Code>
<Arg><![CDATA[<Arg seed="07b201a2-24ab-4012-8801-7df0df7ea4e9" version="1"><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0c81210f-3f33-43c3-89fd-0ab6bd643f3e" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="b518f3e09c7446158d631cea855bdc44" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MI" ID="f591b7e4fc3d431196d558acc85f721d" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
XQ: MI 質量指標
Length:計算EMA期數
SumLength:計算總和期數
}
input: Length(numeric), SumLength(numeric);
variable: ema1(0), ema2(0), divSeries(0), mit(0);


ema1 = XAverage(High - Low, length);
ema2 = XAverage(ema1, length);

if ema2 <> 0 then
	divSeries = ema1 / ema2
else
	divSeries = 0;

if CurrentBar >= sumLength then
	mit = Summation(divSeries, sumLength)
else
	mit = 0;

MI =mit;
		]]></Code>
<Arg><![CDATA[<Arg seed="42664588-b6af-4a51-90cc-d27ebc31384c" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SumLength" varname="SumLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="06aef5df-f412-488f-8bbe-175ef1daa144" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b;1,c122bd6485c544f2bce8f374b5c7440d</RefFunc>
<Extra><![CDATA[<Extra><VFID val="e69d9222ec5b4773bafcdfb6f88eabfe" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_GetCurrentBar" ID="d6c8ec6b762c4f47b2ad9bfd806fea5f" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[傳回指定頻率的K棒編號。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 取得指定頻率的K棒編號（CurrentBar）
//
// FreqType是預期要引用的頻率, 支援"D", "W", "M"
// 輸入: FreqType
//
input:
	FreqType(string);		//引用頻率

condition1 = xf_getdtvalue(FreqType, Date) <> xf_getdtvalue(FreqType, Date[1]);
if currentbar = 1 then 
	xf_GetCurrentBar = 1
else if condition1 then
	xf_GetCurrentBar = xf_GetCurrentBar[1] + 1
else
	xf_GetCurrentBar = xf_GetCurrentBar[1];
]]></Code>
<Arg><![CDATA[<Arg seed="7c9abdfb-3a4e-4a6a-91a0-b28ae7a9948c" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="44b17b66-2a13-4b5b-be44-4b7372027ab0" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696</RefFunc>
<Extra><![CDATA[<Extra><VFID val="e1c0756fca3847a1b7fc3142aa3139a2" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ADO" ID="e44b5a475730463d9cc08a4c6a18e691" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
Accumulation／Distribution Oscillator，「聚散擺盪」指標。
傳回ADO值
}

variable: bp(0), sp(0), adot(0);

bp = High - Open;
sp = Close - Low;
if High <> low then
	adot = (bp + sp)/(2*(High - Low))*100
else
	adot = 50;

ADO =adot;

		]]></Code>
<Arg><![CDATA[<Arg seed="42dbaaa2-c364-4c8d-bfca-9edbffaaee74" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="c7e5edda-2dbf-4147-9f80-6b0717764a94" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="8bd324eeeae1476981a3e7d68e84ac18" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LinearReg" ID="210d0786cfe340538e34c095bc2ba049" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[計算線性迴歸的坡度與角度，與預測資料投影點的位置]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries);	{資料序列} 
input:Length(numericsimple); 	{資料長度}
input:target(numericsimple); 	{預期日期位置:0表示現在,-1表示未來一天,1表示過去一天}
input:_slope(numericref); 		{回傳:斜率}
input:_angle(numericref);		{回傳:弧度} 
input:intercept(numericref);	{回傳:X軸切點} 
input:forecast(numericref); 	{回傳:target日後預期值}

variable: SumX((Length* (Length+1))/2), //和
      sumX2(Length*(Length+1)*(2*Length+1)/6 ), //平方和
      sumY(0),
      SumXY(0),
      t_slope(0),
      tIntercept(0);
	
sumX2 = Length*(Length+1)*(2*Length+1)/6;
SumX = (Length* (Length+1))/2;

LinearReg = -1;
if Length < 1 then return;

variable: Xi(0);

SumXY=0; SumY =0;
for Xi = 1 to Length
Begin
   SumXY += Xi* thePrice[ Length -Xi];
   SumY  += thePrice[ Length -Xi];
End;

t_slope = IFF((Length*SumX2 -Square(SumX))<>0,
             ( Length *SumXY -SumX *SumY) / (Length*SumX2 -Square(SumX)),
			 0);
tIntercept = (SumY - t_slope*SumX)/Length;

_slope =t_slope;
_angle = arctangent(t_slope);
intercept =tIntercept;
forecast = intercept + _slope * (Length - target + ExecOffset);

LinearReg = 1;]]></Code>
<Arg><![CDATA[<Arg seed="b4aa2a3e-c589-424f-9b9b-d4bada2d462a" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="target" varname="target" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="_slope" varname="_slope" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="_angle" varname="_angle" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="intercept" varname="intercept" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="forecast" varname="forecast" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="a6be96ec-5e8c-4302-8483-3b321af10d61" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4</RefFunc>
<Extra><![CDATA[<Extra><VFID val="7fe3cbf3ab734eaab385dac8bcf46a10" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_EMA" ID="5ca0c9139242435482c5dc1a3e5f0f25" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的XQ指數移動平均。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率EMA
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, Series, Length
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string),		//引用頻率
	Series(numericseries),	//價格序列
	Length(numericsimple);	//計算期間
 
variable:
	Factor(0), lastEMA(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

if FreqType="D" or FreqType="AD" or FreqType="W" or FreqType="AW" or FreqType="M" or FreqType="AM" then 
	condition1 = xfMin_getdtvalue(FreqType, Date) <> xfMin_getdtvalue(FreqType, Date[1])
else 
	condition1 = xfMin_getdtvalue(FreqType, datetime) <> xfMin_getdtvalue(FreqType, datetime[1]);
if condition1 then
	lastEMA = xfMin_EMA[1];

value1 = xfMin_GetCurrentBar(FreqType);

if Length + 1 = 0 then Factor = 1 else Factor = 2 / (Length + 1);

if value1 = 1 then
	xfMin_EMA = Series
else if value1 <= Length then
    xfMin_EMA = (Series + (lastEMA * (value1 - 1)))/value1	
else
	xfMin_EMA = lastEMA + Factor * (Series - lastEMA);
	
	

 ]]></Code>
<Arg><![CDATA[<Arg seed="c23ec040-31f0-45f6-9dee-17fddf8d4af7" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Series" varname="Series" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="db409de0-e507-47f3-87ae-7293c53a82ee" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,aced678c83804b088f72d66788ddde3c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="7dadbe7b21944820b82b311c918af367" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Summation" ID="c122bd6485c544f2bce8f374b5c7440d" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[將指定長度區間的數列資料加總]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable:Sum(0),SumLength(0);
Sum=0;

for SumLength = 0 to Length - 1
begin 
    Sum = Sum + thePrice[SumLength];
end;

Summation = Sum;
        ]]></Code>
<Arg><![CDATA[<Arg seed="bc78fe2e-b143-44b6-bac3-38a936e85c7d" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8de04eae-9e04-49e9-a245-ef7c80e84fcb" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="7e1a26921cb54921bbb0a03ac6439218" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="IFF" ID="8c2d025a23c548d3a76fba10c22527b4" ReturnType="1" ExecType="2" Folder="/邏輯判斷/" StatusMask="2">
<Desc><![CDATA[把IF/Else的結構用函數的形式來判斷資料與回傳值。這適用於比較簡易的狀況。
傳回的值為數值
IFF(Logicoperator, TrueReturnV, FalseReturnV)]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: Logicoperator(truefalsesimple),
       TrueReturnV(numericsimple),
       FalseReturnV(numericsimple);

if Logicoperator then IFF = TrueReturnV
else IFF = FalseReturnV;
        ]]></Code>
<Arg><![CDATA[<Arg seed="918d8dcd-9e55-4dca-ba72-2fd91631cdca" version="1"><Param name="Logicoperator" varname="Logicoperator" type="2" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="TrueReturnV" varname="TrueReturnV" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="FalseReturnV" varname="FalseReturnV" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e78649e7-971c-428e-b1d0-52f56f0a05ed" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="1c8e32771b814858aace566db17f4d78" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SwingLowBar" ID="3e4bb805cbcc4089b1c70c54626501cb" ReturnType="1" ExecType="3" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[找出最近轉折低點的K棒位置。
判斷是否為轉折低點時，會比對該根K棒的左右兩邊各N根K棒，若左右兩邊的K棒數值皆較該根K棒數值高者，
則該點為一個轉折低點。
若無法找到時，會回傳-1
]]></Desc>
<Code><![CDATA[SetBarMode(2);

input: Price(numericseries), Length(numericsimple), LeftStrength(numericsimple), RightStrength(numericsimple), occur(numericsimple);
//價格序列、時間長度、左區間、右區間、第幾個峰值

variable: now(0), tmpnow(0), cnt(0), success(0);

now = Rightstrength;
cnt = 0;

while cnt < occur and now < Length
begin
	success = 1;
	tmpnow = now+1;
	while success = 1 and tmpnow-now <= LeftStrength
	begin
		if Price[now] > Price[tmpnow] then
			success = 0
		else tmpnow = tmpnow+1;
	end;
	
	tmpnow = now-1;
	while success = 1 and now-tmpnow <= RightStrength
	begin
		if Price[now] >= Price[tmpnow] then
			success = 0
		else tmpnow = tmpnow-1;
	end;
	
	if success = 1 then
		cnt = cnt+1;
	now = now+1;
end;

if cnt < occur then
	SwingLowBar = -1
else
	SwingLowBar = now-1;]]></Code>
<Arg><![CDATA[<Arg seed="db31f629-57ce-495c-b31c-9a5febf3c48c" version="1"><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="LeftStrength" varname="LeftStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="RightStrength" varname="RightStrength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="occur" varname="occur" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="4647a356-26d6-4692-9c59-2140e9b3eef7" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="d626da8202b540ec8ab189de5c3f14b2" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="AR" ID="d21d5975992d4975839416bad676689d" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
買賣氣勢強度的測試指標。
AR值高時，代表行情很活潑，當AR值介於0.25~1.85間時，屬於盤整行情。AR值低時，表示人氣不足
Length: 計算期數
}
input: Length(numeric);
variable: sum(0), art(0);

sum = Summation((Open - Low), Length);
if sum <> 0 then
	art = 100 * Summation((High - Open), length) / sum
else
	art = art[1];

AR = art;
		]]></Code>
<Arg><![CDATA[<Arg seed="10a571d2-4067-4af9-90c1-a90872c59ea6" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="5fce5727-c554-47c7-b1ef-30dde29e9c72" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d</RefFunc>
<Extra><![CDATA[<Extra><VFID val="025af6eec757442183bfb6d95fd93b99" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="RSV" ID="8fc14acbedda4e7b86a6095eea9357d9" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
XQ: RSV指標 Raw Stochastic Value
Length: 計算期數
}
input: Length(numeric);
variable: RSVt(3), Kt(3), rsvx(0), k(0), _d(0);

Stochastic(Length, RSVt, Kt, rsvx, k, _d);

RSV =rsvx;
		]]></Code>
<Arg><![CDATA[<Arg seed="a41b353b-925c-49c5-9b03-bb1815c65453" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="a6178eb9-ca7e-4806-8976-345e0df5ddae" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56;1,847bcd706dda4a9caf2b783e181a8e42</RefFunc>
<Extra><![CDATA[<Extra><VFID val="b96dfa9ee43c48659d9ee5732ba34f10" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthLowestBar" ID="6bbc72256c3d4dbd9c7b3abd21a0be15" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[回傳第N個極小值在資料數列中對起始位置(0)的偏移列]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: N (numericsimple), thePrice(numericseries), Length(numericsimple);
variable: _Output(0);

NthExtremes(thePrice, Length, N, -1, value1, _Output);

NthLowestBar = _Output;
        ]]></Code>
<Arg><![CDATA[<Arg seed="f42ad6e9-5a6c-4f9b-96e1-2c058055b1b5" version="1"><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3a103d05-4c9d-4ce2-8103-9c9c5881dc8e" version="1" />]]></Plots>
<RefFunc>1,f2404d9ffb2f49b3a38c431fcfc254b5</RefFunc>
<Extra><![CDATA[<Extra><VFID val="b27c03e60d4544689203b47968ca7b2e" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_CrossUnder" ID="d9885e3dd5444b82b84fa5339b8a1ebd" ReturnType="2" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[判斷指定頻率的數列一是否由上往下穿越數列二，又稱死亡交叉。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入兩個序列(跟目前的頻率不同), 判斷是否crossunder
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// SeriesA, SeriesB是傳入的序列
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string), 
	SeriesA(numericseries),
	SeriesB(numericseries);

variable:
	valA(0), valB(0), posA(0), posB(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");
 
posA = 0;
posB = 0;
valA = xfMin_getvalue(FreqType, SeriesA, posA);
valB = xfMin_getvalue(FreqType, SeriesB, posB);

if valA >= valB then
begin
	xfMin_CrossUnder = false;
	return;
end; 

variable: idx(0);
for idx = 1 to 6
begin
	posA = posA + 1;
	posB = posB + 1;
	valA = xfMin_getvalue(FreqType, SeriesA, posA);
	valB = xfMin_getvalue(FreqType, SeriesB, posB);
	if valA > valB then
	begin
		xfMin_CrossUnder = true;
		return;
	end
	else
	begin
		if valA < valB then
		begin
			xfMin_CrossUnder = false;
			return;
		end;
	end; 
end;
xfMin_CrossUnder = false;]]></Code>
<Arg><![CDATA[<Arg seed="1eed2ccd-7579-4966-986c-3a53ade43b25" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesA" varname="SeriesA" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SeriesB" varname="SeriesB" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="9d37cf07-fad7-4c7f-b5a8-1c65aded2d42" version="1" />]]></Plots>
<RefFunc>1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,de5550c0989b434681e18c65fcc79915;1,babf0756aef94393a6a0322ef06096e1</RefFunc>
<Extra><![CDATA[<Extra><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="UpShadow" ID="8bf9f9ddd97f4beab44e64d47f7cd4fe" ReturnType="1" ExecType="2" Folder="/趨勢分析/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[//上影線佔實體比例
SetBarMode(1);

if range = 0 then
	upshadow = 0
else 
	upshadow = (high - maxlist(open,close)) / range;

]]></Code>
<Arg><![CDATA[<Arg seed="48d03bf1-1023-484c-99d7-8bcfc6a386d2" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="347dca9d-52a1-4197-8308-a37319011a62" version="1" />]]></Plots>
<RefFunc>1,b7522a72975a4d4bbc36f4fb684d6f77</RefFunc>
<Extra><![CDATA[<Extra><VFID val="f930beba336341dcbd6e05f3cf6ad3a4" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OHLCPeriodsAgo" ID="c8ee210525474cb9b470a4dc0b564a03" ReturnType="1" ExecType="3" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[用來傳回，某特定頻率下，某特定時段以前的開盤價，最高價，最低價，收盤價]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:  
	FreqType(numericsimple), 	//指定K棒頻率，1:日線、2:週線、3:月線、3.25:季、3.5 半年、4:年線
	FreqAgo(numericsimple), 	//指定K棒位置
	refFreqOpen(numericref), 	//輸出K棒開盤價
	refFreqHigh(numericref),	//輸出K棒最高價
	refFreqLow(numericref), 	//輸出K棒最低價
	refFreqClose(numericref);	//輸出K棒收盤價
variable:
	varBarFreqInt(-1),
	varBarIndex(-1);
array:
	arrayO[200](-1),
	arrayH[200](-1),
	arrayL[200](-1),
	arrayC[200](-1);

switch (barfreq)
begin
	case "Tick":
		varBarFreqInt = 0;
	case "Min","Hour":
		varBarFreqInt = 1;
	case "D","AD":
		varBarFreqInt = 2;
	case "W","AW":
		varBarFreqInt = 3;
	case "M","AM","Q","H","Y":
		varBarFreqInt = 4;
	default:
		varBarFreqInt = -1;
end;

if  FreqAgo > 200 or FreqAgo < 0 or varBarFreqInt = -1 or varBarFreqInt > FreqType + 1 then return;

switch (FreqType)
begin
	case 2:
		condition1 = WeekofYear(Date) <> WeekofYear(Date[1]) ;
		if WeekofYear(Date[1]) =53 and  DayofWeek(Date)> DayofWeek(Date[1]) then condition1= false;
  	case 3:
		condition1 = Month(Date) <> Month(Date[1]);
	case 3.25:
	    condition1 = Mod(Month(Date),3)=1 and Mod(Month(Date[1]),3)=0 ;
	case 3.5:
	    condition1 = Mod(Month(Date),6)=1 and Mod(Month(Date[1]),6)=0 ;
	case 4:
		condition1 = Year(Date) <> Year(Date[1]);
	default:
		condition1 = Date <> Date[1];
end;

condition1 = CurrentBar = 1 or condition1;
if condition1 then
begin
	varBarIndex = varBarIndex - 1;
	if varBarIndex < 0 then varBarIndex = FreqAgo;	
	arrayO[varBarIndex] = Open;
	arrayH[varBarIndex] = High;
	arrayL[varBarIndex] = Low;
	arrayC[varBarIndex] = Close;
end
else
begin
	arrayC[varBarIndex] = Close;
	if High > arrayH[varBarIndex] then
		arrayH[varBarIndex] = High;
	if Low < arrayL[varBarIndex] then
		arrayL[varBarIndex] = Low;
end;

refFreqOpen = arrayO[Mod( varBarIndex + FreqAgo, FreqAgo + 1) ];
refFreqHigh = arrayH[Mod( varBarIndex + FreqAgo, FreqAgo + 1) ];
refFreqLow = arrayL[Mod( varBarIndex + FreqAgo, FreqAgo + 1) ];
refFreqClose = arrayC[Mod( varBarIndex + FreqAgo, FreqAgo + 1) ];
OHLCPeriodsAgo = 1;
 

        ]]></Code>
<Arg><![CDATA[<Arg seed="24c10510-fb0c-41ce-a943-3b8612e2bb7c" version="1"><Param name="FreqType" varname="FreqType" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="FreqAgo" varname="FreqAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="refFreqOpen" varname="refFreqOpen" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refFreqHigh" varname="refFreqHigh" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refFreqLow" varname="refFreqLow" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refFreqClose" varname="refFreqClose" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="85e12d7c-48d5-449c-b2e1-0d64d2e3a313" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="c830c3b6760d4858a357e7dbd803e251" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="RC" ID="9b897f8a1db340fbb7c66d347fc8f90d" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
RC指標變動率
Length: 計算期數
}
input: Length(numeric);

if  Close[Length] > 0 then
 RC = (Close - Close[Length]) / Close[Length]
else
 RC=0;


		]]></Code>
<Arg><![CDATA[<Arg seed="0028214d-9102-40de-a066-c53f7034d752" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="cae467e0-77af-4473-a6b5-5becaeef17a4" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="01b6ba7b49dd489a951137c11819789d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_GetDTValue" ID="57f222578a2c4d17b2b88b65b8f28696" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的序列值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 回傳某個日期的'normalized' value
// 用這個value來比對是否已經跨期
//
// FreqType是預期要比對的期別, 支援"D", "W", "M"
// dtValue 是目前資料序列上面的Date
//
input:
	FreqType(string), 
	dtValue(numeric);
 
switch (FreqType)
begin
	case "D" , "AD":
		xf_GetDTValue = dtValue;
	  
	case "W" , "AW":
		// 年度 * 100 + 周別, e.g. 201001, 表示是2010年的第一週
		// 
		xf_GetDTValue = Year(dtValue) * 100 + WeekofYear(dtValue);
		
		// 每年的第一週需要判斷是否和去年的最後一週重疊
		// 
		if WeekofYear(DateAdd(dtValue,"D", 1-DayofWeek(dtValue))) = 53 then 
			xf_GetDTValue = Year(DateAdd(dtValue,"D", 1-DayofWeek(dtValue))) * 100 + WeekofYear(DateAdd(dtValue,"D", 1-DayofWeek(dtValue)));
	 
	case "M" , "AM":
		// 年度 * 100 + 月別, e.g. 201001, 表示是2010年的第一個月
		//
		xf_GetDTValue = Year(dtValue) * 100 + Month(dtValue);
	 
	default:
		xf_GetDTValue = dtValue;
end;]]></Code>
<Arg><![CDATA[<Arg seed="a41d0099-4b39-461e-8d25-d5e6d328e89b" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="dtValue" varname="dtValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e83284dd-9682-4681-a99c-851bb5b85bb8" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="a808676cf9744b9fb2171f65dab37bfd" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_GetValue" ID="babf0756aef94393a6a0322ef06096e1" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[引用指定頻率的數值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入一個序列(跟目前的頻率不同), 取得這個序列以此頻率的第幾筆
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// PriceSeries是傳入的序列
// poi是要取得的位置
// 不支援XS選股、XS選股自訂排行與XS選股回測。
// 
input:
	FreqType(string), 
	PriceSeries(numericseries),
	poi(numeric);
 
variable: _pos(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

_pos = poi; 
if _pos <= 0 then
	xfMin_GetValue = PriceSeries[0]
else
begin
	variable: idx(0), dt(0), dt2(0);
	idx = 0;
	while _pos > 0 and idx < currentbar-1
	begin
		switch (FreqType)
		begin
			case "1","5","10","15","30","60":
				dt = xfMin_getdtvalue(FreqType, datetime[idx]);
				dt2 = xfMin_getdtvalue(FreqType, datetime[idx+1]);
				if dt <> dt2 then _pos = _pos - 1; 
				idx = idx + 1;			  		 
			default:
				dt = xfMin_getdtvalue(FreqType, Date[idx]);
				dt2 = xfMin_getdtvalue(FreqType, Date[idx+1]);
				if dt <> dt2 then _pos = _pos - 1; 
				idx = idx + 1;
		end;
	end;
	xfMin_GetValue = PriceSeries[idx];
end;]]></Code>
<Arg><![CDATA[<Arg seed="4f1f978d-87d0-4cd5-904e-54f6d2700d94" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="PriceSeries" varname="PriceSeries" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="poi" varname="poi" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b51623d5-4e47-4f45-9912-e8217ba265e0" version="1" />]]></Plots>
<RefFunc>1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,de5550c0989b434681e18c65fcc79915</RefFunc>
<Extra><![CDATA[<Extra><VFID val="0176b2c0e3b2440f9dcabec561143361" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="乖離率排行榜" ID="f8c828c35df14ae287f3bbe90c772caa" ReturnType="1" ExecType="2" Folder="/排行/" StatusMask="2">
<Desc><![CDATA[自訂排行範例 - 乖離率]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 這是一個自訂排行條件的範例
// 示範如何針對內建函數的回傳值進行排序
// 使用者可以自行替換成需要使用的函數
//
// Length是期數
//

input:
	Length(5, numericsimple, "計算期間");

retval = bias(Length);
]]></Code>
<Arg><![CDATA[<Arg seed="8e02c4f6-ac4b-4075-b9ec-034730fc15de" version="1"><Param name="計算期間" varname="Length" type="1" subtype="0" value="5" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="51bcd42a-11e5-417c-b92f-4b73f8c09e5c" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,aa300d6ee3de439ea5eeb2f9ff3a7ed2</RefFunc>
<Extra><![CDATA[<Extra><VFID val="d5b8efcba93b445d85657e84946d591e" /><TotalBar val="3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TurnOverRate" ID="269d51cbd0a6408ba14995f738941223" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[input:period(numericsimple);
value1=GetField("股本(億)")*10000;
value2=average(volume,period);
if value1<>0
then value3=value2/value1*100;
turnoverrate=value3;

]]></Code>
<Arg><![CDATA[<Arg seed="8b85757c-0e80-45c2-9399-5cd16bfb6917" version="1"><Param name="period" varname="period" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="6f6a41b3-66b1-4143-840d-d16f095b56c3" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="0e01cf76cbb843248511b0172c3c8cb5" /><script><freq support="8;11" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighM" ID="d69c0ba18dd04e2498a8d58cd08f9a73" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得月線的最高價。
僅限使用於月線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

HighM = GetField("High","M")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="5ab8a14e-4cf6-4ab9-a45c-7a1364e807d2" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b88841c7-cfc8-4977-ae07-46761d8c34a7" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="30e7495684084117ab289550efad549d" /><script><freq support="10;8;9;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="UpLimit" ID="d8019f26360a4faaaacfdabbc71b1b26" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:refPrice(numericsimple);
variable:obup1(0),obdw1(0),STOCKUP(0),STOCKDW(0);

if date < 20150601 then begin
	obup1= refPrice*1.07;
	obdw1= refPrice*0.93;
end else begin
	obup1= refPrice*1.1;
	obdw1= refPrice*0.9;
end;

if (obup1<10 and obdw1<10) then begin
	STOCKUP = ((floor((floor(obup1*100)*100)))/100)/100;
	STOCKDW = ((floor((ceiling(obdw1*100)*100)))/100)/100;
end else if (obup1>=10 and obdw1<10) then begin
	STOCKUP = ((floor(((floor(obup1/0.05)*0.05)*100)*100))/100)/100;
	STOCKDW = ((floor((ceiling(obdw1*100)*100)))/100)/100;
end else if (obup1>=10 and obdw1>=10 and obup1<50 and obdw1<50) then begin
	STOCKUP = ((floor(((floor(obup1/0.05)*0.05)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.05)*0.05)*100)*100))/100)/100;
end else if (obup1>=50 and obdw1<50 ) then begin
	STOCKUP = ((floor(((floor(obup1/0.1)*0.1)*100)*100))/100)/100;
	STOCKDW = (ceiling(obdw1/0.05)*0.05);
end else if (obup1>=50 and obdw1>=50 and obup1<100 and obdw1<100) then begin
	STOCKUP = ((floor(((floor(obup1/0.1)*0.1)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.1)*0.1)*100)*100))/100)/100;
end else if (obup1>=100 and obdw1<100 ) then begin
	STOCKUP = ((floor(((floor(obup1/0.5)*0.5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.1)*0.1)*100)*100))/100)/100;
end else if (obup1>=100 and obdw1>=100 and obup1<500 and obdw1<500) then begin
	STOCKUP = ((floor(((floor(obup1/0.5)*0.5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.5)*0.5)*100)*100))/100)/100;
end else if (obup1>=500 and obdw1<500) then begin
	STOCKUP = ((floor(((floor(obup1/0.5)*0.5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/0.1)*0.1)*100)*100))/100)/100;
end else if (obup1>=500 and obdw1>=500 and obup1<1000 and obdw1<1000) then begin
	STOCKUP = ((floor(((floor(obup1/ 1)* 1)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/ 1)* 1)*100)*100))/100)/100;
end else if (obup1>=1000 and obdw1<1000) then begin
	STOCKUP = ((floor(((floor(obup1/5)*5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/ 1)* 1)*100)*100))/100)/100;
end else if (obup1>=1000 and obdw1>=1000) then begin
	STOCKUP = ((floor(((floor(obup1/5)*5)*100)*100))/100)/100;
	STOCKDW = ((floor(((ceiling(obdw1/5)*5)*100)*100))/100)/100;
end;

UpLimit = STOCKUP;]]></Code>
<Arg><![CDATA[<Arg seed="01d581ba-e68d-4496-9136-c82885b90bfc" version="1"><Param name="refPrice" varname="refPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="27d0ae0c-8905-4c0e-b7cf-fe25629cdea5" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="83c83763e97340dba2f62f719f300335" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CoefficientR" ID="92fc51a453da4cd1b4448cc9a7677e84" ReturnType="1" ExecType="2" Folder="/統計分析/" StatusMask="2">
<Desc><![CDATA[給定自變數與依變數的序列並指定長度，用來計算兩個序列的相關係數。
回傳數值會介於-1到1之間。如果無法計算，會傳回-2]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:Indep(numericseries);{說明:獨立的K棒值}
input:Dep(numericseries);{說明:不獨立的K棒值}
input:Length(numericsimple);{說明:過去N期}

{
	                 Sum((Xi-Xb)*(Yi-Yb))
 r = --------------------------------------------------
	 Sqrt(Sum((Xi-Xb)(Xi-Xb)) * Sum((Yi-Yb)*(Yi-Yb)))
	
}

variable:
	idx(0), Xb(0), Yb(0), sumXiXb(0), sumYiYb(0), sumCovar(0);

	CoefficientR = 0;
	if Length <= 0 Then Return;
	
	Xb = average(Indep, Length);
	Yb = average(Dep, Length);
	
	sumXiXb = 0;
	sumYiYb = 0;
	sumCovar = 0;
	
	for idx = 0 to Length - 1 
	  begin
		sumXiXb = sumXiXb + (Indep[idx] - Xb) * (Indep[idx] - Xb);
		sumYiYb = sumYiYb + (Dep[idx] - Yb) * (Dep[idx] - Yb);
		sumCovar = sumCovar + (Indep[idx] - Xb) * (Dep[idx] - Yb);
	  end;
	
	if sumXiXb <> 0 and sumYiYb <> 0 then
	  begin
		Value1 = sumCovar / squareroot(sumXiXb * sumYiYb);
		if -1 <= Value1 and Value1 <= 1 then
			CoefficientR = Value1;
	  end;
	

        ]]></Code>
<Arg><![CDATA[<Arg seed="4c5ddeb6-fd30-4cc3-994c-46ed3c91d8b7" version="1"><Param name="Indep" varname="Indep" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Dep" varname="Dep" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e3cf6767-406f-407a-8373-de7d78982c13" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="1d515c42cbb34f5da547d065e79c434c" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="XAverage" ID="d02c45cba76f4163a048685f7bc4002b" ReturnType="1" ExecType="3" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[計算指數平滑化的移動平均數值
均價計算方式為：當期值 = (2/(n+1))*當期價格 + (n-1)/(n+1)*前期值
著名的MACD即是利用此種平滑方式]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:thePrice(numericseries); //"價格序列"
input:Length(Numeric);   //"計算期間"

variable:  Factor(0);

if length + 1 = 0 then Factor = 1 else Factor = 2 / (Length + 1);

if CurrentBar = 1 then
	XAverage = thePrice
else
	XAverage = XAverage[1] + Factor * (thePrice - XAverage[1]);
        ]]></Code>
<Arg><![CDATA[<Arg seed="d8899516-7740-4441-888a-4b3782ad7fe1" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="388bdcc6-58a0-4b21-a752-7ea356f9ce4b" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="6175a9c6eeca48b4a18548f49f2df694" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BSDelta" ID="5e90542dbb364f80a285f1e2e06aa6c3" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[以BlackScholes模型計算選擇權Delta]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	iCallPutFlag(stringsimple),	 	//C表買權、P表賣權
    iSpotPrice(numericsimple),		//標的價格
	iStrikePrice(numericsimple),	//履約價
	iDtoM(numericsimple),			//到期天數
	iRate100(numericsimple),		//無風險利率
	iB100(numericsimple),			//持有成本
									//股票選擇權 b=r-殖利率
									//期貨選擇權 b=0
									//外匯選擇權 b=r-外國無風險利率
	iVolity100(numericsimple);		//波動率
	
variable: _Output(0);

blackscholesmodel(iCallPutFlag,iSpotPrice,iStrikePrice,iDtoM,iRate100,iB100,iVolity100,
value1,_Output,value3,value4,value5,value6);

BSDelta = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="a266bcf8-9e91-4640-a566-aefb929fb1a5" version="1"><Param name="iCallPutFlag" varname="iCallPutFlag" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iSpotPrice" varname="iSpotPrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iStrikePrice" varname="iStrikePrice" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iDtoM" varname="iDtoM" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iRate100" varname="iRate100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iB100" varname="iB100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="iVolity100" varname="iVolity100" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="f2776d22-ab02-4567-bb93-3d40d123a26a" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,9726eaec317b4b98a68524683ea2ae92;1,8462f7081ead4113ba3aef780bc1040f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="3cc6f29959d8404ba7047e2a6b697a12" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Bias" ID="aa300d6ee3de439ea5eeb2f9ff3a7ed2" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算一段時間內的乖離率]]></Desc>
<Code><![CDATA[SetBarMode(1);

// Bias function (for 乖離率相關指標)
//
input: length(numericsimple);

value1 = Average(close, length);
Bias = (close - value1) * 100 / value1;

]]></Code>
<Arg><![CDATA[<Arg seed="5180906f-c4eb-42c8-8087-939d92446fa5" version="1"><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="5e421bc7-fe75-48d4-9bf5-9b5aa024159c" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="e4a1401803db434b9a10e30a0fd3796d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_XAverage" ID="a631841c1a7244f9aa969b2cca247c07" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的指數移動平均。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率XAverage
//
// FreqType是預期要比對的期別, 支援"D", "W", "M"
// 輸入: FreqType, Series, Length
//
input:
	FreqType(string),		//引用頻率
	Series(numericseries),	//價格序列
	Length(numericsimple);	//計算期間
 
variable:
	Factor(0), lastXAverage(0);

 
condition1 = xf_getdtvalue(FreqType, Date) <> xf_getdtvalue(FreqType, Date[1]);
if condition1 then
	lastXAverage = xf_XAverage[1];

value1 = xf_GetCurrentBar(FreqType);

if Length + 1 = 0 then Factor = 1 else Factor = 2 / (Length + 1);

if value1 = 1 then
	xf_XAverage = Series
else
	xf_XAverage = lastXAverage + Factor * (Series - lastXAverage);
]]></Code>
<Arg><![CDATA[<Arg seed="b44f4de4-a04a-4370-8ad8-42c3f78acfd6" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Series" varname="Series" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="68f957c6-2b32-4308-bd5b-8008b6f9bb37" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,d6c8ec6b762c4f47b2ad9bfd806fea5f</RefFunc>
<Extra><![CDATA[<Extra><VFID val="027cf3a869f048658d0199887e8b68db" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DaysToExpirationTF" ID="0999f843523c4d6eb18ccc461892eaa2" ReturnType="1" ExecType="2" Folder="/期權相關/" StatusMask="2">
<Desc><![CDATA[離到期日天數（依商品代碼）]]></Desc>
<Code><![CDATA[SetBarMode(1);

variable:string1(""),string2(""),string3("");
variable:strike(0),cpflag(""),ww(0),mm(0),yy(0);

if instr(symbol,".TF") = 0 then 
	raiseruntimeerror("僅支援台股期貨及選擇權")
else
	string1 = leftstr(symbol,strlen(symbol) - 3);

if leftstr(string1,1) = "F" or midstr(string1,3,1) = "O" then
begin
	yy = year(date);
	if leftstr(string1,1) = "F" then
		mm = strtonum(midstr(string1,5,2))
	else
		mm = strtonum(midstr(string1,4,2));
	if mm = 0 then begin
		mm = month(date);
		value1 = 0;
		while (value1 < strtonum(rightstr(string1,1)))
		begin
			daystoexpirationtf = daystoexpiration(mm,yy);
			if (daystoexpirationtf > 0) then value1 = value1 + 1;
			value99 = DateAdd(encodedate(yy,mm,1),"M",1);
			mm = month(value99);
			yy = year(value99);
		end;
		return;
	end;
	daystoexpirationtf = daystoexpiration(mm,yy);
	return;
end else if leftstr(string1,2) = "TX" then
begin 
	value99 = NthDayofMonth(date,1,3);
	daystoexpirationtf = DateDiff(value99, Date) + 1;
	return;
end;

daystoexpirationtf = -1;]]></Code>
<Arg><![CDATA[<Arg seed="66156f49-3297-4c95-99a5-dfc7fe87ac26" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="b7d71e31-aec3-4bf5-91e6-36eea3dd7ccb" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,2661174c578842599ba79c24c1c33cd6;1,4ccd60568ab94d4085a852218b37ba80;1,7adc0732a0b144149d70fb38c0965960</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c6a2acd165e247b3a04e735177b1c989" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="WeightedClose" ID="2549534038c6445884c25787277c86db" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[計算技術分析的加權平均收盤價。]]></Desc>
<Code><![CDATA[SetBarMode(1);

WeightedClose = (2 * Close + High + Low) / 4;
        ]]></Code>
<Arg><![CDATA[<Arg seed="ee14272e-a6de-48fc-a14d-91aa41bb8189" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="8e0d18d7-a8b6-4f92-87fa-3d73b7cd074d" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="69d5a0acf0b344df9125847d5e412e69" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_GetCurrentBar" ID="aced678c83804b088f72d66788ddde3c" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[傳回指定頻率的K棒編號。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 取得指定頻率的K棒編號（CurrentBar）
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string);		//引用頻率

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

if FreqType="D" or FreqType="AD" or FreqType="W" or FreqType="AW" or FreqType="M" or FreqType="AM" then 
	condition1 = xfMin_getdtvalue(FreqType, Date) <> xfMin_getdtvalue(FreqType, Date[1])
else 
	condition1 = xfMin_getdtvalue(FreqType, datetime) <> xfMin_getdtvalue(FreqType, datetime[1]);	
if currentbar = 1 then 
	xfMin_GetCurrentBar = 1
else if condition1 then
	xfMin_GetCurrentBar = xfMin_GetCurrentBar[1] + 1
else
	xfMin_GetCurrentBar = xfMin_GetCurrentBar[1];
]]></Code>
<Arg><![CDATA[<Arg seed="8f4ef553-2a49-4c85-9bb7-d36281333a52" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="7d658f5c-3354-4e65-b904-a749cb8bf714" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966</RefFunc>
<Extra><![CDATA[<Extra><VFID val="0e22b21cc7ca48929c66a76c0ae1ee77" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MA_Osc" ID="d8a1411f7aaf49d794af795f4b255592" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
 XQ: MA-Osc :移動平均線擺盪指標。將兩條不同天期的簡單移動平均線相減即得
 Length1:第1條平均線期數
 Length2:第2條平均線期數
}
input: Length1(numeric), Length2(numeric);

value1 = Average(close, Length1);
value2 = Average(close, Length2);
value3 = (value1 - value2);

ma_osc = value3;

		]]></Code>
<Arg><![CDATA[<Arg seed="e8017cf4-4f05-4027-bd48-2081d262e9dc" version="1"><Param name="Length1" varname="Length1" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length2" varname="Length2" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="dd1e4d98-4a0f-4cc4-b898-cd966ac32e52" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="3dafc21a15df4e6e9e8a15be03a33c24" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowDays" ID="a287dee8b9ac4040bdedfd1f7af308ef" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 計算過去幾筆資料內創新低的次數
//
input: length(numeric);		// 計算天期(含當根bar)

variable: tt(0);　　
variable: ix(0); 
variable: currentlow(0);

tt=0;
currentlow = low[length-1];

for ix = length-2 downto 0 
begin 
	if ( low[ix] < currentlow ) then
	begin
		tt+=1;　　
		currentlow = low[ix];
	end; 
end;

LowDays=tt;]]></Code>
<Arg><![CDATA[<Arg seed="df8a8756-8072-41bc-a705-04577aa41c1c" version="1"><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="a5b28974-c007-4f7b-9e7c-79607cc431a9" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="1e55c116377840b983dd1aebed5a8d46" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_RSI" ID="35fa7414b11748dab81393027c742be7" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的相對強弱指標數值。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率RSI函數
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, Series, Length
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string),		//引用頻率
	Series(numericseries),	//價格序列
	Length(numericsimple);	//計算期間

variable: 
	SumUp(0), SumDown(0), 
	LastSumUp(0), LastSumDown(0),LastRefSeries(Series), 
	up(0), down(0),
	closePeriod(0);
	
if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

if FreqType="D" or FreqType="AD" or FreqType="W" or FreqType="AW" or FreqType="M" or FreqType="AM" then 
	condition1 = xfMin_getdtvalue(FreqType, Date) <> xfMin_getdtvalue(FreqType, Date[1])
else 
	condition1 = xfMin_getdtvalue(FreqType, datetime) <> xfMin_getdtvalue(FreqType, datetime[1]);	
if condition1 then
begin
	LastSumUp = SumUp[1];
	LastSumDown = SumDown[1];
	LastRefSeries = Series[1];
end;

if xfMin_GetCurrentBar(FreqType) = 1 then
  begin
	SumUp = Average(maxlist(Series - LastRefSeries, 0), Length); 
	SumDown = Average(maxlist(LastRefSeries - Series, 0), Length); 
  end
else
  begin
	up = maxlist(Series - LastRefSeries, 0);
	down = maxlist(LastRefSeries - Series, 0);
	
	SumUp = LastSumUp + (up - LastSumUp) / Length;
	SumDown = LastSumDown + (down - LastSumDown) / Length;
  end;

if SumUp + SumDown = 0 then
	xfMin_RSI = 0
else
	xfMin_RSI = 100 * SumUp / (SumUp + SumDown);


]]></Code>
<Arg><![CDATA[<Arg seed="7991962f-7f3b-42d3-9174-ae44625cd2d6" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Series" varname="Series" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8225a0f3-bc34-4fd8-bea5-35ee261b3c2e" version="1" />]]></Plots>
<RefFunc>1,de5550c0989b434681e18c65fcc79915;1,8e4cc5f4d71342f9a5b6c2e5dc9a6966;1,aced678c83804b088f72d66788ddde3c;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="56c6f7a7880f4189995dbb91067286a7" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_GetValue" ID="ae592f43d76b43c589aaa0eb0e6ecb27" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[引用指定頻率的數值。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 傳入一個序列(跟目前的頻率不同), 取得這個序列以此頻率的第幾筆
//
// FreqType是傳入序列的資料期別, 支援"D", "W", "M"
// PriceSeries是傳入的序列
// poi是要取得的位置
// 
input:
	FreqType(string), 
	PriceSeries(numericseries),
	poi(numeric);
 
variable: _pos(0);
  
_pos = poi; 
if _pos <= 0 then
	xf_GetValue = PriceSeries[0]
else
begin
	variable: idx(0), dt(0), dt2(0);
	idx = 0;
	while _pos > 0 and idx < currentbar-1
	begin
		dt = xf_getdtvalue(FreqType, Date[idx]);
		dt2 = xf_getdtvalue(FreqType, Date[idx+1]);
		if dt <> dt2 then _pos = _pos - 1; 
		idx = idx + 1;
	end;
	xf_GetValue = PriceSeries[idx];
end;]]></Code>
<Arg><![CDATA[<Arg seed="f02babf3-4e2e-4d4f-9bbb-352c06d6d9c2" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="PriceSeries" varname="PriceSeries" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="poi" varname="poi" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="85962bc0-0492-45aa-8571-5f4fb39dcfd0" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696</RefFunc>
<Extra><![CDATA[<Extra><VFID val="0e24de9c91a748b8820f1dc2b4a7f7b1" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xfMin_PercentR" ID="0fc11e19f4a74059b2ab92fb56ddd210" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的PercentR]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率PercentR函數(for 威廉指標)
//
// FreqType是預期要比對的期別, 支援 "1", "5", "10", "15", "30", "60", "D", "W", "M", "AD", "AW", "AM"
// 輸入: FreqType, SeriesH, SeriesL, SeriesC, Length, rsvt, kt
// 輸出: rsv_value, k_value, d_value
// 不支援XS選股、XS選股自訂排行與XS選股回測。
//
input:
	FreqType(string), 
	Length(numericsimple);
 
variable:
	maxHigh(0), minLow(0),variableA(0),variableB(0),closePeriod(0);

if getinfo("Instance")=3 or getinfo("Instance")=31 then raiseruntimeerror("此函數不支援XS選股與XS選股自訂排行");

switch (upperstr(FreqType))
begin
	case  "1":
		maxHigh = simplehighest(GetField("High", "1"),Length);
		minLow = simplelowest(GetField("Low", "1"),Length);
		closePeriod = GetField("Close", "1");	

	case  "5":
		maxHigh = simplehighest(GetField("High", "5"),Length);
		minLow = simplelowest(GetField("Low", "5"),Length);
		closePeriod = GetField("Close", "5");
		
	case "10":
		maxHigh = simplehighest(GetField("High", "10"),Length);
		minLow = simplelowest(GetField("Low", "10"),Length);
		closePeriod = GetField("Close", "10");
	
	case "15":
		maxHigh = simplehighest(GetField("High", "15"),Length);
		minLow = simplelowest(GetField("Low", "15"),Length);
		closePeriod = GetField("Close", "15");
	
	case "30":
		maxHigh = simplehighest(GetField("High", "30"),Length);
		minLow = simplelowest(GetField("Low", "30"),Length);
		closePeriod = GetField("Close", "30");
	
	case "60":
		maxHigh = simplehighest(GetField("High", "60"),Length);
		minLow = simplelowest(GetField("Low", "60"),Length);
		closePeriod = GetField("Close", "60");

	case "D":
		maxHigh = simplehighest(GetField("High", "D"),Length);
		minLow = simplelowest(GetField("Low", "D"),Length);
		closePeriod = GetField("Close", "D");

	case "W":
		maxHigh = simplehighest(GetField("High", "W"),Length);
		minLow = simplelowest(GetField("Low", "W"),Length);
		closePeriod = GetField("Close", "W");

	case "M":
		maxHigh = simplehighest(GetField("High", "M"),Length);
		minLow = simplelowest(GetField("Low", "M"),Length);
		closePeriod = GetField("Close", "M");

	case "AD":
		maxHigh = simplehighest(GetField("High", "AD"),Length);
		minLow = simplelowest(GetField("Low", "AD"),Length);
		closePeriod = GetField("Close", "AD");

	case "AW":
		maxHigh = simplehighest(GetField("High", "AW"),Length);
		minLow = simplelowest(GetField("Low", "AW"),Length);
		closePeriod = GetField("Close", "AW");

	case "AM":
		maxHigh = simplehighest(GetField("High", "AM"),Length);
		minLow = simplelowest(GetField("Low", "AM"),Length);
		closePeriod = GetField("Close", "AM");

	default:
		maxHigh = simplehighest(High,Length);
		minLow = simplelowest(Low,Length);
		closePeriod = Close;
end;

variableB = maxHigh - minLow;

if variableB <> 0 then  
	xfMin_PercentR = 100 - ((maxHigh - closePeriod) / variableB) * 100
else 
	xfMin_PercentR = 0;
]]></Code>
<Arg><![CDATA[<Arg seed="f5134879-6227-4603-bb84-578d90534cc9" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="bb5c7072-cbda-4dcd-a2c6-83922c3f03b4" version="1" />]]></Plots>
<RefFunc>1,356e05c9c03640b798c80a02e175aed1;1,35ecad2f46b642b58d4f6babdfd8e5a7</RefFunc>
<Extra><![CDATA[<Extra><VFID val="60e269cc55e9412e94e720b0b864403d" /><script><freq support="2;8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Stochastic" ID="847bcd706dda4a9caf2b783e181a8e42" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[用來計算KD/RSV相關指標的函數]]></Desc>
<Code><![CDATA[SetBarMode(2);

// Stochastic function (for KD/RSV相關指標)
//
// Input: length, rsvt, kt
// Return: rsv_value, k_value, d_value
//
input:
	length(numericsimple), rsvt(numericsimple), kt(numericsimple),
	rsv(numericref), k(numericref), d(numericref);

variable:
	maxHigh(0), minLow(0);

maxHigh = Highest(high, length);
minLow = Lowest(low, length);

if maxHigh <> minLow then
	rsv = 100 * (close - minLow) / (maxHigh - minLow)
else
	rsv = 50;

if currentbar = 1 then
  begin
	k = 50;
	d = 50;
  end
else
  begin
	k = (k[1] * (rsvt - 1) + rsv) / rsvt;
	d = (d[1] * (kt - 1) + k) / kt;
  end;  

stochastic = 1;]]></Code>
<Arg><![CDATA[<Arg seed="118ec913-97d7-493f-b839-8f9997a59e88" version="1"><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="rsvt" varname="rsvt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="kt" varname="kt" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="rsv" varname="rsv" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="k" varname="k" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="d" varname="d" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="2790b6ed-bdba-4a94-9605-185b0763a29a" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56</RefFunc>
<Extra><![CDATA[<Extra><VFID val="2d7b129ab5744af38b3346da4cd25b37" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VariancePS" ID="9c4f476d319b4f109a8dc8557099ded4" ReturnType="1" ExecType="2" Folder="/統計分析/" StatusMask="2">
<Desc><![CDATA[計算數列在某個資料樣本數下所估算出來變異數。
參數估計方法可以用母體(Population)或是樣本(Sample)。   ]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  thePrice(numericseries), Length(numericsimple), DataType(numericsimple);

variable:  Period(0), sum(0), avg(0);

VariancePS = 0;
Period = Iff(DataType = 1, Length, Length - 1);
if Period > 0 then
begin  
	avg = Average(thePrice, Length);
	sum = 0;
	for Value1 = 0 to Length - 1
	begin
		sum = sum + Square(thePrice[Value1] - avg);
	end;
	VariancePS = sum / Period;
end;
        ]]></Code>
<Arg><![CDATA[<Arg seed="65e92fc5-fe78-4dd9-b37e-6d8b606607b7" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DataType" varname="DataType" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="d43c760c-52a1-42f6-8412-41502126dd38" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="75333d9c6792423d95b8cfba8b45c5f4" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CV" ID="a8153950ff2d4a82911189a9df156b3d" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算積量指標]]></Desc>
<Code><![CDATA[SetBarMode(2);

If CurrentBar = 1 then
	CV = Close * Volume
else	
	CV = CV[1] + (Close - Close[1]) * Volume;
		]]></Code>
<Arg><![CDATA[<Arg seed="30de2514-2ccf-4d62-92bf-4569f5ef1490" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="5b9fce8b-74d4-4415-acf1-107f97552be8" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="020dba49e3e64eb3967504463fb8cc50" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DIF" ID="b3b330c5ea4e4b9c8e988ce259b3ac28" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
傳回XQ: MACD指標中DIF值
FastLength: 短期期數
SlowLength: 長期期數
}
input: FastLength(numeric), SlowLength(numeric);
variable: price(0);

price = WeightedClose();

DIF = XAverage(price, FastLength) - XAverage(price, SlowLength);

		]]></Code>
<Arg><![CDATA[<Arg seed="5eb455ea-227b-4878-a228-5f5dea68a822" version="1"><Param name="FastLength" varname="FastLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SlowLength" varname="SlowLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="ead7cd8b-b958-4c90-8fd0-56e31d98691a" version="1" />]]></Plots>
<RefFunc>1,2549534038c6445884c25787277c86db;1,d02c45cba76f4163a048685f7bc4002b</RefFunc>
<Extra><![CDATA[<Extra><VFID val="50aec22496a84de7a13a97e7e0af6956" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Average" ID="3a62e42e463c46b58e5dee79ae1e581c" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[用來計算移動平均，以最新一筆資料為基準點，輸入要計算的期數，然後計算過去期數的序列平均值。
通常序列都為開高低收價格或是量。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"
 
if  Length > 0 then
	Average = Summation(thePrice, Length) / Length
else  
	Average =0;
	
        ]]></Code>
<Arg><![CDATA[<Arg seed="1ebaa1f7-63e2-47b5-968f-559066feecfa" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="871380d4-6351-4441-9c3d-7c7a35ff5e51" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="3af6368d4e604fcd813580205067ac53" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_RSI" ID="b6137195c4c14f4dafe5be69bd24cc9b" ReturnType="1" ExecType="3" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的相對強弱指標數值。]]></Desc>
<Code><![CDATA[SetBarMode(2);

// 跨頻率RSI函數
//
// FreqType是預期要引用的頻率, 支援"D", "W", "M"
// 輸入: FreqType, Series, Length
//
input:
	FreqType(string),		//引用頻率
	Series(numericseries),	//價格序列
	Length(numericsimple);	//計算期間

variable: 
	SumUp(0), SumDown(0), 
	LastSumUp(0), LastSumDown(0),LastRefSeries(Series), 
	up(0), down(0),
	closePeriod(0);

condition1 = xf_getdtvalue(FreqType, Date) <> xf_getdtvalue(FreqType, Date[1]);
if condition1 then
begin
	LastSumUp = SumUp[1];
	LastSumDown = SumDown[1];
	LastRefSeries = Series[1];
end;

if xf_GetCurrentBar(FreqType) = 1 then
  begin
	SumUp = Average(maxlist(Series - LastRefSeries, 0), Length); 
	SumDown = Average(maxlist(LastRefSeries - Series, 0), Length); 
  end
else
  begin
	up = maxlist(Series - LastRefSeries, 0);
	down = maxlist(LastRefSeries - Series, 0);
	
	SumUp = LastSumUp + (up - LastSumUp) / Length;
	SumDown = LastSumDown + (down - LastSumDown) / Length;
  end;

if SumUp + SumDown = 0 then
	xf_RSI = 0
else
	xf_RSI = 100 * SumUp / (SumUp + SumDown);


]]></Code>
<Arg><![CDATA[<Arg seed="e4405707-1752-41ff-b74d-241d9e59bd14" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Series" varname="Series" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="663a01ef-5049-4476-86ca-d5fdb4caf5be" version="1" />]]></Plots>
<RefFunc>1,57f222578a2c4d17b2b88b65b8f28696;1,d6c8ec6b762c4f47b2ad9bfd806fea5f;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="65fb9c879da5442eadba36c40ba0a083" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="DateTime" ID="8e4cc5f4d71342f9a5b6c2e5dc9a6966" ReturnType="1" ExecType="2" Folder="/日期相關/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[setbarmode(1);
datetime = date*1000000 + time;]]></Code>
<Arg><![CDATA[<Arg seed="727fd6a3-7d76-482b-bacf-d4ec9f1a9ffd" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="61abb498-d81d-4917-96cb-1afcbc531d56" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="a6a5435ece78435082f84572154f2b04" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="漲幅排行榜" ID="21de79c68de449bfaa13668d15675404" ReturnType="1" ExecType="2" Folder="/排行/" StatusMask="2">
<Desc><![CDATA[自訂排行範例 - N期漲幅]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 這是一個自訂排行條件的範例
// 示範如何針對特定欄位的N期增幅進行排序
// 使用者可以自行替換成需要使用的欄位
//
// Length是期數

input:
	Length(20, numericsimple, "計算期間");
 
retval = rateofchange(GetField("收盤價"),Length);]]></Code>
<Arg><![CDATA[<Arg seed="ce2d5339-72b1-4d29-822e-432864772c47" version="1"><Param name="計算期間" varname="Length" type="1" subtype="0" value="20" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0b95c41f-37a3-4b2c-8f49-c0dc25002d28" version="1" />]]></Plots>
<RefFunc>1,c9f2641e5de0497cb352ace96f64236e</RefFunc>
<Extra><![CDATA[<Extra><VFID val="d8a0b6fbe295468db38586f16c3783ef" /><TotalBar val="3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighestBar" ID="328818c303ce4aa6a307cee4c60046b3" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[傳回出現過去N根K棒中最大值的位置，如果有同樣兩個以上的最大值，則傳回離現在最近的那個。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable: _Output(0);

Extremes(ThePrice, Length, 1, value1, _Output);

HighestBar = _Output;      ]]></Code>
<Arg><![CDATA[<Arg seed="9cb2e382-95ac-4021-9bf4-cb94c39068cb" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="8e503c4a-3f1c-42c7-bd5c-01820fe915bf" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="2816019e9ec646ad88438a5a37f13878" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CloseY" ID="abfcfbcbfa034f4db9f09160d8c1a85c" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得年線的收盤價。
僅限使用於年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

CloseY = GetField("Close","Y")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="ab030fbe-3503-4052-8647-f01df770f71e" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="af3b1979-2565-4eff-b503-a9f09ff14b6a" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="ecd07f35de2a4db38028abc149cc438d" /><script><freq support="16;8;9;10;11;12;13;14;15" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="RSI" ID="d64c2a71d3ea43d985ca22ef62a5a8de" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算相對強弱指標數值]]></Desc>
<Code><![CDATA[SetBarMode(2);

// RSI function (for RSI指標)
//
input: price(numericseries), length(numericsimple);                                             

variable: sumUp(0), sumDown(0), up(0), down(0);

if CurrentBar = 1 then
  begin
	sumUp = Average(maxlist(price - price[1], 0), length); 
	sumDown = Average(maxlist(price[1] - price, 0), length); 
  end
else
  begin
	up = maxlist(price - price[1], 0);
	down = maxlist(price[1] - price, 0);
	
	sumUp = sumUp[1] + (up - sumUp[1]) / length;
	sumDown = sumDown[1] + (down - sumDown[1]) / length;
  end;

if sumUp + sumDown = 0 then
	RSI = 0
else
	RSI = 100 * sumUp / (sumUp + sumDown);
	


        ]]></Code>
<Arg><![CDATA[<Arg seed="a03ecd6d-ce96-4fe5-9476-502ec4cf52e5" version="1"><Param name="price" varname="price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="84b712c7-ef9a-49ee-982b-feeb2c8ee0c0" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="55511f3d639b42f39978b0f36bb3c782" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="QoQ" ID="e15e5a9861d44a23bb77e9b4f08830b0" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:QoQVal(numericseries);

if barfreq <> "Q" then
	raiseruntimeerror("僅支援季頻率")
else
	QoQ = 100*(QoQVal/QoQVal[1]-1);]]></Code>
<Arg><![CDATA[<Arg seed="7c7dbd25-225e-47fa-9729-3bccd9105d0f" version="1"><Param name="QoQVal" varname="QoQVal" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="ca3a51bf-187a-4318-8e41-2c3398cc4dc1" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="81b5b2140d7d4acc931ddd8dd713ec08" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="PVC" ID="d024bf38df904a4aa5d01019881effde" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算成交量變動百分比指標]]></Desc>
<Code><![CDATA[SetBarMode(1);

Input: Length(numericsimple, "天數");

value1 = Average(Volume, Length);
if value1 <> 0 then
	PVC = 100 * (Volume - value1) / value1
else
	PVC = 0;
]]></Code>
<Arg><![CDATA[<Arg seed="4160b182-460e-4caf-9237-8962772ee697" version="1"><Param name="天數" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="2fa95a51-2e2b-4c4f-8de7-27684ff72694" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="a62d3b38c65e45be872437dfb64d5c99" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VHF" ID="c2946c6b970440e78a2076289f51109c" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
XQ: VHF指標
Length: 計算期數
}
input: Length(numeric);
Variable: hp(0), lp(0), numerator(0), denominator(0), VHFt(0);

hp = highest(Close, Length);
lp = lowest(Close, Length);

numerator = hp - lp;
denominator = Summation(absvalue((Close - Close[1])), Length);

if denominator <> 0 then
	VHFt = numerator / denominator
else
	VHFt = 0;

VHF = VHFt;

		]]></Code>
<Arg><![CDATA[<Arg seed="6fa107c3-5134-42c1-bc33-14f9c2f43083" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="69dd779e-78de-4938-8375-afd5afa46414" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56;1,c122bd6485c544f2bce8f374b5c7440d</RefFunc>
<Extra><![CDATA[<Extra><VFID val="1d2adbd63eb64b0f8213d8aa2c856950" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="AvgPrice" ID="388033a24d7843e0b867cdc134206623" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得利用K棒的開高低收所計算出的平均價格。]]></Desc>
<Code><![CDATA[SetBarMode(1);

AvgPrice = (Open + High + Low + Close) /4;

        ]]></Code>
<Arg><![CDATA[<Arg seed="fc71f8eb-3745-412a-aa3e-5f9371a7cb8e" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="d826941c-c9fc-40d3-afbc-f287936fdd78" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="d97fe0c429124558b79157a8080c271f" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Momentum" ID="239cb1c1f329431ea731982d8f5d94f2" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算目前K棒與N根K棒之前的價格變化]]></Desc>
<Code><![CDATA[SetBarMode(2);

// Momentum function
//
input: price(numericseries), length(numericsimple);

Momentum = price - price[length];


        ]]></Code>
<Arg><![CDATA[<Arg seed="591a00fb-6822-4b68-a17e-fdd5184c82d9" version="1"><Param name="price" varname="price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="9ca82570-edc9-4b13-a443-3887ddba2236" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="73f1fcf8f0c842088f9ecb8cd1a4d21d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ReadTicks" ID="c836e62be262417cacc14d0f7851016a" ReturnType="1" ExecType="1" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[{
    讀取從上次洗價到這次洗價之間的Tick資料

    - 可以指定最大的讀取筆數(如果兩次洗價之間的資料量超過這個限制的話, 則只回傳最新的資料)
    - 自動合併台股逐筆撮合的MultiTick(連續成交序列)
        - 所謂MultiTick, 指的是在台股逐筆撮合時, 一筆買單(賣單)同時產生了多筆不同價格的成交的情形,
        - 當發生這種情形時, 交易所會把每一個價格的成交資料分別傳送, 可是ReadTicks會把這些成交紀錄合併統計, 
		  方便使用者計算這個大單的總量,
        - 關於MultiTick, 請參考 https://bit.ly/3uZtwbG 內的更多說明

    呼叫方式:

    var: intrabarpersist readtick_cookie(0);// ReadTicks內部使用, 每次呼叫時請照實傳入
    array: tick_array[100, 11](0);          // 需要宣告一個2維陣列來儲存Tick資料
                                            // 陣列的第一維是最大讀取筆數,
                                            // 陣列的第二維是每一筆的欄位數, 請傳入11

    var: idx(0);
    value1 = ReadTicks(tick_array, readtick_cookie);
    for idx = 1 to value1 begin
        // 依序處理回傳的每一筆Tick
        // 每一筆Tick共有11個欄位, 分別是 tick_array[idx, 1], tick_array[idx, 2], .. tick_array[idx, 11]
        // 請參考底下說明
    end;

    回傳結果說明:

    - value1會是tick_array內所讀到的筆數, 如果上次洗價到這次洗價之間實際成交筆數超過tick_array宣告的大小的話, 則只會回傳最新的前N筆資料

    - tick_array[1, ..]是洗價當時最新的一筆, tick_array[2, ..]是前一筆, tick_array[value1, ..]是回傳的最後一筆

    舉例:

    如果目前已經收到了#1, #2, #3, #4 這四筆ticks, 而#3跟#4是屬於同一組MultiTick, 那麼呼叫ReadTicks時, 會回傳3筆紀錄,
    第一筆紀錄(tick_array[1,..])是#3跟#4合併的結果, 第二筆紀錄(tick_array[2,..])是#2的資料,第三筆紀錄(tick_array[3,..])是#1的資料

    - value1有可能是0, 表示到目前為止還沒有收到一筆完整的Tick. 這種情形可能會發生在系統收到了MultiTick的資料, 可是最後一筆MultiTick的資料還沒有收到.
      因為ReadTicks會把完整的MultiTick合併成一筆回傳給你, 所以此時value1會先回0. 等到下一次收到最後一筆MultiTick時就會把完整的MultiTick資料回傳給用戶.


    每一筆資料會有11個欄位, 以下分別說明

    - tick_array[n, 1] = Date (成交日期, 格式為yyyyHHmm)

    - tick_array[n, 2] = Time (成交時間, 格式為HHmmss)
        - 如果是MultiTick的話, 每一筆的Time都是一樣的(同時間成交)

    - tick_array[n, 3] = Close (成交價),
        - 如果是MultiTick的話, 回的是MultiTick序列最後一筆的成交價, 如果是買盤的話, 會是價格最高的那一筆, 如果是賣盤的話, 會是價格最低的那一筆

    - tick_array[n, 4] = Volume (成交量),
        - 如果是MultiTick的話, 回的是MultiTick序列最後一筆的成交量, 如果想要得到整組MultiTick的成交量(加總)的話, 請讀取tick_array[n, 10]

    - tick_array[n, 5] = BidAskFlag (內外盤標記, 1=外盤, -1=內盤, 0=不分),

    - tick_array[n, 6] = SeqNo (Tick序號, 每日的第一筆從1開始編制, 越來越大)
        - 如果是MultiTick的話, 回的是MultiTick序列最後一筆的Tick序號

    - tick_array[n, 7] = 成交方式註記
        - 如果不是台股的話, 這個欄位都會回-1
        - 如果是台股的話, 則依照這一筆成交資料的撮合方式來決定. 如果這一筆是集合競價的話, 回傳-1. 
		  依照目前台股的撮合規則, 每一日的開盤, 收盤, 都是集合競價, 如果商品被處置(分盤交易), 每一筆資料也是集合競價, 
		  如果商品委託價格發生很大的異動時, 交易所可能也會暫緩撮合, 此時也是集合競價.
        - 當這一筆資料被標示成集合競價時, 代表的是, 這一筆資料的價格/數量, 可能是很多個人委託單的合併, 所以XQ統計大單時, 會略過這些資料,
        - 如果是台股, 而且不是集合競價的話(也就是逐筆撮合), 那則依照這一筆是單筆成交, 還是連續成交序列(MultiTick)來判斷,
        - 如果是單筆成交的話, 回傳0, 如果是連續成交序列的話, 則回傳連續成交序列的筆數

    - tick_array[n, 8] (請看底下說明)
    - tick_array[n, 9] (請看底下說明)

    - tick_array[n, 10] = 成交量加總
        - 如果不是MultiTick的話, tick_array[n, 10]的數值跟tick_array[n, 4]是一樣的
        - 如果是MultiTick的話, tick_array[n, 10]的數值是這一組MultiTick每一筆成交量的加總

    - tick_array[n, 11] = 成交值加總(股票適用)
        - 如果不是MultiTick的話, tick_array[n, 11]是這一筆成交資料的成交值(元)
        - 如果是MultiTick的話, tick_array[n, 10]的數值是這一組MultiTick每一筆成交值的加總

    應用方式:

    value1 = ReadTicks(tick_array, readtick_cookie);
    for idx = 1 to value1 begin
        if tick_array[idx, 7] = -1 then begin
            // 集合撮合: 不判斷這一筆是否是大單
        end else begin
            // 逐筆撮合: 可以用tick_array[10]跟tick_array[11]來判斷這一筆資料的成交量/成交金額
            //
            if tick_array[idx, 10] >= 400 then ret=1;           // 400張的大單
            if tick_array[idx, 11] >= 100*10000 then ret=1;     // 100萬的大單
        end;
    end;

    - tick_array[n, 8] = 這一筆資料與目前系統最新一筆Tick的資料間隔(offset)
        - 如果這是MultiTick的話, 則[n, 8]回傳的是MultiTick序列內「第一筆資料」與目前系統最新一筆tick的offset,
        - 如果這不是MultiTick的話, 則[n, 8]回傳的是這一筆資料與目前系統最新一筆tick的offset,
        - 這個欄位的主要目的, 是讓使用者如果想要讀取MultiTick內「每一筆成交紀錄」時可以使用, 請參考底下的範例

    - tick_array[n, 9] = 這一筆資料與目前系統最新一筆Tick的資料間隔(offset)
        - 如果這是MultiTick的話, 則[n, 9]回傳的是MultiTick序列內「最後一筆資料」與目前系統最新一筆tick的offset,
        - 如果這不是MultiTick的話, 則[n, 9]回傳的是這一筆資料與目前系統最新一筆tick的offset,

    應用方式:

    value1 = ReadTicks(tick_array, readtick_cookie);
    for idx = 1 to value1 begin
        if tick_array[idx, 7] > 0 then begin
            // 這是一個MultiTick
            // 以下的寫法是從第一筆scan到最後一筆, 如果是買盤的話, 則價格由低到高, 如果是賣盤的話, 則價格由高到低
            //
            for j = tick_array[_i, 8] downto tick_array[_i, 9] begin
                value11 = GetField("Close", "Tick")[j];     // MultiTick: 其中一筆成交價
                value12 = GetField("Volume", "Tick")[j];    // MultiTick: 其中一筆成交量
            end;
        end;
    end;
}

input: tick_array[X,Y](NumericArray);	{ 參數1: 傳入要儲存tick資料的array }
input: readtick_cookie(NumericRef);		{ 參數2: Cookie: 儲存最後一次**處理**完畢的Tick編號 }

if Y < 10 then raiseruntimeerror("tick_array的第二維至少要 >= 10");

var: _cur_tickseq(0), _row(0), _i(0);
var: _last_multitick_start(0);
var: _lotsize(-1);

_cur_tickseq = GetField("SeqNo", "Tick");

if readtick_cookie > _cur_tickseq then
	readtick_cookie = 0;

if _lotsize < 0 then _lotsize = GetSymbolInfo("交易單位");

// 從上次到目前的資料範圍: readtick_cookie+1 .. _cur_tickseq
//
_i = _cur_tickseq; 	
_row = 1;
_last_multitick_start = 0;
while _i > readtick_cookie and _row <= X begin

	value1 = GetField("Date", "Tick")[_cur_tickseq - _i];
	value2 = GetField("Time", "Tick")[_cur_tickseq - _i];
	value3 = GetField("Close", "Tick")[_cur_tickseq - _i];
	value4 = GetField("Volume", "Tick")[_cur_tickseq - _i];
	value5 = GetField("BidAskFlag", "Tick")[_cur_tickseq - _i];
	value6 = GetField("SeqNo", "Tick")[_cur_tickseq - _i];
	value7 = GetField("TickGroup", "Tick")[_cur_tickseq - _i];
	
	if value7 = 0 or value7 = -1 then begin
		// 不是MultiTick
		//
		tick_array[_row, 1] = value1;		// Date
		tick_array[_row, 2] = value2;		// Time
		tick_array[_row, 3] = value3;		// Close
		tick_array[_row, 4] = value4;		// Volume
		tick_array[_row, 5] = value5;		// BidAskFlag
		tick_array[_row, 6] = value6;		// SeqNo
		
		if Y = 10 then
			tick_array[_row, 7] = 0			// (舊版邏輯) 不是MultiTick: 回0  
		else
			tick_array[_row, 7] = value7;	// (新版邏輯) 不是MultiTick: 回這一筆的TickGroup
				
		tick_array[_row, 8] = _cur_tickseq - value6;	// 這一筆的offset			
		tick_array[_row, 9] = _cur_tickseq - value6;	// 這一筆的offset
		tick_array[_row, 10] = value4;		// Volume
		
		if Y > 10 then
			tick_array[_row, 11] = value3 * value4 * _lotsize;	// (新版邏輯) 成交金額
				
		_row = _row + 1;
		_i = _i - 1;			
		
	end else begin
		// 這是MultiTick
		//
		// value7的內容應該是1, 2, 2, 3 (從舊到新)
		//
		var: _total_v(0), _total_pv(0), _count(0);
		var: _complete(false);
		
		_complete = false;
		_count = 1;
		_i = _i - 1;
		_total_v = value4;
		_total_pv = value3 * value4 * _lotsize;

		if value7 = 1 then begin
			_complete = true;
		end else begin
			while not _complete and _i > readtick_cookie begin
				value33 = GetField("Close", "Tick")[_cur_tickseq - _i];
				value44 = GetField("Volume", "Tick")[_cur_tickseq - _i];
				value66 = GetField("SeqNo", "Tick")[_cur_tickseq - _i];
				value77 = GetField("TickGroup", "Tick")[_cur_tickseq - _i];
				
				_total_v = _total_v + value44;
				_total_pv = _total_pv + value33 * value44 * _lotsize;
			
				_i = _i - 1;
				_count = _count + 1;
				
				if value77 = 1 then _complete = true;
			end;
		end;
		
		// 三種情形
		//	case#1: _complete 而且 value7(最新一筆的標記) =3 => 我們讀到了一個完整的multitick序列
		//	case#2: _complete 可是 value7不是3 
		//		=> 這個表示我們收到了一個multitick序列的開頭, 可是結尾還沒有收到
		//		case#2a	=> 如果這種情形發生在最新的資料端, 那我們可以等待下一次洗價時再來處理
		//				Example: 0, 0, 0, 1 (2, 3 is coming)
		//		case#2b	=> 如果這種情形發生在最新的資料端, 那我們可以等待下一次洗價時再來處理
		//				Example: 0, 0, 0, 1, 2, 2 (3 is coming)
		//		case#2c	=> 可是如果這種情形是發生在中間的話, 那就是資料有問題了, 例如
		//				Example: 0, 0, 0, 1 (where is 3 ?) 0, 0
		//	case#3: not _complete => 這個表示這一整批資料的第一筆竟然不是multitick序列的開頭, 可能有人傳錯 readtick_cookie了 ?
		//				Example: (where is 1 ?) 2, 2, 2, 3
		//
		// 如果是 case#2a的話, 目前收到的multitick資料就先不處理, 等下一次呼叫時再來處理
		// 其餘情形我們就組一筆MultiTick的資料
		//
		if _complete and value7 <> 3 and _row = 1 then begin
			// 紀錄這一批multitick的第一筆, 當成下一次的開始
			//
			_last_multitick_start = _i;
		
		end else begin
			tick_array[_row, 1] = value1;		// Date
			tick_array[_row, 2] = value2;		// Time
			tick_array[_row, 3] = value3;		// Close = MultiTick最後一筆的價格
			tick_array[_row, 4] = value4;		// Volume
			tick_array[_row, 5] = value5;		// BidAskFlag
			tick_array[_row, 6] = value6;		// SeqNo
			tick_array[_row, 7] = _count;		// MultiTick的筆數
			tick_array[_row, 8] = _cur_tickseq - value66; // MultiTick 第一筆的位置
			tick_array[_row, 9] = _cur_tickseq - value6;  // MultiTick 最後一筆的位置
			tick_array[_row, 10] = _total_v;	// MultiTick的總成交量

			if Y > 10 then
				tick_array[_row, 11] = _total_pv;	// (新版邏輯) 成交金額(MultiTick加總)
			
			_row = _row + 1;
		end;
	
	end;
end;


if _last_multitick_start <> 0 then begin
	readtick_cookie = _last_multitick_start;	
end else begin
	readtick_cookie = _cur_tickseq;
end;

retval = _row - 1;		// 回傳的筆數
]]></Code>
<Arg><![CDATA[<Arg seed="cd13000b-6bb6-4773-87c7-378f8adabf56" version="1"><Param name="tick_array" varname="tick_array" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="readtick_cookie" varname="readtick_cookie" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b89ffcf5-a162-4e0b-a733-12faf1994592" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><ScriptComplexity val="61" /><script><freq support="1;8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HighW" ID="c124dffb6ccf4dd4b3a1b857cd5a336e" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得週線的最高價。
僅限使用於週線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

HighW = GetField("High","W")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="282701ac-dc20-4afa-b741-a6ea7064dd66" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="d8259d63-24ff-4244-ab3a-69004cd555fb" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="7dffb640e4ab485f81f912515116b11c" /><script><freq support="9;8;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="WAD" ID="c2794b1a8745431485c71e4e2584ea2a" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
XQ: WA/D 指標
}

variable: wadt(0), adt(0);

if CurrentBar = 1 then
	wadt = 0
else
  begin
	if close = close[1] then
		adt = 0
	else
	  begin
		if close < close[1] then
			adt = close - TrueHigh
		else
			adt = close - TrueLow;
	  end;

	wadt = adt + wadt[1];
  end;

WAD = wadt;

		]]></Code>
<Arg><![CDATA[<Arg seed="13436770-6d22-4452-9de6-b0fd8910c5e8" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="bd572c66-c3ae-4d05-8047-0c53fb1b1221" version="1" />]]></Plots>
<RefFunc>1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7</RefFunc>
<Extra><![CDATA[<Extra><VFID val="b40c337dc5114ec9835f7bdecca4c04a" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OpenY" ID="bdbfc7fd08d34ac39e02a0dfb37d6054" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得年線的開盤價。
僅限使用於年線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

OpenY = GetField("Open","Y")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="4f83f831-d264-4d9b-97b5-b7c710409d1b" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="a923eb23-382f-43df-b64b-2991c79ee4c8" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="eb29763f976e4290bde793db123a7a87" /><script><freq support="16;8;9;10;11;12;13;14;15" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="xf_WeightedClose" ID="9a3ac889d48d420cacce0746079cf8da" ReturnType="1" ExecType="2" Folder="/跨頻率/" StatusMask="2">
<Desc><![CDATA[計算指定頻率的加權平均收盤價。]]></Desc>
<Code><![CDATA[SetBarMode(1);

// 跨頻率WeightedClose函數
//
// FreqType是預期要引用的頻率, 支援"D", "W", "M"
//
input:
	FreqType(string);

switch (upperstr(FreqType))
begin
	case "D":
		xf_WeightedClose = (2 * GetField("Close", "D") + GetField("High", "D") + GetField("Low", "D")) / 4;

	case "W":
		xf_WeightedClose = (2 * GetField("Close", "W") + GetField("High", "W") + GetField("Low", "W")) / 4;

	case "M":
		xf_WeightedClose = (2 * GetField("Close", "M") + GetField("High", "M") + GetField("Low", "M")) / 4;

	case "AD":
		xf_WeightedClose = (2 * GetField("Close", "AD") + GetField("High", "AD") + GetField("Low", "AD")) / 4;

	case "AW":
		xf_WeightedClose = (2 * GetField("Close", "AW") + GetField("High", "AW") + GetField("Low", "AW")) / 4;

	case "AM":
		xf_WeightedClose = (2 * GetField("Close", "AM") + GetField("High", "AM") + GetField("Low", "AM")) / 4;

	default:
		xf_WeightedClose = (2 * Close + High + Low) / 4;
end;
]]></Code>
<Arg><![CDATA[<Arg seed="50c528b4-98bd-4eb1-b339-923bf14d5a82" version="1"><Param name="FreqType" varname="FreqType" type="3" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="af128b9f-090c-45c4-9932-6a1b2068da27" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="f8f718427aaa42518273d6cfa4e65337" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OpenW" ID="9565ee69fed14076aca3032a907ae0a3" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得週線的開盤價。
僅限使用於週線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

OpenW = GetField("Open","W")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="2f111d32-43e7-4215-8312-863e85baaabd" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="07189cf1-8486-44f8-9200-55d1eb4606fa" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="81cbc33729a34564ab8473de298d859b" /><script><freq support="9;8;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BR" ID="17ecb56745124b5fb6a0bcc2f310c26b" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

{
BR買賣願指標:買賣行情雙方力道強弱的參考指標
當BR指標值介於70~50時，行情為處盤整狀態。
若BR值超過300，表行情處相對高價，應小心回檔。
若BR值低於50，表行情處於相對低價，應注意價位的反彈。
Length: 計算期數
}
input: Length(numeric);
variable: sum(0), brt(0);

sum= Summation((Close[1] - Low), length);
if sum <> 0 then
	brt = 100 * Summation((High - Close[1]), length) / sum
else
	brt = brt[1];

BR  = brt;

		]]></Code>
<Arg><![CDATA[<Arg seed="e35e9774-4597-48e7-aee2-5b67549f38f6" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="0992fa75-a526-49d2-b981-f961776bf8bd" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d</RefFunc>
<Extra><![CDATA[<Extra><VFID val="44f575d4d7e54e2cb895623e5c535551" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="BollingerBand" ID="5f76de57dba441808c8c784d8fa54994" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算均線加減標準差的帶狀通道，價格均線為中間線，上通道為價格均線加上N個標準差，下通道為價格均線減去N個標準差]]></Desc>
<Code><![CDATA[SetBarMode(1);

// BollingerBand function
//
Input: price(numericseries), length(numericsimple), _band(numericsimple);

BollingerBand = Average(price, length) + _band * StandardDev(price, length, 1);
        ]]></Code>
<Arg><![CDATA[<Arg seed="5399571b-93c9-4cd5-b8cd-c860d574a659" version="1"><Param name="price" varname="price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="length" varname="length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="_band" varname="_band" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="4e49da34-6a06-41e3-9eb4-c96e488d6ef6" version="1" />]]></Plots>
<RefFunc>1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,8c2d025a23c548d3a76fba10c22527b4;1,9c4f476d319b4f109a8dc8557099ded4;1,c1cda70a714d44999e5171fc53c95b0a</RefFunc>
<Extra><![CDATA[<Extra><VFID val="bebd7887c5e94d8880909a076aff3a4d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="TrueRange" ID="9e03682196e24611b2fe326b6a56433d" ReturnType="1" ExecType="2" Folder="/價格計算/" StatusMask="2">
<Desc><![CDATA[價格波動的真實區間]]></Desc>
<Code><![CDATA[SetBarMode(1);

TrueRange = TrueHigh - TrueLow;
        ]]></Code>
<Arg><![CDATA[<Arg seed="b40ccdd1-5dce-4017-add9-1265c13bc75c" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="60f01385-3082-463f-9ea4-cbf1ff64e7f0" version="1" />]]></Plots>
<RefFunc>1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="40813459d0e14cb18614cce43193b7fa" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="ACC" ID="162ffb45c75346a596029f2fea1df8c2" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
ACC加速量指標(Acceleration)，用來觀察行情價格變化的加速度幅度，
是MOM運動量指標的再一次計算，使用收盤價，並以相同期間長度計算
Length: 計算期數
}

input: Length(numeric);

value1 = Momentum(Close, Length);
value2 = Momentum(value1, Length);

ACC =value2;
		]]></Code>
<Arg><![CDATA[<Arg seed="275be850-6d74-481b-bfb8-dfd21bc313e3" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="3e710b7f-369f-484a-98ae-37d84aef0ff9" version="1" />]]></Plots>
<RefFunc>1,239cb1c1f329431ea731982d8f5d94f2</RefFunc>
<Extra><![CDATA[<Extra><VFID val="da4e33b6330c490a9530e81ba4731c04" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="StandardDev" ID="c1cda70a714d44999e5171fc53c95b0a" ReturnType="1" ExecType="2" Folder="/統計分析/" StatusMask="2">
<Desc><![CDATA[計算價格數量資料的標準差。
參數估計方法可以用母體(Population)或是樣本(Sample)。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:  thePrice(numericseries), Length(numericsimple), DataType(numericsimple);

Value1 = VariancePS(thePrice, Length, DataType);
if Value1 > 0 then 
	StandardDev = SquareRoot(Value1)
else 
	StandardDev = 0;
        ]]></Code>
<Arg><![CDATA[<Arg seed="cc7bd772-528e-44a4-b4df-dea266d795cc" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DataType" varname="DataType" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="82bc157b-9ce7-40b4-9d16-c4d31b5faf97" version="1" />]]></Plots>
<RefFunc>1,8c2d025a23c548d3a76fba10c22527b4;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c;1,9c4f476d319b4f109a8dc8557099ded4</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="34f3c6d476e54ce9b770517801216c6c" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="SimpleHighest" ID="356e05c9c03640b798c80a02e175aed1" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries),Length(numericsimple);

variable: highValue(0);
variable: i(0);

highValue = thePrice[0];
for i = 1 to Length-1
begin
  if thePrice[i] > highValue then
    highValue = thePrice[i];
end;

SimpleHighest = highValue; 	

]]></Code>
<Arg><![CDATA[<Arg seed="b9d3eb34-a995-44eb-89df-430540c0118e" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="d97baa39-05f3-4211-956f-cd15aa4f5660" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="6394cfc4af0b4eabbd5c50ed4772cdd7" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="OpenD" ID="5fc5395e45f8445881703c142fc4e51d" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得日線的開盤價。
僅限使用於日線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

OpenD = GetField("Open","D")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="56632602-3b1a-4d41-a300-8f313f81491e" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="54f96780-dff9-4bc1-a342-7c6f82a48636" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="cf95c9a602054f038039e46c52eacec7" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="Extremes" ID="61c06064ad98469db9ce30287ae4a2c8" ReturnType="1" ExecType="3" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[使用這個函數來找出某個數列的第N個極大值(極小值)]]></Desc>
<Code><![CDATA[SetBarMode(2);

input:  
	SourceSeries(numericseries), 	//來源數列
	Length(numericsimple), 			//計算期間
    DscAsc(numericsimple), 			//極大值(1)或極小值(-1)
	refExtremeValue(numericref), 	//輸出極值
	refExtremeBar(numericref);		//輸出極值K棒相對位置
	
var:
	exLength(0);

if 1 > Length then 
begin
  refExtremeValue = 0 ;
  refExtremeBar = -1 ;
  extremes = -1 ;
  return;
end;

if Length <> exLength or currentbar = 1 or value2 >= Length - 1 then
begin
	value1 = SourceSeries;
	value2 = 0;
	for value3 = 1 to Length - 1
	begin
		if DscAsc * SourceSeries[value3] > DscAsc * value1 then
		begin
			value1 = SourceSeries[value3];
			value2 = value3;	
		end;
	end;
end
else begin
	if DscAsc * SourceSeries >= DscAsc * value1 then begin
		value1 = SourceSeries;
		value2 = 0;	
	end	else
		value2 = value2 + 1;
end;

exLength = Length;
refExtremeValue = value1;
refExtremeBar = value2;
Extremes = 1;]]></Code>
<Arg><![CDATA[<Arg seed="47d2640f-c290-4cf8-b6bf-fedab53bf1db" version="1"><Param name="SourceSeries" varname="SourceSeries" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DscAsc" varname="DscAsc" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeValue" varname="refExtremeValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeBar" varname="refExtremeBar" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="ebf1c195-debb-4c71-800b-e7e45e16a9bc" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="f302faf389a44d9eb58a71a1f6f5bddb" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="FastLowest" ID="804e2b79d5ac4c0e9109df69f1c5f4ca" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: thePrice(numericseries), Length(numericsimple);
variable: _Output(0);

Extremes(thePrice, Length, -1, _Output, value2);

FastLowest = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="e0c107c9-c399-488e-b924-c851e68b7f4e" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="4c939d9c-1c50-4582-9a31-5863cdc86694" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="2cddcc83aae547849fbc9eb54447fdc3" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="CloseD" ID="e53a55e6d49b466da1125c878df9cf9a" ReturnType="1" ExecType="2" Folder="/價格取得/" StatusMask="2">
<Desc><![CDATA[取得日線的收盤價。
僅限使用於日線以下之頻率。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input: PeriodsAgo(numericsimple);

CloseD = GetField("Close","D")[PeriodsAgo];
]]></Code>
<Arg><![CDATA[<Arg seed="97a60a09-7e1e-44d1-9f23-7b9fc75a43de" version="1"><Param name="PeriodsAgo" varname="PeriodsAgo" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="e6c7acfe-1f7a-4e43-9095-1ced90d9327f" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="4e3a03282b91460b832c600c743f2f92" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MTM" ID="607a9823aec54a91ab43847239ccd4dd" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
以收盤價計算的運動量指標
Length: 計算期數
}
input: Length(numeric);

MTM = Momentum(Close, Length);



		]]></Code>
<Arg><![CDATA[<Arg seed="bb8b1db3-cd42-4d99-8b13-9c2ac716fdc4" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="31a26144-9663-4d09-95cf-5e84622b7927" version="1" />]]></Plots>
<RefFunc>1,239cb1c1f329431ea731982d8f5d94f2</RefFunc>
<Extra><![CDATA[<Extra><VFID val="d24f95cab1b54f2a8b9d427e7ac5d45d" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="PercentR" ID="b348a25d74c84ec4b6c1807d146a49fa" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[計算當前收盤價在某個區間內，在區間最高價與最低價之間的百分比。
]]></Desc>
<Code><![CDATA[SetBarMode(1);

// PercentR function (for 威廉指標)
//
input: Length(numericsimple);
variable: variableA(0), variableB(0);

variableA = Highest(High, Length);
variableB = variableA - Lowest(Low, Length);

if variableB <> 0 then  
	PercentR = 100 - ((variableA - Close) / variableB) * 100
else 
	PercentR = 0;
        ]]></Code>
<Arg><![CDATA[<Arg seed="6242c779-b1a8-4d2e-897f-71c9ab07066e" version="1"><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b7ed925c-2932-4dae-8dcb-994398e68890" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8;1,2bca774c6b7549c1b0b008d2a54b288e;1,f1b429ac13b2447c909302198c18ca56</RefFunc>
<Extra><![CDATA[<Extra><VFID val="73ec9249d6314d9886dd36f436a9932a" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="MACD" ID="8216021f4b11489b8faca5f2af7d0750" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[傳回兩條快速與慢速指數移動平均線的差]]></Desc>
<Code><![CDATA[SetBarMode(1);

// MACD function
//	Input: Price序列, FastLength, SlowLength, MACDLength
//  Output: DifValue, MACDValue, OscValue
// 
Input: Price(numericseries), FastLength(numericsimple), SlowLength(numericsimple), MACDLength(numericsimple);
Input: DifValue(numericref), MACDValue(numericref), OscValue(numericref);

DifValue = XAverage(price, FastLength) - XAverage(price, SlowLength);
MACDValue = XAverage(DifValue, MACDLength) ;
OscValue = DifValue - MACDValue;

 ]]></Code>
<Arg><![CDATA[<Arg seed="0c966f99-333e-47ff-b267-06830b71df92" version="1"><Param name="Price" varname="Price" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="FastLength" varname="FastLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="SlowLength" varname="SlowLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="MACDLength" varname="MACDLength" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DifValue" varname="DifValue" type="1" subtype="0" isSerial="1" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="MACDValue" varname="MACDValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="OscValue" varname="OscValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="9898b5e0-0365-40a7-9d21-5dee245ce4b8" version="1" />]]></Plots>
<RefFunc>1,d02c45cba76f4163a048685f7bc4002b</RefFunc>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><VFID val="916f1004c55b49caab54ac22a7390391" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VAO" ID="93cabed6870d4be79b057ca3fb82cbf7" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

variable: support(0), resist(0), hlDiff(0);
 
support = (Close - Low);
resist = (High - Close);
hlDiff = (High - Low);

if hlDiff = 0 then
	VAO = 0
else
	VAO = (support - resist) / hlDiff * v;
]]></Code>
<Arg><![CDATA[<Arg seed="623b2785-a83a-454f-933b-228cc1ddd344" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="0d6ba6c4-8d03-4295-ac8b-b7caad5e4422" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><VFID val="0f35ec982f194210a5b06e3ad4051fd7" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="LowestBar" ID="68349c444a9c43f09b19def4bddc206e" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[傳回出現過去N根K棒中最小值的位置，如果有同樣兩個以上的最小值，則傳回離現在最近的那個。]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:thePrice(numericseries); //"價格序列"
input:Length(numericsimple);   //"計算期間"

variable: _Output(0);

Extremes(ThePrice, Length, -1, value1, _Output);

Lowestbar = _Output;]]></Code>
<Arg><![CDATA[<Arg seed="f7723b08-8a6f-4dae-a4bc-c8f1de27671f" version="1"><Param name="thePrice" varname="thePrice" type="1" subtype="0" isSerial="1" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="Length" varname="Length" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="4b91e362-fb2f-4f63-ad01-d331b44ec562" version="1" />]]></Plots>
<RefFunc>1,61c06064ad98469db9ce30287ae4a2c8</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c23c244522764fa8ab11bc57e8431e21" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="NthExtremesArray" ID="078a531623ab4210b45048370757e8fa" ReturnType="1" ExecType="2" Folder="/價格關係/" StatusMask="2">
<Desc><![CDATA[使用這個函數來找出某個陣列的第N個極大值(極小值)]]></Desc>
<Code><![CDATA[SetBarMode(1);

input:
	SourceArray[MaxSize](numericarray), 	//來源陣列
	Size(numericsimple), 					//來源陣列大小
	N(numericsimple),                       //極值順序
    DscAsc(numericsimple), 					//極大值(1)或極小值(-1)
	refExtremeValue(numericref), 			//輸出極值
	refExtremeIndex(numericref);			//輸出極值陣列索引值

array: ntharrayA[200](0),ntharrayB[200](0);
variable: x(0),y(0),temp(0);
variable: startIndex(0),endIndex(0),NIndex(0);

if N > Size or Size > MinList(MaxSize+1,200) then
begin 
	refExtremeValue = 0;
	refExtremeIndex = -1;
	NthExtremesarray = -1;
end
else 
begin
	if Size = MaxSize+1 then begin
		startIndex = 0;
		endIndex = MaxSize;
		NIndex = N - 1;
	end else begin
		startIndex = 1;
		endIndex = Size;
		NIndex = N;
	end;

	for x = startIndex to endIndex
	begin
		ntharrayA[x] = SourceArray[x];
		ntharrayB[x] = x;
	end;
	for x = startIndex to endIndex - 1
	begin
		for y = x + 1 to endIndex
		begin
			if((DscAsc = 1 and ntharrayA[x] < ntharrayA[y] )or
				(DscAsc = -1 and ntharrayA[x] > ntharrayA[y])) then
			begin
				temp = ntharrayA[x];
				ntharrayA[x] = ntharrayA[y];
				ntharrayA[y] = temp;
				
				temp = ntharrayB[x];
				ntharrayB[x] = ntharrayB[y];
				ntharrayB[y] = temp;
			end;
		end;
	end;
	refExtremeValue = ntharrayA[NIndex];
	refExtremeIndex = ntharrayB[NIndex];
	NthExtremesarray = 1;
end;]]></Code>
<Arg><![CDATA[<Arg seed="21d0a108-8c1e-48e2-bd70-e5a0ff4b900b" version="1"><Param name="SourceArray" varname="SourceArray" type="1" subtype="0" isSerial="0" isArray="1" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="Size" varname="Size" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="N" varname="N" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="DscAsc" varname="DscAsc" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeValue" varname="refExtremeValue" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /><Param name="refExtremeIndex" varname="refExtremeIndex" type="1" subtype="0" isSerial="0" isArray="0" isRef="1" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="b58caa2e-cd73-47ce-9839-8c02d9f4dc33" version="1" />]]></Plots>
<Extra><![CDATA[<Extra><TotalBar val="0" /><Maxbb val="0" /><ScriptComplexity val="1" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="VA" ID="53cc026a5f5d46bf8b51bc22052c1ff0" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

VA = VA[1] + VAO;
]]></Code>
<Arg><![CDATA[<Arg seed="843306c0-eed5-498f-be03-b5f3290b93ae" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="d364a859-a425-4aa7-bb1a-3b1d1d14881d" version="1" />]]></Plots>
<RefFunc>1,93cabed6870d4be79b057ca3fb82cbf7</RefFunc>
<Extra><![CDATA[<Extra><VFID val="c8642d9c593b40e096cf7aa79b36d4ee" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="HL_Osc" ID="61b9cfcba7814e41a1501a74d5fa20ce" ReturnType="1" ExecType="2" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(1);

{
 XQ: HL-Osc 指標
}
variable: hlot(0);

if TrueRange <> 0 then
	hlot = 100 * (H - C[1]) / TrueRange
else
	hlot = 0;

hl_osc = hlot;

		]]></Code>
<Arg><![CDATA[<Arg seed="fda5e46b-0f76-4f81-83a0-e28a60db3077" version="1" />]]></Arg>
<Plots><![CDATA[<Plots seed="8b052a93-c41e-4d7f-839e-4aa9a8024dc3" version="1" />]]></Plots>
<RefFunc>1,36d1fc033c6f48f8a136f9e1fdec110f;1,81394f9cf0c8469ea5f8832700aec8b7;1,9e03682196e24611b2fe326b6a56433d</RefFunc>
<Extra><![CDATA[<Extra><VFID val="39166d048b4b4b1f94536c72a3e55643" /><script><freq support="8;9;10;11;12;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
<Script Type="1" Name="KO成交量擺盪指標" ID="26f5e18d32f94a36aab6bac8d2d2a673" ReturnType="1" ExecType="3" Folder="/技術指標/" StatusMask="2">
<Desc><![CDATA[]]></Desc>
<Code><![CDATA[SetBarMode(2);

Input: Length1(numericsimple, "短天期");
Input: Length2(numericsimple, "長天期");

variable: kovolume(0), tp(0), ko(0), koaverage(0);   

tp = typicalprice;   

if tp >= tp[1] then   
	kovolume = volume   
else    
	kovolume = -volume;
  
ko = average(kovolume, Length1) - average(kovolume, Length2);

ret = ko;]]></Code>
<Arg><![CDATA[<Arg seed="7a8fb379-f932-45aa-86c8-4a25e4195988" version="1"><Param name="短天期" varname="Length1" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /><Param name="長天期" varname="Length2" type="1" subtype="0" isSerial="0" isArray="0" isRef="0" inputkind="0" quickedit="0" keytype="0" /></Arg>]]></Arg>
<Plots><![CDATA[<Plots seed="aa8de701-cfd4-4fe2-9f23-f8763f96efdf" version="1" />]]></Plots>
<RefFunc>1,949e616a0b17470eb3397b099c2dec83;1,c122bd6485c544f2bce8f374b5c7440d;1,3a62e42e463c46b58e5dee79ae1e581c</RefFunc>
<Extra><![CDATA[<Extra><VFID val="4578d9f8cb2247eda5dff7eaed2c746a" /><script><freq support="8;11;9;12;10;13;14;15;16" /></script></Extra>]]></Extra>
<ScriptRunVer val="0" />
</Script>
</Scripts>
